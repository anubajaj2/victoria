sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter","sap/m/MessageToast","sap/ui/model/Filter"],function(e,t,o,r,a,n){"use strict";return e.extend("victoria.controller.Group",{formatter:r,onInit:function(){var e=this;var o=this.getModel("local").getProperty("/CurrentUser");var r=this.getModel("local").oData.AppUsers[o].UserName;r="Hey "+r;this.getView().byId("idUser").setText(r);this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var a,n=new t({groupCode:"",groupName:"",description:""});this.setModel(n,"groupModel");var i=new t({buttonText:"Save",deleteEnabled:false});this.setModel(i,"viewModel");var s=this.getRouter();s.getRoute("Group").attachMatched(this._onRouteMatched,this)},onPressGroupDownload:function(){window.open("/groupsDownload?type=Groups")},_onRouteMatched:function(){var e=this;var o=this.getView().getModel("viewModel");o.setProperty("/codeEnabled",true);o.setProperty("/buttonText","Save");o.setProperty("/deleteEnabled",false);var r=new t({groupCodeState:"None"});this.setModel(r,"dataModel");this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups","GET",{},{},this).then(function(o){var r=new t;r.setData(o);e.getView().setModel(r,"groupModelInfo")}).catch(function(t){a.show(e.resourceBundle.getText("ReqField"))});this.clearGroup()},toggleFullScreen:function(){var e="idFullScreenBtn";var t="__component0---idGroup--GroupHeader";this.toggleUiTable(e,t)},additionalInfoValidation:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("dataModel");if(e.getData().groupCode===""){t.setProperty("/groupCodeState","Error")}else{t.setProperty("/groupCodeState","None")}},onSubmitGroupName:function(){this.getView().byId("groupDescription").focus();this.getView().byId("groupDescription").$().find("input").select()},onSubmitGroupDescription:function(){this.getView().byId("acceptButton").focus()},onSelect:function(e){this.getView().byId("acceptButton").focus()},groupCodeCheck:function(e){var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var r=this.getView().getModel("groupModelInfo").getData().results;var a=this.getView().getModel("viewModel");function n(e){return r.filter(function(t){return t.groupCode===e})}var i=n(o);if(i.length>0){t.getData().groupName=i[0].groupName;t.getData().description=i[0].description;t.getData().hide=i[0].hide;a.setProperty("/buttonText","Update");a.setProperty("/deleteEnabled",true);a.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}else{t.getData().groupName="";t.getData().description="";a.setProperty("/buttonText","Save");a.setProperty("/deleteEnabled",false);a.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}},clearGroup:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("viewModel");var o=this.getView().getModel("dataModel");e.getData().groupName="";e.getData().description="";e.getData().groupCode="";t.setProperty("/codeEnabled",true);t.setProperty("/buttonText","Save");t.setProperty("/deleteEnabled",false);o.setProperty("/groupCode","None");o.setProperty("/hide","None");e.refresh()},deleteGroup:function(){var e=this;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var r=this.getView().getModel("groupModelInfo").getData().results;function n(e){return r.filter(function(t){return t.groupCode===e})}var i=n(o);if(i.length>0){if(!this.customerGroupInfo(i[0].groupName)){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+i[0].id+"')","DELETE",{},{},this).then(function(o){a.show(e.resourceBundle.getText("Delete1"));t.getData().groupCode="";t.getData().groupName="";t.getData().description="";t.refresh();e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Delete2"))})}else{a.show(e.resourceBundle.getText("Groups1"))}}else{a.show(e.resourceBundle.getText("available11"))}},customerGroupInfo:function(e){var t=this.getView().getModel("customerModelInfo");var o=t.getData().results;function r(t){return o.filter(function(t){return t.Group===e})}var a=r(e);if(a.length>0){return true}else{return false}},saveGroup:function(){var e=this;var o=this.getView().getModel("groupModel");var r=o.getData().groupCode;var n=o.getData().hide;var i=this.getView().getModel("groupModelInfo").getData().results;if(r===""){this.additionalInfoValidation();a.show(e.resourceBundle.getText("Fields"));return}function s(e){return i.filter(function(t){return t.groupCode===e})}function u(e){return i.filter(function(t){return t.hide===e})}var d=s(r);if(d.length>0){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+d[0].id+"')","PUT",{},o.getData(),this).then(function(r){sap.m.MessageToast.show(e.resourceBundle.getText("Pic4"));var n=new t;n.setData();e.getView().setModel(n,"photo2");var i={id:d[0].id,hide:o.getData().hide};$.post("/updatePhotoFlag1",i).done(function(t,o){sap.m.MessageToast.show(e.resourceBundle.getText("Data12"))}).fail(function(t,o,r){sap.m.MessageBox.error(e.resourceBundle.getText("Update12"))});a.show(e.resourceBundle.getText("Data"));e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Data1"))})}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Group","POST",{},o.getData(),this).then(function(t){a.show(e.resourceBundle.getText("Data"));e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Data1"))})}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("group",{Id:t});this._bindView("/"+e)}.bind(this))},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_bindView:function(e){var t=this.getModel("objectView"),o=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){o.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),o=e.getElementBinding();if(!o.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var r=this.getResourceBundle(),a=e.getBindingContext().getObject(),n=a.Id,i=a.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",r.getText("saveAsTileTitle",[i]));t.setProperty("/shareOnJamTitle",i);t.setProperty("/shareSendEmailSubject",r.getText("shareSendEmailObjectSubject",[n]));t.setProperty("/shareSendEmailMessage",r.getText("shareSendEmailObjectMessage",[i,n,location.href]))}})});