sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter","sap/m/MessageToast","sap/ui/model/Filter"],function(e,t,o,r,a,i){"use strict";return e.extend("victoria.controller.Group",{formatter:r,onInit:function(){var e=this;var o=this.getModel("local").getProperty("/CurrentUser");var r=this.getModel("local").oData.AppUsers[o].UserName;r="Hey "+r;this.getView().byId("idUser").setText(r);this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var a,i=new t({groupCode:"",groupName:"",description:""});this.setModel(i,"groupModel");var n=new t({buttonText:"Save",deleteEnabled:false});this.setModel(n,"viewModel");var s=this.getRouter();s.getRoute("Group").attachMatched(this._onRouteMatched,this)},onPressGroupDownload:function(){window.open("/groupsDownload?type=Groups")},_onRouteMatched:function(){var e=this;var o=this.getView().getModel("viewModel");o.setProperty("/codeEnabled",true);o.setProperty("/buttonText","Save");o.setProperty("/deleteEnabled",false);var r=new t({groupCodeState:"None"});this.setModel(r,"dataModel");this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups","GET",{},{},this).then(function(o){var r=new t;r.setData(o);e.getView().setModel(r,"groupModelInfo")}).catch(function(t){a.show(e.resourceBundle.getText("ReqField"))});this.clearGroup()},toggleFullScreen:function(){debugger;var e="idFullScreenBtn";var t="__component0---idGroup--GroupHeader";this.toggleUiTable(e,t)},additionalInfoValidation:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("dataModel");if(e.getData().groupCode===""){t.setProperty("/groupCodeState","Error")}else{t.setProperty("/groupCodeState","None")}},onSubmitGroupName:function(){this.getView().byId("groupDescription").focus();this.getView().byId("groupDescription").$().find("input").select()},onSubmitGroupDescription:function(){this.getView().byId("acceptButton").focus()},onSelect:function(e){debugger;var t=this;var o=e.getSource().getParent().getContent()[0].getBindingContext();var r={groupCode:sap.ui.getCore().byId("idSelect").getValue(),groupName:sap.ui.getCore().byId("groupName").getValue(),description:sap.ui.getCore().byId("groupDescription").getValue(),hide:this.getView().byId("CBID1").getSelected()};if(o){var a=e.getSource().getBindingContext().sPath;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),a,"PUT",{},r,this).then(function(e){sap.m.MessageToast.show("Server Updated successfully");t.getView().setBusy(false);t._oDialogSecure.close()}).catch(function(e){t.getView().setBusy(false);t.oPopover=t.getErrorMessage(e);t.getView().setBusy(false)})}else{var i={name:r.UserName,emailId:r.EmailId,password:password,role:r.Role,Authorization:"kREmIDG9mpGiGuWnfayajMIyIZhNEPfZ2okow0VLRMxyAs2dRZIH1L5eqTLYdEGY"};$.post("/createNewUser",i).then(function(e){t.getOwnerComponent().getModel().refresh();sap.m.MessageToast.show(e);t.getView().setBusy(false);t._oDialogSecure.close()}).fail(function(e){sap.m.MessageBox.error("User Creation failed");t.getView().setBusy(false);t.getView().setBusy(false)})}},groupCodeCheck:function(e){debugger;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var r=this.getView().getModel("groupModelInfo").getData().results;var a=this.getView().getModel("viewModel");function i(e){return r.filter(function(t){return t.groupCode===e})}var n=i(o);if(n.length>0){t.getData().groupName=n[0].groupName;t.getData().description=n[0].description;t.getData().hide=n[0].hide;a.setProperty("/buttonText","Update");a.setProperty("/deleteEnabled",true);a.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}else{t.getData().groupName="";t.getData().description="";a.setProperty("/buttonText","Save");a.setProperty("/deleteEnabled",false);a.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}},clearGroup:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("viewModel");var o=this.getView().getModel("dataModel");e.getData().groupName="";e.getData().description="";e.getData().groupCode="";t.setProperty("/codeEnabled",true);t.setProperty("/buttonText","Save");t.setProperty("/deleteEnabled",false);o.setProperty("/groupCode","None");e.refresh()},deleteGroup:function(){var e=this;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var r=this.getView().getModel("groupModelInfo").getData().results;function i(e){return r.filter(function(t){return t.groupCode===e})}var n=i(o);if(n.length>0){if(!this.customerGroupInfo(n[0].groupName)){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+n[0].id+"')","DELETE",{},{},this).then(function(o){a.show(e.resourceBundle.getText("Delete1"));t.getData().groupCode="";t.getData().groupName="";t.getData().description="";t.refresh();e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Delete2"))})}else{a.show(e.resourceBundle.getText("Groups1"))}}else{a.show(e.resourceBundle.getText("available11"))}},customerGroupInfo:function(e){var t=this.getView().getModel("customerModelInfo");var o=t.getData().results;function r(t){return o.filter(function(t){return t.Group===e})}var a=r(e);if(a.length>0){return true}else{return false}},saveGroup:function(){debugger;var e=this;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var r=t.getData().hide;var i=this.getView().getModel("groupModelInfo").getData().results;if(o===""){this.additionalInfoValidation();a.show(e.resourceBundle.getText("Fields"));return}function n(e){return i.filter(function(t){return t.groupCode===e})}function s(e){return i.filter(function(t){return t.hide===e})}var u=n(o);if(u.length>0){debugger;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+u[0].id+"')","PUT",{},t.getData(),this).then(function(t){a.show(e.resourceBundle.getText("Data"));e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Data1"))})}else{debugger;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Group","POST",{},t.getData(),this).then(function(t){a.show(e.resourceBundle.getText("Data"));e._onRouteMatched()}).catch(function(t){a.show(e.resourceBundle.getText("Data1"))})}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("group",{Id:t});this._bindView("/"+e)}.bind(this))},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_bindView:function(e){var t=this.getModel("objectView"),o=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){o.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),o=e.getElementBinding();if(!o.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var r=this.getResourceBundle(),a=e.getBindingContext().getObject(),i=a.Id,n=a.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",r.getText("saveAsTileTitle",[n]));t.setProperty("/shareOnJamTitle",n);t.setProperty("/shareSendEmailSubject",r.getText("shareSendEmailObjectSubject",[i]));t.setProperty("/shareSendEmailMessage",r.getText("shareSendEmailObjectMessage",[n,i,location.href]))}})});