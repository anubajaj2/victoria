sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter","sap/m/MessageToast","sap/ui/model/Filter"],function(e,t,a,r,s,o){"use strict";return e.extend("victoria.controller.Inventory",{formatter:r,productId:"",customerId:"",globalDate:"",onInit:function(){var e,a=new t({busy:false,delay:0,dateValue:new Date,entryType:"Sold",ProductCode:"",Qty:0,Weight:0,CustomerCode:"",Remarks:""});var r=new t({items:[{Id:"",Date:"",Time:"",ProductCode:"D",Category:"D",Qty:0,Weight:0,CustomerCode:"S",City:"D",Remarks:""}]});var s=new t({items:[{Id:"",Date:"",Time:"",ProductCode:"W",Category:"",Qty:0,Weight:0,CustomerCode:"F",City:"E",Remarks:""}]});this.setModel(r,"jama");this.setModel(s,"naam");this.loadDataInTables();this.setModel(a,"objectView")},onSubmit:function(e){this.createInventory()},onClear:function(e){this.byId("idRemarks").setValue("");this.byId("idEntryType").getSelectedKey(2);this.byId("idQty").setValue("0");this.byId("idWeight").setValue("0");this.byId("customerCode").setValue("");this.byId("productInput").setValue("")},createInventory:function(){var e=this;var t={Comments:this.byId("idRemarks").getValue(),Customer:this.customerId,Weight:parseFloat(this.byId("idWeight").getValue()),Extra:null,InventoryTransactionType:parseFloat(this.byId("idEntryType").getSelectedKey()),Quantity:parseFloat(this.byId("idQty").getValue()),TransactionCreatedDate:this.convertToJSONDate(this.byId("dateEntry").getYyyymmdd()),TransactionModifiedDate:this.convertToJSONDate(this.byId("dateEntry").getYyyymmdd()),InventoryTransactionTypeDetails:{__metadata:{uri:"http://localhost:8080/bhavysoft/galaxyService.svc"+"/InventoryTransactionTypes("+this.byId("idEntryType").getSelectedKey()+")"}},ProductDetails:{__metadata:{uri:"http://localhost:8080/bhavysoft"+"/galaxyService.svc/Products("+this.productId+")"}},CustomerDetails:{__metadata:{uri:"http://localhost:8080/bhavysoft"+"/galaxyService.svc/Customers("+this.customerId+")"}}};this.getModel().create("/InventoryTransactions",t,{success:function(){s.show("Created successfully");e.loadDataInTables()}})},selectedCustomer:function(e){var t=e.getParameter("selectedItem");var a=t.getText();var r=t.getKey();var s=this;console.log(a);console.log(r);this.getModel().read("/Customers("+r+")",{urlParameters:{$expand:"CitycodeDetails"},success:function(e){s.customerId=e.Id;s.byId("lblCustomer").setText(e.FirstName+", "+e.CitycodeDetails.Name)}})},selectedProduct:function(e){var t=e.getParameter("selectedItem");var a=t.getText();var r=t.getKey();var s=this;console.log(a);console.log(r);this.getModel().read("/Products("+r+")",{success:function(e){s.productId=e.Id;s.byId("lblProduct").setText(e.ProductName+", "+e.Category)}})},stringToDate:function(e,t,a){var r=t.toLowerCase();var s=r.split(a);var o=e.split(a);var i=s.indexOf("mm");var n=s.indexOf("dd");var d=s.indexOf("yyyy");var u=parseInt(o[i]);u-=1;var l=new Date(o[d],u,o[n]);return l},getDatesFromDate:function(e){var t=e.substring(0,4);var a=e.substring(4,6);var r=e.substring(6,8);var s=t+"-"+a+"-"+r+"T00:00:00";var o=new Date(t+"-"+a+"-"+r);o.setDate(o.getDate()+1);var i=o.toISOString().substr(0,10);var t=i.substring(0,4);var a=i.substring(5,7);var r=i.substring(8,10);var n=t+"-"+a+"-"+r+"T00:00:00";return[s,n]},convertToJSONDate:function(e){var t=e.substring(0,4);var a=e.substring(4,6);var r=e.substring(6,8);var s=new Date;var o=t+"-"+a+"-"+r+"T00:00:00";var i=new Date(t+"-"+a+"-"+r);var n=new Date(i.getFullYear(),i.getMonth(),i.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds());return"/Date("+n.getTime()+")/"},dateChanged:function(e){var t=e.getParameter("newYyyymmdd");this.globalDate=t;console.log(t);var a=this;var r=new o("TransactionCreatedDate","GE",this.getDatesFromDate(t)[0]);var s=new o("TransactionCreatedDate","LE",this.getDatesFromDate(t)[1]);var i=new o({filters:[r,s],and:true});var n=[i];var d=[],u=[];var l=this.getModel("jama");var c=this.getModel("naam");this.getModel().read("/InventoryTransactions",{urlParameters:{$expand:"ProductDetails,CustomerDetails,CustomerDetails/CitycodeDetails"},filters:n,success:function(e){for(var t=0;t<e.results.length;t++){var a=e.results[t];if(a.InventoryTransactionType==1){var r={Id:a.Id,Date:a.TransactionCreatedDate,ProductCode:a.ProductDetails.ProductName,Category:a.ProductDetails.Category,Qty:a.Quantity,Weight:a.Weight,CustomerCode:a.CustomerDetails.FirstName,City:a.CustomerDetails.CitycodeDetails.Name,Remarks:a.Comments};d.push(r)}else{var s={Date:a.TransactionCreatedDate,ProductCode:a.ProductDetails.ProductName,Category:a.ProductDetails.Category,Qty:a.Quantity,Weight:a.Weight,CustomerCode:a.CustomerDetails.FirstName,City:a.CustomerDetails.CitycodeDetails.Name,Remarks:a.Comments};u.push(s)}}l.setProperty("/items",d);c.setProperty("/items",u)}})},loadDataInTables:function(){var e=this.getOwnerComponent().getModel();var t=[],a=[];var r=this.getModel("jama");var s=this.getModel("naam");var i=this.byId("dateEntry").getYyyymmdd();if(i==""){var n=new Date;var i=n.toISOString().slice(0,10).replace(/-/g,"")}this.globalDate=i;console.log(i);var d=this;var u=new o("TransactionCreatedDate","GE",this.getDatesFromDate(i)[0]);var l=new o("TransactionCreatedDate","LE",this.getDatesFromDate(i)[1]);var c=new o({filters:[u,l],and:true});var g=[c];e.read("/InventoryTransactions",{urlParameters:{$expand:"ProductDetails,CustomerDetails,CustomerDetails/CitycodeDetails"},filters:g,success:function(e){for(var o=0;o<e.results.length;o++){var i=e.results[o];if(i.InventoryTransactionType==1){var n={Id:i.Id,Date:i.TransactionCreatedDate,ProductCode:i.ProductDetails.ProductName,Category:i.ProductDetails.Category,Qty:i.Quantity,Weight:i.Weight,CustomerCode:i.CustomerDetails.FirstName,City:i.CustomerDetails.CitycodeDetails.Name,Remarks:i.Comments};t.push(n)}else{var d={Date:i.TransactionCreatedDate,ProductCode:i.ProductDetails.ProductName,Category:i.ProductDetails.Category,Qty:i.Quantity,Weight:i.Weight,CustomerCode:i.CustomerDetails.FirstName,City:i.CustomerDetails.CitycodeDetails.Name,Remarks:i.Comments};a.push(d)}}r.setProperty("/items",t);s.setProperty("/items",a)}})},getCurrentDateQuery:function(){var e=new Date;var t=e.getDate();var a=e.getMonth()+1;var r=e.getFullYear();if(t<10){t="0"+t}if(a<10){a="0"+a}var e=r+"-"+a+"-"+t+"T00:00:00";t=parseInt(t)+1;var s=r+"-"+a+"-"+t+"T00:00:00";return[e,s]},onNavBack:function(){var e=a.getInstance().getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(e!==undefined||!t.isInitialNavigation()){history.go(-1)}else{this.getRouter().navTo("worklist",{},true)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("Customers",{Id:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("objectView"),a=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),a=e.getElementBinding();if(!a.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var r=this.getResourceBundle(),s=e.getBindingContext().getObject(),o=s.Id,i=s.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",r.getText("saveAsTileTitle",[i]));t.setProperty("/shareOnJamTitle",i);t.setProperty("/shareSendEmailSubject",r.getText("shareSendEmailObjectSubject",[o]));t.setProperty("/shareSendEmailMessage",r.getText("shareSendEmailObjectMessage",[i,o,location.href]))}})});
//# sourceMappingURL=Inventory.controller.js.map