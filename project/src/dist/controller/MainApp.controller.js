sap.ui.define(["victoria/controller/BaseController"],function(e){"use strict";return e.extend("victoria.controller.MainApp",{idleLogout:function(){var e;var o=this;window.onbeforeunload=function(){o.logOutApp("X")};window.onload=r;window.onmousemove=r;window.onmousedown=r;window.ontouchstart=r;window.onclick=r;window.onkeypress=r;window.addEventListener("scroll",r,true);function t(){sap.m.MessageBox.alert("Page expired, please login again!");window.top.location.href="/"}function r(){clearTimeout(e);e=setTimeout(t,36e5)}},onLogout:function(){this.logOutApp()},onInit:function(){debugger;this.idleLogout();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this)},onSubmit:function(){this.Login()},onLivePassword:function(e){console.log("Test")},Login:function(e){debugger;var o={email:this.getView().byId("userid").getValue(),password:this.getView().byId("pwd").getValue()};var t=this;if(!o.email||!o.password){sap.m.MessageBox.error("User/password cannot be empty");return}debugger;$.post("/api/Users/login",o).done(function(e,o){debugger;t.getView().getModel("local").setProperty("/Authorization",e.id);t.getView().getModel().setHeaders({Authorization:e.id});t.secureToken=e.id;t.getView().getModel("local").setProperty("/CurrentUser",e.userId);t.getView().getModel().setUseBatch(false);var r=t;debugger;var i=[new sap.ui.model.Filter("TechnicalId",sap.ui.model.FilterOperator.EQ,e.userId)];var n={filters:i};var s=false;var a=[];t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/AppUsers","GET",{},{},t).then(function(o){if(o.results.length!=0){for(var t=0;t<o.results.length;t++){a[o.results[t].TechnicalId]=o.results[t];if(o.results[t].TechnicalId===e.userId){var i=o.results[t].Role;r.getView().getModel("local").setProperty("/Role",o.results[t].Role);r.getView().getModel("local").setProperty("/UserName",o.results[t].UserName);s=true}else{r.getView().getModel("local").setProperty("/Authorization","")}}if(s===true){r.getView().getModel("local").setProperty("/AppUsers",a);if(i==="Admin"){r.oRouter.navTo("Customers")}else if(i==="Content"){r.oRouter.navTo("dayBook")}else if(i==="Sales"){r.oRouter.navTo("sales")}else if(i==="Order"){r.oRouter.navTo("customerOrders")}else if(i==="Kacchi"){r.oRouter.navTo("Kacchi")}else if(i==="Booking"){r.oRouter.navTo("Suppliers")}else if(i==="Stock"){r.oRouter.navTo("Stock")}r.onDropDownSelect()}else{sap.m.MessageBox.error("The user is not authorized, Contact Anubhav")}}}).catch(function(e){})}).fail(function(e,o,t){sap.m.MessageBox.error("Login Failed, Please enter correct credentials")})},onDropDownSelect:function(e){debugger;var o=this.getView().byId("languageSelect").getSelectedKey();if(o==="Hi"){sap.ui.getCore().getConfiguration().setLanguage("Hi");window.navigator.browserLanguage="?sap-ui-language=hi";window.navigator.language="?sap-ui-language=hi"}}})});