sap.ui.define(["victoria/controller/BaseController"],function(e){"use strict";return e.extend("victoria.controller.MainApp",{idleLogout:function(){var e;var t=this;window.onbeforeunload=function(){t.logOutApp("X")};window.onload=n;window.onmousemove=n;window.onmousedown=n;window.ontouchstart=n;window.onclick=n;window.onkeypress=n;window.addEventListener("scroll",n,true);function o(){sap.m.MessageBox.alert("Page expired, please login again!");window.top.location.href="/"}function n(){clearTimeout(e);e=setTimeout(o,36e5)}},onLogout:function(){this.logOutApp()},onInit:function(){this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.idleLogout();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this)},onSubmit:function(){this.Login()},onLivePassword:function(e){console.log("Test")},Login:function(e){var t={email:this.getView().byId("userid").getValue(),password:this.getView().byId("pwd").getValue()};var o=this;if(!t.email||!t.password){sap.m.MessageBox.error("User/password cannot be empty");return}$.post("/api/Users/login",t).done(function(e,t){o.getOwnerComponent().getModel("local").setProperty("/AuthorizationToken",e.id);o.getView().getModel().setHeaders({Authorization:e.id});o.secureToken=e.id;o.getView().getModel("local").setProperty("/CurrentUser",e.userId);o.getView().getModel().setUseBatch(false);var n=o;var r=[new sap.ui.model.Filter("TechnicalId",sap.ui.model.FilterOperator.EQ,e.userId)];var a={filters:r};var i=false;var s=[];o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/CustomCalculations","GET",{},{},o).then(function(t){if(t.results.length>0){var o=n.getOwnerComponent().getModel("local").setProperty("/CustomCalculation",t.results[0]);if(t.results[0].hasOwnProperty("AMCDate")){if(t.results[0].AMCDate.toLocaleDateString()===(new Date).toLocaleDateString()||t.results[0].AMCDate<new Date){sap.m.MessageBox.error("Your Lience is expired,\n Please Renew Your Lience to continue using the Application");return}else{for(var r=1;r<=5;r++){var a=new Date(t.results[0].AMCDate);a.setDate(a.getDate()-r);if(a.toLocaleDateString()===(new Date).toLocaleDateString()){var i=n;sap.m.MessageBox.error("Your Lience is expired in "+r+" days",{onClose:function(t){i.navigation(e)}});return}}}}n.navigation(e)}}).catch(function(e){sap.m.MessageToast.show(n.resourceBundle.getText("Fetch11"))})}).fail(function(e,t,o){sap.m.MessageBox.error("Login Failed, Please enter correct credentials")})},navigation:function(e){var t=false;var o=this;var n=o;var r=[];o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/AppUsers","GET",{},{},o).then(function(o){if(o.results.length!=0){for(var a=0;a<o.results.length;a++){r[o.results[a].TechnicalId]=o.results[a];if(o.results[a].TechnicalId===e.userId){var i=o.results[a].Role;n.getView().getModel("local").setProperty("/Role",o.results[a].Role);n.getView().getModel("local").setProperty("/UserName",o.results[a].UserName);t=true}else{n.getView().getModel("local").setProperty("/Authorization","")}}if(t===true){n.getView().getModel("local").setProperty("/AppUsers",r);if(i==="Admin"){n.oRouter.navTo("Customers")}else if(i==="Content"){n.oRouter.navTo("dayBook")}else if(i==="Sales"){n.oRouter.navTo("sales")}else if(i==="Order"){n.oRouter.navTo("customerOrders")}else if(i==="Kacchi"){n.oRouter.navTo("Kacchi")}else if(i==="Booking"){n.oRouter.navTo("Suppliers")}else if(i==="Stock"){n.oRouter.navTo("Stock")}n.onDropDownSelect()}else{sap.m.MessageBox.error("The user is not authorized, Contact Anubhav")}}}).catch(function(e){})},onDropDownSelect:function(e){var t=this.getView().byId("languageSelect").getSelectedKey();if(t==="Hi"){sap.ui.getCore().getConfiguration().setLanguage("Hi");window.navigator.browserLanguage="?sap-ui-language=hi";window.navigator.language="?sap-ui-language=hi"}}})});