sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter","sap/m/MessageToast","sap/ui/model/Filter","victoria/libs/googletrans","victoria/libs/googletransapi"],function(e,t,r,a,o,i,d,s){"use strict";return e.extend("victoria.controller.Products",{formatter:a,onInit:function(){var e=this;var r=this.getModel("local").getProperty("/CurrentUser");var a=this.getModel("local").oData.AppUsers[r].UserName;a="Hey "+a;this.getView().byId("idUser").setText(a);this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var o,i=new t({Id:"",ProductCode:"",ProductName:"",Type:"",Karat:"",HindiName:"",Tunch:0,Wastage:0,CustomerTunch:0,AlertQuantity:0,Making:0,Category:"",PricePerUnit:0});var d=new t({items:[{text:"Silver"},{text:"Gold"},{text:"GS"}]});var s=new t({items:[{text:"gm"},{text:"pcs"}]});var n=new t({items:[{text:"22/20"},{text:"22/22"}]});this.setModel(i,"productModel");this.setModel(d,"fixed");this.setModel(s,"per");this.setModel(n,"Karat");var u=new t({buttonText:"Save",deleteEnabled:false,typeEnabled:false});this.setModel(u,"viewModel");var l=this.getRouter();l.getRoute("Products").attachMatched(this._onRouteMatched,this)},onPressMaterialDownload:function(){var e="Materials";window.open("/materialDownload?type=Materials")},onKeyPress:function(e){var t=e.getSource();t.setValue(t.getValue().toUpperCase())},toggleFullScreen:function(){var e="idFullScreenBtn";var t="__component0---idProducts--ProductHeader";this.toggleUiTable(e,t)},onAfterRendering:function(){google.load("elements","1",{packages:"transliteration"});var e={sourceLanguage:google.elements.transliteration.LanguageCode.ENGLISH,destinationLanguage:[google.elements.transliteration.LanguageCode.HINDI],shortcutKey:"ctrl+g",transliterationEnabled:true};var t=new google.elements.transliteration.TransliterationControl(e);t.makeTransliteratable(["__component0---idProducts--idHindi-inner"]);t.showControl("translControl");window.focus=this;this.getView().byId("idProductCode").attachBrowserEvent("focusout",r);function r(){var e=window.focus;var t=e.getView().getModel("productModel");var r=e.getView().byId("idProductCode").getValue();var a=new sap.ui.model.Filter("ProductCode","EQ",r);var o=e;e.ODataHelper.callOData(e.getOwnerComponent().getModel(),"/Products","GET",{filters:[a]},{},e).then(function(e){if(e.results.length>0){o.getView().byId("idProductCode").setValue(e.results[0].ProductCode);o.getView().byId("idProductName").setValue(e.results[0].ProductName);o.getView().byId("idType").setSelectedKey(e.results[0].Type);o.getView().byId("idKarat").setSelectedKey(e.results[0].Karat);o.getView().byId("idHindi").setValue(e.results[0].HindiName);o.getView().byId("idStandardCost").setValue(e.results[0].Tunch);o.getView().byId("idCustomerTunch").setValue(e.results[0].CustomerTunch);o.getView().byId("idReorderLevel").setValue(e.results[0].Wastage);o.getView().byId("idListPrice").setValue(e.results[0].CustomerTunch);o.getView().byId("idTargetLevel").setValue(e.results[0].AlertQuantity);o.getView().byId("idMinimumReorderQuantity").setValue(e.results[0].Making);o.getView().byId("idCustomerMaking").setValue(e.results[0].CustomerMaking);o.getView().byId("idCategory").setValue(e.results[0].Category);o.getView().byId("idPricePerUnit").setValue(e.results[0].MakingD);var r=o.getView().getModel("viewModel");var a=e.results[0];t.setProperty("/ProductCode",a.id);t.setProperty("/ProductName",a.ProductName);var i=o.getView().byId("idCategory");i.setSelectedKey(a.Category);t.setProperty("/Category",a.Category);var d=o.getView().byId("idType");d.setSelectedKey(a.Type);t.setProperty("/Type",a.Type);t.setProperty("/Making",a.Making);t.setProperty("/CustomerMaking",a.CustomerMaking);t.setProperty("/CustomerTunch",a.CustomerTunch);t.setProperty("/PricePerUnit",a.PricePerUnit);t.setProperty("/Wastage",a.Wastage);t.setProperty("/Tunch",a.Tunch);t.setProperty("/CustomerTunch",a.CustomerTunch);t.setProperty("/AlertQuantity",a.AlertQuantity);t.setProperty("/HindiName",a.HindiName);t.setProperty("/Id",a.id);if(a.Type==="Gold"){r.setProperty("/typeEnabled",true);t.setProperty("/Karat",a.Karat);var s=o.getView().byId("idKarat");s.setSelectedKey(a.Karat)}else{var n=o.getView().byId("idKarat");n.setSelectedKey("")}r.setProperty("/buttonText","Update");r.setProperty("/deleteEnabled",true);r.setProperty("/codeEnabled",false)}else{}}).catch(function(e){})}},onSelectChange:function(e){var t=e.getParameter("selectedItem").getText();this.getView().getModel("productModel").setProperty("/Karat",t)},onCatChange:function(e){var t=e.getParameter("selectedItem").getText();this.getView().getModel("productModel").setProperty("/Category",t)},onTypeChange:function(e){this.getView().byId("idHindi").focus();var t=e.getParameter("selectedItem").getText();var r=this.getView().getModel("viewModel");var a=this.getView().getModel("productModel");a.setProperty("/Type",t);if(t==="Gold"){r.setProperty("/typeEnabled",true);var o=this.getView().byId("idKarat").getSelectedKey();a.setProperty("/Karat",o)}else{r.setProperty("/typeEnabled",false);a.getProperty("/Karat");a.setProperty("/Karat","");var i=this.getView().byId("idKarat");i.setSelectedKey("")}},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_onRouteMatched:function(){var e=this;var r=this.getView().getModel("viewModel");r.setProperty("/codeEnabled",true);r.setProperty("/buttonText","Save");r.setProperty("/deleteEnabled",false);r.setProperty("/typeEnabled",false);var a=new t({ProductCodeState:"None"});this.setModel(a,"dataModel");this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products","GET",{},{},this).then(function(r){var a=new t;a.setData(r);e.getView().setModel(a,"productModelInfo")}).catch(function(t){o.show(e.resourceBundle.getText("ReqField"))});this.clearProduct()},additionalInfoValidation:function(){var e=this.getView().getModel("productModel");var t=this.getView().getModel("dataModel");if(e.getData().ProductCode===""){t.setProperty("/ProductCodeState","Error")}else{t.setProperty("/ProductCodeState","None")}if(e.getData().Type===""){var r=this.byId("idType").getSelectedKey();e.setProperty("/Type",r)}else{t.setProperty("/TypeState","None")}},ValueChangeMaterial:function(e){var t=e.getSource();var r=new sap.ui.model.Filter("ProductCode",sap.ui.model.FilterOperator.Contains,e.getParameter("suggestValue").toLocaleUpperCase());t.getBinding("suggestionItems").filter(r)},productCodeEnter:function(e){this.getView().byId("idProductName").focus();var r=this;var a=this.getView().getModel("productModel");var o=e.getParameter("value").toLocaleUpperCase();a.setProperty("/ProductCode",o);var i=new sap.ui.model.Filter("ProductCode","EQ",o);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products","GET",{filters:[i]},{},this).then(function(e){var i=new t;i.setData(e);var d=i.getData().results[0];var s=r.getView().getModel("viewModel");r.getView().byId("idProductCode").setValue(o);var n=r.getView().byId("idProductCode").getValue();if(d.id.length>0){a.setProperty("/ProductCode",d.id);a.setProperty("/ProductName",d.ProductName);var u=r.getView().byId("idCategory");u.setSelectedKey(d.Category);a.setProperty("/Category",d.Category);var l=r.getView().byId("idType");l.setSelectedKey(d.Type);a.setProperty("/Type",d.Type);a.setProperty("/Making",d.Making);a.setProperty("/CustomerMaking",d.CustomerMaking);a.setProperty("/CustomerTunch",d.CustomerTunch);a.setProperty("/PricePerUnit",d.PricePerUnit);a.setProperty("/Wastage",d.Wastage);a.setProperty("/Tunch",d.Tunch);a.setProperty("/CustomerTunch",d.CustomerTunch);a.setProperty("/AlertQuantity",d.AlertQuantity);a.setProperty("/HindiName",d.HindiName);a.setProperty("/Id",d.id);if(d.Type==="Gold"){s.setProperty("/typeEnabled",true);a.setProperty("/Karat",d.Karat);var g=r.getView().byId("idKarat");g.setSelectedKey(d.Karat)}else{var c=r.getView().byId("idKarat");c.setSelectedKey("")}s.setProperty("/buttonText","Update");s.setProperty("/deleteEnabled",true);s.setProperty("/codeEnabled",false);a.refresh()}else{a.getData().Category="";a.getData().Type="";a.getData().Karat="";a.getData().CustomerTunch=0;a.getData().Making=0;a.getData().ProductName="";a.getData().PricePerUnit=0;a.getData().Wastage=0;a.getData().Tunch=0;a.getData().AlertQuantity=0;a.getData().HindiName="";s.setProperty("/buttonText","Save");s.setProperty("/deleteEnabled",false);s.setProperty("/codeEnabled",false);r.additionalInfoValidation();r.getView().byId("idProductName").focus();a.refresh()}}).catch(function(e){})},productCodeCheck:function(e){var t=this.getView().getModel("productModel");var r=e.getParameter("selectedItem").getModel().getProperty(e.getParameter("selectedItem").getBindingContext().getPath());var a=r.ProductCode;var o=this.getView().getModel("viewModel");var i=this.getView().byId("idProductCode").getValue();var d=a;if(d.length>0){t.setProperty("/ProductCode",r.id);t.setProperty("/ProductName",r.ProductName);var s=this.getView().byId("idCategory");s.setSelectedKey(r.Category);t.setProperty("/Category",r.Category);var n=this.getView().byId("idType");n.setSelectedKey(r.Type);t.setProperty("/Type",r.Type);t.setProperty("/Making",r.Making);t.setProperty("/CustomerMaking",prodModInfo.CustomerMaking);t.setProperty("/CustomerTunch",r.CustomerTunch);t.setProperty("/PricePerUnit",r.PricePerUnit);t.setProperty("/Wastage",r.Wastage);t.setProperty("/Tunch",r.Tunch);t.setProperty("/CustomerTunch",r.CustomerTunch);t.setProperty("/AlertQuantity",r.AlertQuantity);t.setProperty("/HindiName",r.HindiName);t.setProperty("/Id",r.id);if(r.Type==="Gold"){o.setProperty("/typeEnabled",true);t.setProperty("/Karat",r.Karat)}else{var u=this.getView().byId("idKarat");u.setSelectedKey("")}o.setProperty("/buttonText","Update");o.setProperty("/deleteEnabled",true);o.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("idProductName").focus();t.refresh()}else{t.getData().Category="";t.getData().Type="";t.getData().Karat="";t.getData().CustomerTunch=0;t.getData().Making=0;t.getData().ProductName="";t.getData().PricePerUnit=0;t.getData().Wastage=0;t.getData().Tunch=0;t.getData().AlertQuantity=0;t.getData().HindiName="";o.setProperty("/buttonText","Save");o.setProperty("/deleteEnabled",false);o.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("idProductName").focus();t.refresh()}},onChange:function(e){var t=this.getView().byId("idStandardCost").getValue();var r=this.getView().byId("idReorderLevel").getValue();var a=this.getView().byId("idListPrice");a.setValue(+t+ +r)},onProductNameSubmit:function(){this.getView().byId("idType").focus()},onSubmitHindiName:function(){this.getView().byId("idStandardCost").focus();this.getView().byId("idStandardCost").$().find("input").select()},onSubmitStandardCost:function(){this.getView().byId("idReorderLevel").focus();this.getView().byId("idReorderLevel").$().find("input").select()},onSubmitReorderLevel:function(){this.getView().byId("idListPrice").focus();this.getView().byId("idListPrice").$().find("input").select()},onSubmitListPrice:function(){this.getView().byId("idTargetLevel").focus();this.getView().byId("idTargetLevel").$().find("input").select()},onSubmitTargetLevel:function(){this.getView().byId("idMinimumReorderQuantity").focus();this.getView().byId("idMinimumReorderQuantity").$().find("input").select()},onSubmitMinimumReorderQuantity:function(){this.getView().byId("idCategory").focus()},onSubmitCategory:function(){this.getView().byId("idPricePerUnit").focus();this.getView().byId("idPricePerUnit").$().find("input").select()},onSubmitPricePerUnit:function(){this.getView().byId("acceptButton").focus()},clearProduct:function(){var e=this.getView().getModel("productModel");var t=this.getView().getModel("viewModel");var r=this.getView().getModel("dataModel");var a=this.getView().getModel("fixed");var o=this.getView().byId("idCategory");o.setSelectedKey("");e.getData().Category="";e.getData().Type="";var i=this.getView().byId("idKarat");i.setSelectedKey("");e.getData().Id="";e.getData().ProductCode="";e.getData().CustomerTunch=0;e.getData().Making=0;e.getData().CustomerMaking=0;e.getData().ProductName="";e.getData().PricePerUnit=0;e.getData().Wastage=0;e.getData().Tunch=0;e.getData().AlertQuantity=0;e.getData().HindiName="";var d=this.getView().byId("idProductCode");d.setSelectedKey("");d.setValue("");var s=a.getData().items[0].text;var n=this.getView().byId("idType");n.setSelectedKey(s);t.setProperty("/codeEnabled",true);t.setProperty("/buttonText","Save");t.setProperty("/deleteEnabled",false);t.setProperty("/typeEnabled",false);r.setProperty("/ProductCode","None");e.refresh()},SaveProduct:function(e){var t=this;var r=t.getView().getModel("productModel");var a=r.getData().Id;var i=t.getView().byId("idProductCode").getValue();r.setProperty("/ProductCode",i);var d=r.getProperty("/ProductCode").toLocaleUpperCase();r.setProperty("/ProductCode",d);var s=r.getProperty("/Type");if(s===""){var n=this.getView().byId("idType").getSelectedKey();r.setProperty("/Type",n)}var u=r.getProperty("/Category");if(u===""){var l=this.getView().byId("idCategory").getSelectedKey();r.setProperty("/Category",l)}t.additionalInfoValidation();if(i===""){this.additionalInfoValidation();o.show(t.resourceBundle.getText("Fields"));return}if(a.length>0){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+a+"')","PUT",{},r.getData(),this).then(function(e){o.show(t.resourceBundle.getText("Data"));t.clearProduct()}).catch(function(e){o.show(t.resourceBundle.getText("Data1"))})}else{var g=new sap.ui.model.Filter("ProductCode","EQ",d);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products","GET",{filters:[g]},{},this).then(function(e){if(e.results.length>0){o.show(t.resourceBundle.getText("Product11"))}else{t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/Product","POST",{},r.getData(),t).then(function(e){o.show(t.resourceBundle.getText("Data"));t.clearProduct()}).catch(function(e){o.show(t.resourceBundle.getText("Data1"))})}}).catch(function(e){o.show(t.resourceBundle.getText("Data1"))})}},deleteProduct:async function(){var e=this;var t=this.getView().getModel("productModel");var r=t.getData().ProductCode;var a=this.getView().getModel("productModelInfo").getData().results;function o(e){return a.filter(function(t){return t.id===e})}var i=true;var e=this;var d=["/Entrys","/OrderItems","/WSOrderItems","/CustomerOrders"];var s=new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.Contains,"'"+r+"'");for(var n=0;n<d.length;n++){await this.ODataHelper.callOData(this.getOwnerComponent().getModel(),d[n],"GET",{filters:[s]},{},this).then(function(t){if(t.results.length>0){e.Errmsgprd();i=true}else{i=false}}).catch(function(t){var r=e.getErrorMessage(t)});if(i===true){break;e.getView().setBusy(false)}}if(i===false){this.deleteCnfProduct(r,t);this.getView().setBusy(false)}},Errmsgprd:function(){o.show(that.resourceBundle.getText("Product12"));this.getView().setBusy(false)},deleteCnfProduct:function(e,t){var r=this;sap.m.MessageBox.confirm("Do you want to delete Customer",{title:"Confirm",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],styleClass:"",onClose:function(a){if(a==="OK"){r.ODataHelper.callOData(r.getOwnerComponent().getModel(),"/Products('"+e+"')","DELETE",{},{},r).then(function(e){o.show(r.resourceBundle.getText("Delete1"));t.getData().Category="";t.getData().Type="";t.getData().Karat="";t.getData().CustomerTunch=0;t.getData().Making=0;t.getData().ProductCode="";t.getData().ProductName="";t.getData().PricePerUnit=0;t.getData().Wastage=0;t.getData().Tunch=0;t.getData().AlertQuantity=0;t.getData().HindiName="";t.refresh();r.clearProduct()}).catch(function(e){o.show(r.resourceBundle.getText("Delete2"))})}}})},selectedProduct:function(e){var t=e.getParameter("selectedItem");var r=t.getText();var a=t.getKey();var o=this;console.log(r);console.log(a);this.getModel().read("/Products("+a+")",{urlParameters:{$expand:"CategoryDetails"},success:function(e){o.getModel("productModel").setData(e);o.getModel("productModel").setProperty("/Category",e.CategoryDetails.Category)}})},onNavBack:function(){var e=r.getInstance().getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(e!==undefined||!t.isInitialNavigation()){history.go(-1)}else{this.getRouter().navTo("worklist",{},true)}},createNewProduct:function(){var e=this;var t={Description:this.byId("idDescription").getSelectedKey(),Discontinued:false,ListPrice:this.byId("idListPrice").getValue(),MinimumReorderQuantity:this.byId("idMinimumReorderQuantity").getValue(),ProductCode:this.byId("productInput").getValue(),ProductName:this.byId("idProductName").getValue(),QuantityPerUnit:this.byId("idQuantityPerUnit").getSelectedKey(),ReorderLevel:this.byId("idReorderLevel").getValue(),StandardCost:this.byId("idStandardCost").getValue(),SupplierIds:"0",TargetLevel:this.byId("idTargetLevel").getValue(),Hindi:this.byId("idHindi").getValue(),CategoryDetails:{__metadata:{uri:"http://localhost:8080/bhavysoft"+"/galaxyService.svc/Categorys("+this.getView().byId("idCategory").getSelectedKey()+")"}}};this.getModel().create("/Products",t,{success:function(){o.show(e.resourceBundle.getText("create1"))}})},updateProduct:function(){var e=this;var t={Description:this.byId("idDescription").getSelectedKey(),Discontinued:false,ListPrice:this.byId("idListPrice").getValue(),MinimumReorderQuantity:this.byId("idMinimumReorderQuantity").getValue(),ProductCode:this.byId("productInput").getValue(),ProductName:this.byId("idProductName").getValue(),QuantityPerUnit:this.byId("idQuantityPerUnit").getSelectedKey(),ReorderLevel:this.byId("idReorderLevel").getValue(),StandardCost:this.byId("idStandardCost").getValue(),SupplierIds:"0",TargetLevel:this.byId("idTargetLevel").getValue(),Hindi:this.byId("idHindi").getValue(),CategoryDetails:{__metadata:{uri:"http://localhost:8080/bhavysoft"+"/galaxyService.svc/Categorys("+this.getView().byId("idCategory").getSelectedKey()+")"}}};this.getModel().update("/Products("+e.getModel("productModel").getProperty("/Id")+")",t,{success:function(){o.show(e.resourceBundle.getText("Update1"))}})},clearValues:function(){this.getModel("productModel").setProperty("/Id","");this.getModel("productModel").setProperty("/Description","");this.getModel("productModel").setProperty("/ProductCode","");this.getModel("productModel").setProperty("/ProductName","");this.getModel("productModel").setProperty("/ListPrice",0);this.getModel("productModel").setProperty("/MinimumReorderQuantity",0);this.getModel("productModel").setProperty("/ReorderLevel",0);this.getModel("productModel").setProperty("/StandardCost",0);this.getModel("productModel").setProperty("/TargetLevel",500)},Save:function(){var e=this;var t=[];var r=new i("ProductCode","EQ",e.getModel("productModel").getProperty("/ProductCode"));t.push(r);this.getModel().read("/Products",{filters:t,success:function(t){if(t.results.length===0){e.createNewProduct()}else{e.updateProduct()}}})},Delete:function(){},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("Customers",{Id:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("objectView"),r=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){r.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),r=e.getElementBinding();if(!r.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var a=this.getResourceBundle(),o=e.getBindingContext().getObject(),i=o.Id,d=o.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",a.getText("saveAsTileTitle",[d]));t.setProperty("/shareOnJamTitle",d);t.setProperty("/shareSendEmailSubject",a.getText("shareSendEmailObjectSubject",[i]));t.setProperty("/shareSendEmailMessage",a.getText("shareSendEmailObjectMessage",[d,i,location.href]))}})});
//# sourceMappingURL=Products.controller.js.map