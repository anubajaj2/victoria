sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter"],function(e,t,i,o){"use strict";return e.extend("victoria.controller.Suppliers",{formatter:o,onInit:function(){this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var i,o=new t({busy:true,delay:0});var a=new t({items:[{text:"Silver"},{text:"Gold"}]});this.setModel(a,"fixed");debugger;e.prototype.onInit.apply(this);var g=this;var s=this.getModel("local").getProperty("/CurrentUser");var r=this.getModel("local").oData.AppUsers[s].UserName;r="Hey "+r;this.getView().byId("idUser").setText(r);var n=this.getRouter();n.getRoute("Suppliers").attachMatched(this._onRouteMatched,this)},valueHelpCustomer:function(e){this.getCustomerPopup(e)},onConfirm:function(e){if(e.getParameters().selectedItem.mBindingInfos.label.binding.sPath==="OrderNo"){this.setStatus("green");var t=this.getView().getModel("local").getProperty("/WSOrderHeader");var i=e.getParameter("selectedItem").getLabel();var o=e.getParameter("selectedItem").getBindingContextPath().split("'")[1];this.getView().getModel("local").setProperty("/WSOrderHeader/OrderNo",i);var a=this.getView().getModel("local").getProperty("/OrderId");a.OrderId=o;a.OrderNo=i;this.getView().getModel("local").setProperty("/OrderId",a);if(t.Customer){var g=new sap.ui.model.Filter("Customer","EQ","'"+t.Customer+"'")}else{var g=new sap.ui.model.Filter("Customer","EQ","'"+"")}e.sId="orderReload";this.getOrderDetails(e,o,g,i);this.orderSearchPopup.destroyItems()}else{var s=e.getParameter("selectedItem").getId();var r=this.getView().getModel("local").getProperty("/BookingCustomer");var n=s.split("-"[0]);var l=e.getParameter("selectedItem").getModel().getProperty(e.getParameter("selectedItem").getBindingContextPath());this.getView().getModel("local").setProperty("/selectedCustomer",l);var d=e.getParameter("selectedItem").getLabel();var c=e.getParameter("selectedItem").getValue();this.getView().getModel("local").setProperty("/BookingDetail/Customer",e.getParameter("selectedItem").getBindingContextPath().split("'")[1]);this.getView().getModel("local").setProperty("/BookingCustomer/CustomerId",d);this.getView().getModel("local").setProperty("/BookingCustomer/CustomerName",c);this.getView().byId("idCustomerCode").setValueState("None")}},_onRouteMatched:function(){var e=this;e.getView().getModel("local").setProperty("/BookingDetail/BookingDate",new Date);this.getView().byId("DateId").setDateValue(new Date);var t=this.getView().getModel("local").getProperty("/BookingDetail");if(this.getView().byId("idRb1").getSelected()){t.Type="Silver"}else{t.Type="Gold"}var i=new sap.ui.model.Filter("Type","EQ",t.Type);this.getView().byId("idTable").getBinding("items").filter(i);this.getView().byId("idBookingDlvTable").getBinding("items").filter(i)},onRadioButtonSelect:function(e){debugger;this.getView().byId("idQnty").setValue("");this.getView().byId("idBhav").setValue("");this.getView().byId("idAdvance").setValue("");this.getView().byId("idBTQ").setText("");this.getView().byId("idBAP").setText("");this.getView().byId("idDTQ").setText("");this.getView().byId("idDAP").setText("");var t=this.getView().getModel("local").getProperty("/BookingDetail");if(this.getView().byId("idRb1").getSelected()){t.Type="Silver"}else{t.Type="Gold"}if(t.Customer===""){var i=new sap.ui.model.Filter("Type","EQ",t.Type);this.getView().byId("idTable").getBinding("items").filter(i);this.getView().byId("idBookingDlvTable").getBinding("items").filter(i)}else{var o=new sap.ui.model.Filter("Customer","EQ","'"+t.Customer.split("'")+"'");var i=new sap.ui.model.Filter("Type","EQ",t.Type);var a=new sap.ui.model.Filter({filters:[o,i],and:true});this.getView().byId("idTable").getBinding("items").filter([a]);this.getView().byId("idBookingDlvTable").getBinding("items").filter([a]);var g=this;$.post("/getTotalBookingCustomer",{myData:t}).then(function(e){console.log(e);debugger;if(t.Type="Silver"){g.byId("idBTQ").setText(parseFloat(e.BookedQtyTotal.toFixed(3)))}else{g.byId("idBTQ").setText(parseFloat(e.BookedQtyTotal.toFixed(2)))}g.byId("idBTQ").getText();parseFloat(g.byId("idBTQ").getText());if(parseFloat(g.byId("idBTQ").getText())>0){g.byId("idBTQ").setState("Success");debugger}else{g.byId("idBTQ").setState("Warning")}g.byId("idBAP").setText(parseFloat(e.BookedAvgPriceTotal.toFixed(0)));g.byId("idBAP").getText();parseFloat(g.byId("idBAP").getText());if(parseFloat(g.byId("idBAP").getText())>0){g.byId("idBAP").setState("Success");debugger}else{g.byId("idBAP").setState("Warning")}});var s=g;$.post("/getTotalDeliveredCustomer",{myData:t}).then(function(e){console.log(e);debugger;if(t.Type="Silver"){s.byId("idDTQ").setText(parseFloat(e.DeliveredQtyTotal.toFixed(3)))}else{s.byId("idDTQ").setText(parseFloat(e.DeliveredQtyTotal.toFixed(2)))}s.byId("idDTQ").getText();if(parseFloat(g.byId("idDTQ").getText())>0){s.byId("idDTQ").setState("Success");debugger}else{s.byId("idDTQ").setState("Warning")}s.byId("idDAP").setText(parseFloat(e.DeliveredAvgPriceTotal.toFixed(0)));s.byId("idDAP").getText();if(parseFloat(g.byId("idDAP").getText())>0){s.byId("idDAP").setState("Success");debugger}else{s.byId("idDAP").setState("Warning")}})}},customerCodeCheck:function(e){$(function(){$("input:text:first").focus();var e=$("input:text");e.bind("keydown",function(t){var i=t.which;if(i==13){t.preventDefault();var o=e.index(this)+1;$(":input:text:eq("+o+")").focus()}})});var t=e.getParameter("selectedItem");if(!t){return}var i=t.getModel().getProperty(e.getParameter("selectedItem").getBindingContext().getPath());var o=i.Name.toUpperCase();this.getView().byId("idCustName").setText(o);var a=this.getView().getModel("local").getProperty("/BookingDetail");a.Customer=e.getParameter("selectedItem").getBindingContext().sPath.split("'")[1];if(this.getView().byId("idRb1").getSelected()){a.Type="Silver"}else{a.Type="Gold"}var g=new sap.ui.model.Filter("Customer","EQ","'"+a.Customer+"'");var s=new sap.ui.model.Filter("Type","EQ",a.Type);var r=new sap.ui.model.Filter({filters:[g,s],and:true});this.getView().byId("idTable").getBinding("items").filter([r]);this.getView().byId("idBookingDlvTable").getBinding("items").filter([r]);debugger;jQuery.sap.delayedCall(500,this,function(){this.getView().byId("idQnty").focus()});var n=this;$.post("/getTotalBookingCustomer",{myData:a}).then(function(e){console.log(e);debugger;if(a.Type="Silver"){n.byId("idBTQ").setText(parseFloat(e.BookedQtyTotal.toFixed(3)))}else{n.byId("idBTQ").setText(parseFloat(e.BookedQtyTotal.toFixed(2)))}n.byId("idBTQ").getText();parseFloat(n.byId("idBTQ").getText());if(parseFloat(n.byId("idBTQ").getText())>0){n.byId("idBTQ").setState("Success");debugger}else{n.byId("idBTQ").setState("Warning")}n.byId("idBAP").setText(parseFloat(e.BookedAvgPriceTotal.toFixed(0)));n.byId("idBAP").getText();parseFloat(n.byId("idBAP").getText());if(parseFloat(n.byId("idBAP").getText())>0){n.byId("idBAP").setState("Success");debugger}else{n.byId("idBAP").setState("Warning")}});var l=n;$.post("/getTotalDeliveredCustomer",{myData:a}).then(function(e){console.log(e);debugger;if(a.Type="Silver"){l.byId("idDTQ").setText(parseFloat(e.DeliveredQtyTotal.toFixed(3)))}else{l.byId("idDTQ").setText(parseFloat(e.DeliveredQtyTotal.toFixed(2)))}l.byId("idDTQ").getText();if(parseFloat(n.byId("idDTQ").getText())>0){l.byId("idDTQ").setState("Success");debugger}else{l.byId("idDTQ").setState("Warning")}n.byId("idDAP").setText(parseFloat(e.DeliveredAvgPriceTotal.toFixed(0)));l.byId("idDAP").getText();if(parseFloat(n.byId("idDAP").getText())>0){l.byId("idDAP").setState("Success");debugger}else{l.byId("idDAP").setState("Warning")}})},onValueHelpRequest:function(e){this.getCustomerPopup(e)},onClear:function(){debugger;var e=this.getView().byId("idCustomerCode");e.setSelectedKey("");e.setValue("");this.getView().byId("idCustName").setText("");this.getView().byId("idQnty").setValue("");this.getView().byId("idBhav").setValue("");this.getView().byId("idAdvance").setValue("");this.getView().byId("idBTQ").setText("");this.getView().byId("idBAP").setText("");this.getView().byId("idDTQ").setText("");this.getView().byId("idDAP").setText("");this.getView().byId("DateId").setDateValue(new Date);var t=new sap.ui.model.Filter("Type","EQ","Silver");this.getView().byId("idTable").getBinding("items").filter(t);this.getView().byId("idBookingDlvTable").getBinding("items").filter(t)},_getDialog:function(e){if(!this.oEditDialog){this.oEditDialog=sap.ui.xmlfragment("BookingDialog","victoria.fragments.BookingDialog",this);this.getView().addDependent(this.oEditDialog)}this.oEditDialog.open();if(e==="idTitle"){var t="idTable";sap.ui.getCore().byId("BookingDialog--save1").setVisible(true);sap.ui.getCore().byId("BookingDialog--save2").setVisible(false)}else{var t="idBookingDlvTable";sap.ui.getCore().byId("BookingDialog--save1").setVisible(false);sap.ui.getCore().byId("BookingDialog--save2").setVisible(true)}debugger;var i=this.getView().byId(t).getSelectedItem().mAggregations.cells[1].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialog-title").setText(i);var o=this.getView().byId(t).getSelectedItem().mAggregations.cells[0].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialogDate").setValue(o);var a=this.getView().byId(t).getSelectedItem().mAggregations.cells[1].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialogCust").setValue(a);var g=this.getView().byId(t).getSelectedItem().mAggregations.cells[2].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialogQnty").setValue(g);var s=this.getView().byId(t).getSelectedItem().mAggregations.cells[3].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialogBhav").setValue(s);var r=this.getView().byId(t).getSelectedItem().mAggregations.cells[4].mProperties.text;sap.ui.getCore().byId("BookingDialog--idDialogAdv").setValue(r)},_getDialogMove:function(e){if(!this.oDialog){this.oDialog=sap.ui.xmlfragment("BookingDialogMove","victoria.fragments.BookingDialogMove",this);this.getView().addDependent(this.oDialog)}debugger;var t=this.getOwnerComponent().byId("idSuppliers").byId("idTable").getSelectedItems();var i=t[0];if(!i){sap.m.MessageToast.show(that.resourceBundle.getText("Please11"));that.getView().setBusy(false);return}this.oDialog.open();sap.ui.getCore().byId("BookingDialogMove--cnf").setVisible(true);sap.ui.getCore().byId("BookingDialogMove--ret").setVisible(false);var o=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[0].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogDate").setValue(o).setVisible(false);var a=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[1].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogCust").setValue(a).setVisible(false);var g=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[2].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogQnty").setValue(g);var s=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[3].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogBhav").setValue(s).setVisible(false);var r=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[4].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogAdv").setValue(r).setVisible(false);var n=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[5].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogTyp").setValue(n).setVisible(false)},_getDialogLeftMove:function(e){if(!this.oDialog){this.oDialog=sap.ui.xmlfragment("BookingDialogMove","victoria.fragments.BookingDialogMove",this);this.getView().addDependent(this.oDialog)}var t=this.getOwnerComponent().byId("idSuppliers").byId("idBookingDlvTable").getSelectedItems();var i=t[0];if(!i){sap.m.MessageToast.show(that.resourceBundle.getText("Please11"));that.getView().setBusy(false);return}this.oDialog.open();debugger;sap.ui.getCore().byId("BookingDialogMove--cnf").setVisible(false);sap.ui.getCore().byId("BookingDialogMove--ret").setVisible(true);var o=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[0].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogDate").setValue(o).setVisible(false);var a=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[1].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogCust").setValue(a).setVisible(false);var g=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[2].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogQnty").setValue(g);var s=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[3].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogBhav").setValue(s).setVisible(false);var r=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[4].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogAdv").setValue(r).setVisible(false);var n=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[5].mProperties.text;sap.ui.getCore().byId("BookingDialogMove--idDialogTyp").setValue(n).setVisible(false)},onPressHandleDlvConfirmPopup:function(e){debugger;var t=this;t.getView().setBusy(true);var i=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];var o=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[2].mProperties.text;var a=sap.ui.getCore().byId("BookingDialogMove--idDialogQnty").getValue();debugger;if(parseInt(a)>parseInt(o)){sap.m.MessageToast.show(t.resourceBundle.getText("Delivery11"))}else{var g=this.getView().byId("idTable").getSelectedItem();var s="'"+g.getBindingContext().getObject().id+"'";var r=new sap.ui.model.Filter("Recid","EQ",s);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails","GET",{filters:[r]},{},this).then(function(e){debugger;if(e.results.length>0){t.insertDlvDetails(g,a,o,e)}else{var i=g.getBindingContext().getObject().Recid;var s=new sap.ui.model.Filter("Recid","EQ",i);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/BookingDlvDetails","GET",{filters:[s]},{},t).then(function(e){debugger;if(e.results.length>0){t.insertDlvDetails(g,a,o,e)}else{t.appendDlvDetails(g,a,o)}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}},insertDlvDetails:function(e,t,i,o){var a=this;var g=this.getView().getModel("local").getProperty("/BookingDlvDetail");g.BookingDate=e.getBindingContext().getObject().BookingDate;g.Customer=e.getBindingContext().getObject().Customer;g.Quantity=parseInt(o.results[0].Quantity)+parseInt(t);g.Bhav=e.mAggregations.cells[3].mProperties.text;g.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;if(e.getBindingContext().getObject().Recid!="null"){g.Recid=e.getBindingContext().getObject().Recid}else{g.Recid="'"+e.getBindingContext().getObject().id+"'"}var s=o.results[0].id;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails('"+s+"')","PUT",{},g,this).then(function(o){a.getView().setBusy(false);sap.m.MessageToast.show(a.resourceBundle.getText("Delivery12"));var s=a.getView().getModel("local").getProperty("/BookingDetail");var r=e.getBindingContext().getObject().id;var n=parseInt(i)-parseInt(t);if(n>0){s.BookingDate=e.getBindingContext().getObject().BookingDate;s.Quantity=parseInt(i)-parseInt(t);s.Bhav=e.mAggregations.cells[3].mProperties.text;s.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;s.Customer=e.getBindingContext().getObject().Customer;a.ODataHelper.callOData(a.getOwnerComponent().getModel(),"/BookingDetails('"+r+"')","PUT",{},s,a).then(function(e){a.onClear()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}else{var l=e;debugger;var d=l.getBindingContext().sPath;a.ODataHelper.callOData(a.getOwnerComponent().getModel(),d,"DELETE",{},{},a)}a.oDialog.close()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})},appendDlvDetails:function(e,t,i){var o=this;var a=this.getView().getModel("local").getProperty("/BookingDlvDetail");a.BookingDate=e.getBindingContext().getObject().BookingDate;a.Customer=e.getBindingContext().getObject().Customer;a.Quantity=t;a.Bhav=e.mAggregations.cells[3].mProperties.text;a.Advance=e.mAggregations.cells[4].mProperties.text;a.Type=e.mAggregations.cells[5].mProperties.text;if(e.getBindingContext().getObject().Recid!="null"){a.Recid=e.getBindingContext().getObject().Recid}else{a.Recid="'"+e.getBindingContext().getObject().id+"'"}this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails","POST",{},a,this).then(function(a){o.getView().setBusy(false);sap.m.MessageToast.show(o.resourceBundle.getText("Delivery12"));var g=o.getView().getModel("local").getProperty("/BookingDetail");var s=e.getBindingContext().getObject().id;var r=parseInt(i)-parseInt(t);if(r>0){g.BookingDate=e.getBindingContext().getObject().BookingDate;g.Quantity=parseInt(i)-parseInt(t);g.Bhav=e.mAggregations.cells[3].mProperties.text;g.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;g.Recid=e.getBindingContext().getObject().Recid;g.Customer=e.getBindingContext().getObject().Customer;o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/BookingDetails('"+s+"')","PUT",{},g,o).then(function(e){o.onClear()}).catch(function(e){o.getView().setBusy(false);var t=o.getErrorMessage(e)})}else{var n=e;debugger;var l=n.getBindingContext().sPath;o.ODataHelper.callOData(o.getOwnerComponent().getModel(),l,"DELETE",{},{},o)}o.oDialog.close()}).catch(function(e){o.getView().setBusy(false);var t=o.getErrorMessage(e)})},onPressHandleDlvReturnPopup:function(e){debugger;var t=this;t.getView().setBusy(true);var i=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];var o=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[2].mProperties.text;var a=sap.ui.getCore().byId("BookingDialogMove--idDialogQnty").getValue();debugger;if(parseInt(a)>parseInt(o)){sap.m.MessageToast.show(t.resourceBundle.getText("Delivery13"))}else{var g=this.getView().byId("idBookingDlvTable").getSelectedItem();debugger;var s=g.getBindingContext().getObject().Recid;var r=new sap.ui.model.Filter("id","EQ",s);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails","GET",{filters:[r]},{},this).then(function(e){debugger;if(e.results.length>0){t.insertDetails(g,a,o,e)}else{var i=new sap.ui.model.Filter("Recid","EQ",s);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/BookingDetails","GET",{filters:[i]},{},t).then(function(e){debugger;if(e.results.length>0){t.insertDetails(g,a,o,e)}else{t.appendDetails(g,a,o)}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}},onSuggest:function(e){debugger;const t=e.key;var i=e.getParameter("id").split("--")[2];var o=e.getParameter("suggestValue");if(o===""||t==8||t==="Backspace"||t==="Delete"){this.getView().byId("idCustomerCode").setValue("");return}if(!o){o=e.getParameter("newValue")}if(o){var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,o.toUpperCase()),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,o.toUpperCase())],and:false})}e.getSource().getBinding("suggestionItems").filter(a);var g=new sap.ui.model.Sorter({path:"CustomerCode",descending:false});e.getSource().getBinding("suggestionItems").sort(g);this.getView().byId("idCustomerCode").setValue(o)},insertDetails:function(e,t,i,o){var a=this;var g=this.getView().getModel("local").getProperty("/BookingDetail");g.BookingDate=e.getBindingContext().getObject().BookingDate;g.Customer=e.getBindingContext().getObject().Customer;g.Quantity=parseInt(o.results[0].Quantity)+parseInt(t);g.Bhav=e.mAggregations.cells[3].mProperties.text;g.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;g.Recid=e.getBindingContext().getObject().Recid;var s=o.results[0].id;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails('"+s+"')","PUT",{},g,this).then(function(o){a.getView().setBusy(false);sap.m.MessageToast.show(a.resourceBundle.getText("Delivery14"));var g=a.getView().getModel("local").getProperty("/BookingDlvDetail");var s=a.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];var r=parseInt(i)-parseInt(t);if(r>0){g.BookingDate=e.getBindingContext().getObject().BookingDate;g.Quantity=parseInt(i)-parseInt(t);g.Bhav=e.mAggregations.cells[3].mProperties.text;g.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;g.Customer=e.getBindingContext().getObject().Customer;g.Recid=e.getBindingContext().getObject().Recid;a.ODataHelper.callOData(a.getOwnerComponent().getModel(),"/BookingDlvDetails('"+s+"')","PUT",{},g,a).then(function(e){a.onClear()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}else{var n=e;debugger;var l=n.getBindingContext().sPath;a.ODataHelper.callOData(a.getOwnerComponent().getModel(),l,"DELETE",{},{},a)}a.oDialog.close()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})},appendDetails:function(e,t,i){var o=this;var a=this.getView().getModel("local").getProperty("/BookingDetail");a.BookingDate=e.getBindingContext().getObject().BookingDate;a.Customer=e.getBindingContext().getObject().Customer;a.Quantity=t;a.Bhav=e.mAggregations.cells[3].mProperties.text;a.Advance=e.mAggregations.cells[4].mProperties.text;a.Type=e.mAggregations.cells[5].mProperties.text;a.Recid=e.getBindingContext().getObject().Recid;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails","POST",{},a,this).then(function(a){o.getView().setBusy(false);sap.m.MessageToast.show(o.resourceBundle.getText("Delivery14"));var g=o.getView().getModel("local").getProperty("/BookingDlvDetail");var s=o.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];var r=parseInt(i)-parseInt(t);if(r>0){g.BookingDate=e.getBindingContext().getObject().BookingDate;g.Quantity=parseInt(i)-parseInt(t);g.Bhav=e.mAggregations.cells[3].mProperties.text;g.Advance=e.mAggregations.cells[4].mProperties.text;g.Type=e.mAggregations.cells[5].mProperties.text;g.Customer=e.getBindingContext().getObject().Customer;g.Recid=e.getBindingContext().getObject().Recid;o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/BookingDlvDetails('"+s+"')","PUT",{},g,o).then(function(e){o.onClear()}).catch(function(e){o.getView().setBusy(false);var t=o.getErrorMessage(e)})}else{var n=e;debugger;var l=n.getBindingContext().sPath;o.ODataHelper.callOData(o.getOwnerComponent().getModel(),l,"DELETE",{},{},o)}o.oDialog.close()}).catch(function(e){o.getView().setBusy(false);var t=o.getErrorMessage(e)})},onPressHandleEntrySavePopup:function(e){debugger;var t=this;t.getView().setBusy(true);var i=this.getView().getModel("local").getProperty("/BookingDetail");var o=this.getView().byId("idTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];i.BookingDate=sap.ui.getCore().byId("BookingDialog--idDialogDate").getValue();i.Quantity=sap.ui.getCore().byId("BookingDialog--idDialogQnty").getValue();i.Bhav=sap.ui.getCore().byId("BookingDialog--idDialogBhav").getValue();i.Advance=sap.ui.getCore().byId("BookingDialog--idDialogAdv").getValue();i.Customer=this.getView().byId("idTable").getSelectedItems()[0].getBindingContext().getObject().Customer;i.Recid=this.getView().byId("idTable").getSelectedItems()[0].getBindingContext().getObject().Recid;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails('"+o+"')","PUT",{},i,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Update111"));t.oEditDialog.close()}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},onPressHandleDlvEntrySavePopup:function(e){debugger;var t=this;t.getView().setBusy(true);var i=this.getView().getModel("local").getProperty("/BookingDlvDetail");var o=this.getView().byId("idBookingDlvTable").getSelectedItem().mAggregations.cells[1].mBindingInfos.text.binding.oContext.sPath.split("'")[1];i.BookingDate=sap.ui.getCore().byId("BookingDialog--idDialogDate").getValue();i.Quantity=sap.ui.getCore().byId("BookingDialog--idDialogQnty").getValue();i.Bhav=sap.ui.getCore().byId("BookingDialog--idDialogBhav").getValue();i.Advance=sap.ui.getCore().byId("BookingDialog--idDialogAdv").getValue();i.Customer=this.getView().byId("idBookingDlvTable").getSelectedItems()[0].getBindingContext().getObject().Customer;i.Recid=this.getView().byId("idBookingDlvTable").getSelectedItems()[0].getBindingContext().getObject().Recid;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails('"+o+"')","PUT",{},i,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Update111"));t.oEditDialog.close()}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},onPressHandleEntryCancelPopup:function(){this.oEditDialog.close()},onPressHandleCancelMovePopup:function(){this.oDialog.close()},onDelete:function(){var e=this;sap.m.MessageBox.confirm("Deleting Selected Records",{title:"Confirm",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],styleClass:"",onClose:function(t){debugger;if(t==="OK"){debugger;var i=e.getView().byId("idTable").getSelectedItems();if(i.length){for(var o=0;o<i.length;o++){debugger;var a=i[o].getBindingContext().sPath;e.ODataHelper.callOData(e.getOwnerComponent().getModel(),a,"DELETE",{},{},e)}}sap.m.MessageToast.show(e.resourceBundle.getText("SelectedData1"))}}})},onBookingDlvDelete:function(e){var t=this;sap.m.MessageBox.confirm(t.resourceBundle.getText("DELETE11"),{title:"Confirm",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],styleClass:"",onClose:function(e){debugger;if(e==="OK"){debugger;var i=t.getView().byId("idBookingDlvTable").getSelectedItems();if(i.length){for(var o=0;o<i.length;o++){debugger;var a=i[o].getBindingContext().sPath;t.ODataHelper.callOData(t.getOwnerComponent().getModel(),a,"DELETE",{},{},t)}}sap.m.MessageToast.show(t.resourceBundle.getText("SelectedData1"))}}})},onNameChange:function(e){debugger;var t=e.getParameter("value");this.getView().byId("idCustName").setText(t)},onSend:function(){debugger;var e=this;e.getView().setBusy(true);var t=this.getView().getModel("local").getProperty("/BookingDetail");if(t){t.id="";t.Recid="null";t.CreatedBy="";t.ChangedBy="";t.CreatedOn="";t.CreatedBy="";delete t.ToCustomers}debugger;if(this.getView().byId("idRb1").getSelected()){t.Type="Silver"}else if(this.getView().byId("idRb2").getSelected()){t.Type="Gold"}t.BookingDate=this.getView().byId("DateId").getDateValue();t.Quantity=this.getView().byId("idQnty").getValue();t.Bhav=this.getView().byId("idBhav").getValue();t.Advance=this.getView().byId("idAdvance").getValue();if(t.Customer===""||t.BookingDate===""||t.Quantity===""||t.Bhav===""||t.Type===""){sap.m.MessageToast.show(e.resourceBundle.getText("Fill11"));e.getView().setBusy(false)}else{if(t.Type==="Silver"&&(t.Bhav<"25000"||t.Bhav>"90000")){sap.m.MessageToast.show(e.resourceBundle.getText("Fill12"));e.getView().setBusy(false)}else if(t.Type==="Gold"&&(t.Bhav<"25000"||t.Bhav>"70000")){sap.m.MessageToast.show(e.resourceBundle.getText("Fill13"));e.getView().setBusy(false)}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails","POST",{},t,this).then(function(t){e.getView().setBusy(false);sap.m.MessageToast.show(e.resourceBundle.getText("dataSave"));if(!e.getView().byId("idBCkBx").getSelected()){e.onClear()}else{e.getView().byId("idQnty").setValue("");e.getView().byId("idBhav").setValue("");e.getView().byId("idAdvance").setValue("")}}).catch(function(t){e.getView().setBusy(false);var i=e.getErrorMessage(t)})}}},onBookingReportDownload:function(){debugger;var e=this.getView().byId("idRb").getSelectedButton().getText();var t=this.getView().getModel("local").getProperty("/selectedCustomer");var i="Booking_Summary";var o=t.id;var a=t.Name;window.open("/bookingDownload?type=Booking_Summary&id="+o+"&name="+a+"&type1="+e)},onUpdateFinished:function(e){debugger;var t=e.getSource();var i=t.getItems();var o=i.length;var a;var g;var s;debugger;for(var r=0;r<o;r++){debugger;var n=t.getItems()[r].getBindingContext().getObject().Customer;var l=this.allMasterData.customers[n];t.getItems()[r].getCells()[1].setText(l.CustomerCode+" - "+l.Name)}},onEdit:function(e){debugger;var t=e.getSource().getParent().getContent()[0].getId().split("--")[2];if(t==="idTitle"){var i=this.getView().byId("idTable").getSelectedItems().length;if(i>1){sap.m.MessageBox.alert(that.resourceBundle.getText("Selectoneentryonly"))}else{this._getDialog(t)}}else{var i=this.getView().byId("idBookingDlvTable").getSelectedItems().length;if(i>1){sap.m.MessageBox.alert(that.resourceBundle.getText("Selectoneentryonly"))}else{this._getDialog(t)}}},onBookingDlvEdit:function(e){debugger;var t=e.getSource().getParent().getContent()[0].getId().split("--")[2];var i=this.getView().byId("idBookingDlvTable").getSelectedItems().length;if(i>1){sap.m.MessageBox.alert(that.resourceBundle.getText("Selectoneentryonly"))}else{this._getDialogDlv()}},onRightArrowPress:function(e){var e=this.getView().byId("idTable").getSelectedItems().length;if(e>1){sap.m.MessageBox.alert(that.resourceBundle.getText("Selectoneentryonly"))}else{this._getDialogMove()}},onLeftArrowPress:function(e){this._getDialogLeftMove()},onMaterialSelect:function(e){debugger;var t=this.getView().getModel("local").getProperty("/demoData");t.Material=e.getParameter("selectedItem").getKey();this.getView().getModel("local").setProperty("/demoData",t)},onNavBack:function(){var e=i.getInstance().getPreviousHash(),t=sap.ushell.Container.getService("CrossApplicationNavigation");if(e!==undefined||!t.isInitialNavigation()){history.go(-1)}else{this.getRouter().navTo("worklist",{},true)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("Customers",{Id:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("objectView"),i=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){i.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},toggleFullScreen:function(){debugger;var e="idFullScreenBtn";var t="__component0---idSuppliers--BookingHeader";this.toggleUiTable(e,t)},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),i=e.getElementBinding();if(!i.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var o=this.getResourceBundle(),a=e.getBindingContext().getObject(),g=a.Id,s=a.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",o.getText("saveAsTileTitle",[s]));t.setProperty("/shareOnJamTitle",s);t.setProperty("/shareSendEmailSubject",o.getText("shareSendEmailObjectSubject",[g]));t.setProperty("/shareSendEmailMessage",o.getText("shareSendEmailObjectMessage",[s,g,location.href]))},onDropBookingDeliveryTable:function(e){debugger;var t=this;t.getView().setBusy(true);var i=e.getParameter("draggedControl");var o=i.getBindingContext();if(!o){sap.m.MessageToast.show(t.resourceBundle.getText("Please11"));t.getView().setBusy(false);return}var a="'"+i.getBindingContext().getObject().id+"'";var g=new sap.ui.model.Filter("Recid","EQ",a);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails","GET",{filters:[g]},{},this).then(function(e){debugger;if(e.results.length>0){t.insertDragDlvDetails(i,e)}else{var o=i.getBindingContext().getObject().Recid;var a=new sap.ui.model.Filter("Recid","EQ",o);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/BookingDlvDetails","GET",{filters:[a]},{},t).then(function(e){debugger;if(e.results.length>0){t.insertDragDlvDetails(i,e)}else{t.appendDragDlvDetails(i)}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},insertDragDlvDetails:function(e,t){var i=this;var o=this.getView().getModel("local").getProperty("/BookingDlvDetail");o.BookingDate=e.getBindingContext().getObject().BookingDate;o.Customer=e.getBindingContext().getObject().Customer;o.Quantity=parseInt(e.mAggregations.cells[2].mProperties.text)+parseInt(t.results[0].Quantity);o.Bhav=e.mAggregations.cells[3].mProperties.text;o.Advance=e.mAggregations.cells[4].mProperties.text;o.Type=e.mAggregations.cells[5].mProperties.text;if(e.getBindingContext().getObject().Recid!="null"){o.Recid=e.getBindingContext().getObject().Recid}else{o.Recid="'"+e.getBindingContext().getObject().id+"'"}var a=t.results[0].id;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails('"+a+"')","PUT",{},o,this).then(function(t){i.getView().setBusy(false);sap.m.MessageToast.show(i.resourceBundle.getText("Delivery12"));var o=e;debugger;var a=o.getBindingContext().sPath;i.ODataHelper.callOData(i.getOwnerComponent().getModel(),a,"DELETE",{},{},i)}).catch(function(e){i.getView().setBusy(false);var t=i.getErrorMessage(e)})},appendDragDlvDetails:function(e){var t=this;var i=this.getView().getModel("local").getProperty("/BookingDlvDetail");i.BookingDate=e.getBindingContext().getObject().BookingDate;i.Customer=e.getBindingContext().getObject().Customer;i.Quantity=e.mAggregations.cells[2].mProperties.text;i.Bhav=e.mAggregations.cells[3].mProperties.text;i.Advance=e.mAggregations.cells[4].mProperties.text;i.Type=e.mAggregations.cells[5].mProperties.text;if(e.getBindingContext().getObject().Recid!="null"){i.Recid=e.getBindingContext().getObject().Recid}else{i.Recid="'"+e.getBindingContext().getObject().id+"'"}this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDlvDetails","POST",{},i,this).then(function(i){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Delivery12"));var o=e;debugger;var a=o.getBindingContext().sPath;t.ODataHelper.callOData(t.getOwnerComponent().getModel(),a,"DELETE",{},{},t)}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},onDropBookingTable:function(e){debugger;var t=this;t.getView().setBusy(true);var i=e.getParameter("draggedControl");var o=i.getBindingContext();if(!o){sap.m.MessageToast.show(t.resourceBundle.getText("Please11"));t.getView().setBusy(false);return}var a=i.getBindingContext().getObject().Recid;var g=new sap.ui.model.Filter("id","EQ",a);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails","GET",{filters:[g]},{},this).then(function(e){debugger;if(e.results.length>0){t.insertDragDetails(i,e)}else{var o=new sap.ui.model.Filter("Recid","EQ",a);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/BookingDetails","GET",{filters:[o]},{},t).then(function(e){debugger;if(e.results.length>0){t.insertDragDetails(i,e)}else{t.appendDragDetails(i)}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})}}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},appendDragDetails:function(e){var t=this;var i=this.getView().getModel("local").getProperty("/BookingDetail");i.BookingDate=e.getBindingContext().getObject().BookingDate;i.Customer=e.getBindingContext().getObject().Customer;i.Quantity=e.mAggregations.cells[2].mProperties.text;i.Bhav=e.mAggregations.cells[3].mProperties.text;i.Advance=e.mAggregations.cells[4].mProperties.text;i.Type=e.mAggregations.cells[5].mProperties.text;i.Recid=e.getBindingContext().getObject().Recid;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails","POST",{},i,this).then(function(i){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Delivery14"));var o=e;debugger;var a=o.getBindingContext().sPath;t.ODataHelper.callOData(t.getOwnerComponent().getModel(),a,"DELETE",{},{},t)}).catch(function(e){t.getView().setBusy(false);var i=t.getErrorMessage(e)})},insertDragDetails:function(e,t){var i=this;var o=this.getView().getModel("local").getProperty("/BookingDetail");o.BookingDate=e.getBindingContext().getObject().BookingDate;o.Customer=e.getBindingContext().getObject().Customer;o.Quantity=parseInt(e.mAggregations.cells[2].mProperties.text)+parseInt(t.results[0].Quantity);o.Bhav=e.mAggregations.cells[3].mProperties.text;o.Advance=e.mAggregations.cells[4].mProperties.text;o.Type=e.mAggregations.cells[5].mProperties.text;o.Recid=e.getBindingContext().getObject().Recid;var a=t.results[0].id;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/BookingDetails('"+a+"')","PUT",{},o,this).then(function(t){i.getView().setBusy(false);sap.m.MessageToast.show(i.resourceBundle.getText("Delivery14"));var o=e;debugger;var a=o.getBindingContext().sPath;i.ODataHelper.callOData(i.getOwnerComponent().getModel(),a,"DELETE",{},{},i)}).catch(function(e){i.getView().setBusy(false);var t=i.getErrorMessage(e)})},onSubmit:function(e){this.getView().byId("idBhav").focus()},onBhavSubmit:function(e){this.getView().byId("idAdvance").focus()},onAdvSubmit:function(e){this.getView().byId("sendButton").focus()},decimalvalidator:function(e){if(this.getView().byId("idRb1").getSelected()){this.decimalvalidator2(e)}else if(this.getView().byId("idRb2").getSelected()){this.decimalvalidator3(e)}},decimalvalidator3:function(e){debugger;var t=e.mParameters.value.match(/^[+-]?\d{0,6}(\.\d{0,3})?/)[0];this.getView().byId("idQnty").setValue(t);console.log(this.getView().byId("idQnty"))},decimalvalidator2:function(e){debugger;var t=e.mParameters.value.match(/^[+-]?\d{0,5}(\.\d{0,2})?/)[0];this.getView().byId("idQnty").setValue(t)},customerCodeCheck1:function(e){debugger;this.getCustomer(e);this.getView().byId("idQnty").focus()},onLiveSearch:function(e){this.onSearch(e)}})});