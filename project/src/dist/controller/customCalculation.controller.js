sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/m/MessageToast","sap/m/MessageBox","victoria/models/formatter"],function(e,t,a,r,o,n){return e.extend("victoria.controller.customCalculation",{formatter:n,onSubmit:function(e){$(function(){$("input:text:first").focus();var e=$("input:text");e.bind("keydown",function(t){var a=t.which;if(a==13){t.preventDefault();var r=e.index(this)+1;$(":input:text:eq("+r+")").focus()}})})},handleUploadPress:function(e){debugger;console.log(this.getView().byId("uploadTypeSelect").mProperties["value"]);var t=this.getView().byId("uploadTypeSelect").mProperties["value"];var a=this;var o=this.byId("fileUploader");this.byId("fileUploader").setAdditionalData(t);if(!o.getValue()){r.show(a.resourceBundle.getText("Choose11"));return}o.getAggregation("parameters")[0].setValue(this.getModel("local").getData().CurrentUser);o.upload()},handleUploadPress1:function(e){debugger;var t=this;var a=this.byId("fileUploader1");if(!a.getValue()){r.show(t.resourceBundle.getText("Choose11"));return}a.getAggregation("parameters")[0].setValue(this.getModel("local").getData().CurrentUser);a.upload()},handleUploadGroupPress:function(){debugger;var e=this.getView().byId("uploadTypeSelect").mProperties["value"];var t=this.byId("fileUploader");$.post("/upload",{file:t.getValue(),type:e}).then(function(e){debugger;r.show(that.resourceBundle.getText("downloaded11"))},function(e){debugger;r.show(that.resourceBundle.getText("downloaded12"))})},handleUploadGroupPress1:function(){debugger;var e=this.byId("fileUploader1");$.post("/VictoriaGFS",{file:e.getValue()}).then(function(e){debugger;r.show(that.resourceBundle.getText("downloaded11"))},function(e){debugger;r.show(that.resourceBundle.getText("downloaded12"))})},handleUploadComplete:function(e){debugger;var t=e.getParameter("response");var a=e.getSource();if(t){var o="";debugger;if(JSON.parse(t.split('">')[1].replace("</pre>","")).error_code!==0){o=JSON.parse(t.split('">')[1].replace("</pre>","")).err_desc}else{o=that.resourceBundle.getText("UploadedSuccessfully")}r.show(o)}},handleUploadComplete1:function(e){debugger;var t=this;var a=e.getParameter("response");var o=e.getSource();if(!a){var n="";debugger;n=t.resourceBundle.getText("UploadedSuccessfully");r.show(n)}},onInit:function(){this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var a=new t({First:"",Second:"",Gold:"",Silver:"","Gold Returns":"","Silver Returns":"",Gold1:"",Silver1:"","Kaccha Gold":"","Kaccha Silver":"","Gold Returns1":"","Silver Returns1":"","Kaccha Gold R":"","Kaccha Silver R":""});this.setModel(a,"customModel");e.prototype.onInit.apply(this);var r=this.getRouter();r.getRoute("Customizing").attachMatched(this._onRouteMatched,this);var o=this;var n=this.getModel("local").getProperty("/CurrentUser");var i=this.getModel("local").oData.AppUsers[n].UserName;i="Hey "+i;this.getView().byId("idUser").setText(i)},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_onRouteMatched:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CustomCalculations","GET",{},{},this).then(function(a){var r=new t;r.setData(a);if(a.results.length>0){var o=e.getView().getModel("local").setProperty("/CustomCalculation",a.results[0],r)}else{var o=e.getView().getModel("local").getProperty("/CustomCalculation")}}).catch(function(t){r.show(e.resourceBundle.getText("Fetch11"))})},ClearCalculation:function(){var e=this;e._onRouteMatched()},onliveChange:function(e){var t=this;this.byId("idSaveIcon").setColor("red")},onValueChange:function(e){var t=e.getSource().getIdForLabel()},ValidateInput:function(e,t,a){var r=this;var o=t.getFormContainers()[a].getFormElements()[e].getFields()[0].getLabels()[0].getText();var n=t.getFormContainers()[a].getFormElements()[e].getFields()[0].getValue();var i=t.getFormContainers()[a].getFormElements()[e].getFields()[0];if(o.includes("Gold")||o.includes("22")){var s=r.handleGoldValidation(n);if(s===false){i.setValueState("Error").setValueStateText("Gold value should be between 30000 and 80000");return s}else{i.setValueState("None");return s}}else{var s=r.handleSilverValidation(n);if(s===false){i.setValueState("Error").setValueStateText("Silver value should be between 30000 and 110000");return s}else{i.setValueState("None");return s}}},SaveCalculation:function(e){debugger;var t=this;var a=true;var o=this.getView().byId("__component0---idCustomizing--idCalculation");var n=o.getFormContainers()[0].getFormElements().length;var i=o.getFormContainers()[1].getFormElements().length;for(var s=0;s<n;s++){var l=0;var a=t.ValidateInput(s,o,l);if(a===false){break}}if(a===true){for(var s=0;s<i;s++){var l=1;var a=t.ValidateInput(s,o,l);if(a===false){break}}}var o=this.getView().byId("__component0---idCustomizing--idWholesale");var n=o.getFormContainers()[0].getFormElements().length;var i=o.getFormContainers()[1].getFormElements().length;if(a===true){for(var s=0;s<n;s++){var l=0;var a=t.ValidateInput(s,o,l);if(a===false){break}}}if(a===true){for(var s=0;s<i;s++){var l=1;var a=t.ValidateInput(s,o,l);if(a===false){break}}}t.getView().setBusy(true);var u=t.getView().getModel("local").getProperty("/CustomCalculation");var d=u.id;if(a===true){if(d){var g=t;debugger;var c=t.getOwnerComponent().getModel("local").getProperty("/AuthorizationToken");var h={id:d,EntryLayout:u.EntryLayout};$.ajax("/api/CustomCalculations/"+u.id+"?access_token="+c+"&id="+u.id,{type:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},data:JSON.stringify(h),success:function(e,t){debugger},error:function(e,t,a){debugger}});debugger;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CustomCalculations('"+u.id+"')","PUT",{},u,this).then(function(e){debugger;t.getView().setBusy(false);r.show(t.resourceBundle.getText("Data"));t._onRouteMatched();t.byId("idSaveIcon").setColor("green")}).catch(function(e){t.getView().setBusy(false);var a=t.getErrorMessage(e)})}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/CustomCalculations","POST",{},u,this).then(function(e){t.getView().setBusy(false);r.show(t.resourceBundle.getText("dataSave"));t._onRouteMatched();t.byId("idSaveIcon").setColor("green")}).catch(function(e){t.getView().setBusy(false);var a=t.getErrorMessage(e)})}}else{t.getView().setBusy(false)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("city",{Id:t});this._bindView("/"+e)}.bind(this))},onPressBackup:function(){var e="Backup";window.open("/VictoriaBackup")},_bindView:function(e){var t=this.getModel("objectView"),a=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})}})});