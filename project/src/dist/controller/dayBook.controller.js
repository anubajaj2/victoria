sap.ui.define(["victoria/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/model/FilterOperator"],function(e,t,i,r,a,o,n){"use strict";var d=a.EdmType;return e.extend("victoria.controller.dayBook",{onInit:function(){debugger;var t=this;e.prototype.onInit.apply(this);var i=this.getRouter();var t=this;var r=this.getModel("local").getProperty("/CurrentUser");var a=this.getModel("local").oData.AppUsers[r].UserName;a="Hey "+a;this.getView().byId("idUser").setText(a);i.getRoute("dayBook").attachMatched(this._onRouteMatched,this)},getRouter:function(){debugger;return sap.ui.core.UIComponent.getRouterFor(this)},_onRouteMatched:function(){debugger;var e=this.getModel("local").getProperty("/CurrentUser");if(this.getModel("local").oData.AppUsers[e].Role!=="Admin"){debugger;var t=new r([new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.EQ,"")],true);this.getView().byId("idTable1").getBinding("items").filter(t);return}this.getView().getModel("local").setProperty("/Footer",false)},onValueHelpRequest:function(e){debugger;this.getCustomerPopup(e)},onEnter:function(e){debugger;this.getCustomer(e)},_getSecureDetails:function(){var e=this},onPressEntryDownload:function(){debugger;var e=this.getView().byId("idCustDay").getValue();var t=this.getView().byId("dateRangeId").getDateValue();var i=this.getView().byId("dateRangeId").getSecondDateValue();var r=this.getView().getModel("local").getProperty("/EntryData");var a=null;var o=null;this.getView().getModel("local").getProperty("/EntryData",r);if(t===null&&i===null){window.open("/entryDownload?id="+r.Customer+"&type=DayBook&name="+o+"&city="+a+"&min="+t+"&max="+i)}else if(e===""){window.open("/entryDownloadDate?id="+e+"&type=DayBook&name="+o+"&city="+a+"&min="+t.toISOString()+"&max="+i.toISOString())}else{window.open("/entryDownloadBetween?id="+r.Customer+"&type=DayBook&name="+o+"&city="+a+"&min="+t.toISOString()+"&max="+i.toISOString())}},onBeforeExport:function(e){var t=e.getParameter("exportSettings");t.worker=false},onExportExcel:function(){var e=this;debugger;var t=this.getView().getModel().oData;this.JSONToExcelConvertor(t,"Report",true)},JSONToExcelConvertor:function(e,t,i){debugger;var r=typeof e.tableDetails!="object"?JSON.parse(e.tableDetails):e.tableDetails;var a="";if(i){var o="";o=o.slice(0,-1)}o+='"'+this.getView().byId("id1").getText()+'",';o+='"'+this.getView().byId("id2").getText()+'",';o+='"'+this.getView().byId("id3").getText()+'",';o+='"'+this.getView().byId("id4").getText()+'",';o+='"'+this.getView().byId("cashid").getText()+'",';o+='"'+this.getView().byId("id5").getText()+'",';o+='"'+this.getView().byId("id6").getText()+'",';o+='"'+this.getView().byId("id7").getText()+'",';a+=o+"\r\n";for(var n=0;n<r.length;n++){var o="";for(var d in r[n]){o+='"'+r[n][d]+'",'}o.slice(1,o.length);a+=o+"\r\n"}var s="";s+='"",';s+='"",';s+='"",';s+='"Total:'+this.getView().byId("totalPickedWtId").getText()+'",';s+='"",';s+='"Total:'+this.getView().byId("totalPickedVolId").getText()+'",';s+='"",';a+=s+"\r\n";if(a==""){alert("Invalid data");return}var l="MyReport_";l+=t.replace(/ /g,"_");var g="data:application/vnd.ms-excel:base64,"+encodeURIComponent(a);var u=document.createElement("a");u.href=g;u.style="visibility:hidden";u.download=l+".xls";document.body.appendChild(u);u.click();document.body.removeChild(u)},onConfirm:function(e){debugger;var t=e.getParameter("selectedItem").getLabel();this.getView().byId("idCustDay").setValue(t);this.getView().getModel("local").setProperty("/EntryData/Customer",e.getParameter("selectedItem").getBindingContextPath().split("'")[1])},onUpdateFinished:function(e){debugger;var t=e.getSource();var i=t.getItems();var r=i.length;var a=r<=20?0:r-20;var o;var n;console.log(r);var d=this.getView().getModel("i18n").getProperty("allEntries");this.getView().byId("idTitle").setText(d+" "+"("+r+")");this.getView().byId("idTable1").setBlocked(false);this.getView().byId("idTable1").setShowOverlay(false);for(var s=0;s<r;s++){var l=t.getItems()[s].getCells()[2].getText();var g=t.getItems()[s].getCells()[3].getText();var u=this.allMasterData.customers[l];var c=this.allMasterData.materials[g];t.getItems()[s].getCells()[1].setText(u.CustomerCode+" - "+u.Name);if(g!==""&&c!==undefined){t.getItems()[s].getCells()[3].setText(c.ProductCode+" - "+c.ProductName)}}},onFilterSearch:function(e){debugger;var t=this;var i=this.getView().byId("idCustDay").getValue();if(i!==""){var a=this.allMasterData.customersId[i].id}var o=this.getView().byId("dateRangeId").getDateValue();var n=this.getView().byId("dateRangeId").getSecondDateValue();var d=[];var s=new Date(n);if(o!==null&&n!==null){if(o.getTimezoneOffset()>0){o.setMinutes(o.getMinutes()+o.getTimezoneOffset())}else{o.setMinutes(o.getMinutes()-o.getTimezoneOffset())}if(n.getTimezoneOffset()>0){n.setMinutes(n.getMinutes()+n.getTimezoneOffset())}else{n.setMinutes(n.getMinutes()-n.getTimezoneOffset())}var l=new r([new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.BT,o,n)],true);d.push(l)}if(i!==""){var g=new sap.ui.model.Filter("Customer","EQ","'"+a+"'");d.push(g)}this.getView().byId("idTable1").getBinding("items").filter(d);if(o===null&&n===null){$.post("/getTotalEntryCustomer",{Customer:a}).then(function(e){debugger;t.getView().getModel("local").setProperty("/Footer",true);t.byId("idTC1").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC1").getText();parseFloat(t.byId("idTC1").getText());if(parseFloat(t.byId("idTC1").getText())>0){t.byId("idTC1").setState("Success");debugger}else{t.byId("idTC1").setState("Warning")}t.getView().byId("idG1").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG1").getText();parseFloat(t.byId("idG1").getText());if(parseFloat(t.byId("idG1").getText())>0){t.byId("idG1").setState("Success");debugger}else{t.byId("idG1").setState("Warning")}t.getView().byId("idS1").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS1").getText();parseFloat(t.byId("idS1").getText());parseFloat(t.byId("idS1").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS1").getText()).toFixed(3))>0){t.byId("idS1").setState("Success");debugger}else{t.byId("idS1").setState("Warning")}debugger})}else{if(i===""){var u=i}else{var u=a}o.setHours(0,0,0,0);$.post("/getTotalEntryCustomerBetween",{Customer:u,max:s,min:o}).then(function(e){debugger;t.getView().getModel("local").setProperty("/Footer",true);t.byId("idTC1").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC1").getText();parseFloat(t.byId("idTC1").getText());if(parseFloat(t.byId("idTC1").getText())>0){t.byId("idTC1").setState("Success");debugger}else{t.byId("idTC1").setState("Warning")}t.getView().byId("idG1").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG1").getText();parseFloat(t.byId("idG1").getText());if(parseFloat(t.byId("idG1").getText())>0){t.byId("idG1").setState("Success");debugger}else{t.byId("idG1").setState("Warning")}t.getView().byId("idS1").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS1").getText();parseFloat(t.byId("idS1").getText());parseFloat(t.byId("idS1").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS1").getText()).toFixed(3))>0){t.byId("idS1").setState("Success");debugger}else{t.byId("idS1").setState("Warning")}debugger})}},onFilterClear:function(e){debugger;this.getView().getModel("local").setProperty("/Footer",false);this.getView().byId("idTable1").getBinding("items").filter("/")},createColumnConfig:function(){var e=[];var t=[];e.push({label:"Date",property:["Date"],type:d.Date});e.push({property:["Name","CustomerCode"]});e.push({property:"Customer",type:d.String});e.push({property:"Product",type:d.String});e.push({property:"Cash",type:d.Number});e.push({property:"Gold",type:d.Number});e.push({property:"Silver",type:d.Number});e.push({property:"Remarks",type:d.String});t.push({property:"TA",type:d.Number});return e},onExport:function(){debugger;var e,t,i,r,a;if(!this._oTable){this._oTable=this.byId("idTable1")}a=this._oTable;t=a.getBinding("items");e=this.createColumnConfig();var n=t.getModel();i={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:{type:"OData",dataUrl:t.getDownloadUrl?t.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:n.getHeaders?n.getHeaders():null,count:t.getLength?t.getLength():null,useBatch:true},fileName:"Table export sample.xlsx",worker:false};r=new o(i);r.build().finally(function(){r.destroy()})},totalFormatter:function(e){debugger;return e.length},decimalvalidator1:function(e){debugger;if(e.mParameters.id==="__component0---idEntry--idCash"){$(function(){$("input").on("input.idCash",function(e){if(e.currentTarget.id=="__component0---idEntry--idCash-inner"){debugger;this.value=this.value.match(/^[+-]?\d{0,8}(\.\d{0,2})?/)[0]}})})}},decimalvalidator2:function(e){debugger;if(e.mParameters.id==="__component0---idEntry--idGold"){$(function(){$("input").on("input.idGold",function(e){if(e.currentTarget.id=="__component0---idEntry--idGold-inner"){debugger;this.value=this.value.match(/^[+-]?\d{0,6}(\.\d{0,3})?/)[0]}})})}},decimalvalidator3:function(e){debugger;if(e.mParameters.id==="__component0---idEntry--idSilver"){$(function(){$("input").on("input.idSilver",function(e){if(e.currentTarget.id=="__component0---idEntry--idSilver-inner"){debugger;this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,2})?/)[0]}})})}},decimalvalidator4:function(e){debugger;if(e.mParameters.id==="__component0---idEntry--idweight"){$(function(){$("input").on("input.idweight",function(e){if(e.currentTarget.id=="__component0---idEntry--idweight-inner"){debugger;this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,3})?/)[0]}})})}},decimalvalidator5:function(e){debugger;if(e.mParameters.id==="__component0---idEntry--idtunch"){$(function(){$("input").on("input.idtunch",function(e){if(e.currentTarget.id=="__component0---idEntry--idtunch-inner"){debugger;this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,3})?/)[0]}})})}},onMaterialSelect:function(e){var t=e.getParameter("selectedItem").getModel().getProperty(e.getParameter("selectedItem").getBindingContext().getPath());var i=e.getParameter("selectedItem").getText();var r=e.getParameter("selectedItem").getAdditionalText();var a=e.getParameter("selectedItem").getKey();this.getView().byId("idMat").setValue(i);this.getView().byId("idMatText").setText(r+" - "+a)},onRemarksSubmit:function(e){this.getView().byId("sendButton").focus()},onSubmit:function(e){$(function(){$("input:text:first").focus();var e=$("input:text");e.bind("keypress",function(t){var i=t.which;if(i==13){t.preventDefault();var r=e.index(this)+1;$(":input:text:eq("+r+")").focus()}})})},onCashSubmit:function(e){this.getView().byId("idGold").focus()},onGoldSubmit:function(e){this.getView().byId("idSilver").focus()},onSilverSubmit:function(e){this.getView().byId("idRemarks").focus()},onRemarksSubmit:function(e){this.getView().byId("sendButton").focus()},onSubmitSideWeight:function(e){this.getView().byId("idtunch").focus()},onSubmitSideTunch:function(e){this.getView().byId("calculateButton").focus()},onSelect:function(e){jQuery.sap.delayedCall(500,this,function(){})},inpField:"",onSelectValue:function(e){debugger;var t=e.getParameter("selectedItem");var i=t.getLabel();sap.ui.getCore().byId(this.inpField).setValue(i);var r=this;this.getView().byId("idCustDay").setValue(i)},onSuggest:function(e){debugger;const t=e.key;var i=e.getParameter("id").split("--")[2];var r=e.getParameter("suggestValue");if(r===""||t==8||t==="Backspace"||t==="Delete"){this.getView().byId("idCustDay").setValue("");return}if(!r){r=e.getParameter("newValue")}if(r){var a=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,r.toUpperCase()),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,r.toUpperCase())],and:false})}e.getSource().getBinding("suggestionItems").filter(a);var o=new sap.ui.model.Sorter({path:"CustomerCode",descending:false});e.getSource().getBinding("suggestionItems").sort(o);this.getView().byId("idCustDay").setValue(r)}})});