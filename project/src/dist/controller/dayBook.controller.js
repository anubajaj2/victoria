sap.ui.define(["victoria/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,t,i,a,r,o,s,d){"use strict";var l=r.EdmType;return e.extend("victoria.controller.dayBook",{onInit:function(){var t=this;t.getView().setBusy(false);e.prototype.onInit.apply(this);var i=this.getRouter();var t=this;var a=this.getModel("local").getProperty("/CurrentUser");var r=this.getModel("local").oData.AppUsers[a].UserName;r="Hey "+r;this.getView().byId("idUser").setText(r);i.getRoute("dayBook").attachMatched(this._onRouteMatched,this)},oDialog1:null,onPressGWiseDownload:function(){var e="Group_Wise_Report";if(!this.oDialog1){this.oDialog1=new sap.ui.xmlfragment(this.getView().getId(),"victoria.fragments.entryGroup",this);this.getView().addDependent(this.oDialog1)}this.oDialog1.open()},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onPressHandleEntryCancelPopup1:function(){this.getView().byId("idGroup1").setEditable(false);this.oDialog1.close();if(this.getView().byId("id1").getSelected()){this.getView().byId("idGroup1").setEditable(true)}},onPressHandleEntrySavePopup1:function(){if(this.getView().byId("idAll").getSelected()){window.open("/groupWiseEntryDownload?type=Group_Wise_Report&group=00")}else if(this.getView().byId("id1").getSelected()){var e=this.getView().byId("idGroup1").getSelectedKey();var t=this.getView().byId("idGroup1").getSelectedItem().getText();window.open("/groupWiseEntryDownload?type=Group_Wise_Report&group="+e+"&name="+t)}else if(this.getView().byId("idNo").getSelected()){window.open("/groupWiseEntryDownload?type=Group_Wise_Report&group=01")}else{i.show("Please Select A Option");return}this.oDialog1.close()},_onRouteMatched:function(e){var t=this;var i=t.getModel("local").getProperty("/CurrentUser");if(t.getModel("local").oData.AppUsers[i].Role!=="Admin"){var r=new a([new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.EQ,"")],true);t.getView().byId("idTable1").getBinding("items").filter(r);t.getView().setBusy(false);var o=t.allMasterData.customers;var s=[];function p(e){return Object.keys(e).length}for(var d in o){var l=o[d].Group;var n=t.allMasterData.groups[l].hide;if(n===false){s.push(o[d])}}t.getView().getModel("local").setProperty("/finalCustomer",s)}else{function c(e){return Object.keys(e).length}var o=t.allMasterData.customers;var u=c(o);var g=[];for(var d in o){g.push(o[d])}t.getView().getModel("local").setProperty("/finalCustomer",g)}this.getView().getModel("local").setProperty("/Footer",false)},onValueHelpRequest:function(e){var t=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Customers","GET",null,null,this).then(function(e){for(var i=0;i<e.results.length;i++){t.allMasterData.customers[e.results[i].id]=e.results[i];t.allMasterData.customersId[e.results[i].CustomerCode]=e.results[i]}}).catch(function(e){var i=t.getErrorMessage(e)});if(!this.searchPopup){var t=this;this.searchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",this);this.getView().addDependent(this.searchPopup);var i=this.getView().getModel("i18n").getProperty("customer");this.searchPopup.setTitle(i);this.searchPopup.bindAggregation("items",{path:"local>/finalCustomer",template:new sap.m.DisplayListItem({label:"{local>CustomerCode}",value:{parts:[{path:"local>Name"},{path:"local>City"}],formatter:function(e,i){return e+"-"+t.allMasterData.cities[i].cityName}}}),sorter:new sap.ui.model.Sorter("CustomerCode")})}this.searchPopup.open()},onEnter:function(e){var t=this;var i=this.getView().byId("idCustDay").getValue();var a=this.getView().byId("idCustDay").getValue();if(i!==""){var r=this.allMasterData.customersId[a].id}var o=this.getModel("local").getProperty("/CurrentUser");if(this.getModel("local").oData.AppUsers[o].Role!=="Admin"){if(!i){}else{return}}else{this.getCustomer(e)}},_getSecureDetails:function(){var e=this},onPressEntryDownload:function(){var e=this.getView().byId("idCustDay").getValue();var t=this.getView().byId("dateRangeId").getDateValue();var i=this.getView().byId("dateRangeId").getSecondDateValue();var a=this.getView().getModel("local").getProperty("/EntryData");var r=null;var o=null;this.getView().getModel("local").getProperty("/EntryData",a);if(e){for(var s in this.allMasterData.customers){if(this.allMasterData.customers[s].CustomerCode===e){console.log(s);a.Customer=s;break}}}if(t===null&&i===null){window.open("/entryDownload?id="+a.Customer+"&type=DayBook&name="+o+"&city="+r+"&min="+t+"&max="+i)}else if(e===""){window.open("/entryDownloadDate?id="+e+"&type=DayBook&name="+o+"&city="+r+"&min="+t.toISOString()+"&max="+i.toISOString())}else{window.open("/entryDownloadBetween?id="+a.Customer+"&type=DayBook&name="+o+"&city="+r+"&min="+t.toISOString()+"&max="+i.toISOString())}},onBeforeExport:function(e){var t=e.getParameter("exportSettings");t.worker=false},onExportExcel:function(){var e=this;var t=this.getView().getModel().oData;this.JSONToExcelConvertor(t,"Report",true)},JSONToExcelConvertor:function(e,t,i){var a=typeof e.tableDetails!="object"?JSON.parse(e.tableDetails):e.tableDetails;var r="";if(i){var o="";o=o.slice(0,-1)}o+='"'+this.getView().byId("id1").getText()+'",';o+='"'+this.getView().byId("id2").getText()+'",';o+='"'+this.getView().byId("id3").getText()+'",';o+='"'+this.getView().byId("id4").getText()+'",';o+='"'+this.getView().byId("cashid").getText()+'",';o+='"'+this.getView().byId("id5").getText()+'",';o+='"'+this.getView().byId("id6").getText()+'",';o+='"'+this.getView().byId("id7").getText()+'",';r+=o+"\r\n";for(var s=0;s<a.length;s++){var o="";for(var d in a[s]){o+='"'+a[s][d]+'",'}o.slice(1,o.length);r+=o+"\r\n"}var l="";l+='"",';l+='"",';l+='"",';l+='"Total:'+this.getView().byId("totalPickedWtId").getText()+'",';l+='"",';l+='"Total:'+this.getView().byId("totalPickedVolId").getText()+'",';l+='"",';r+=l+"\r\n";if(r==""){alert("Invalid data");return}var n="MyReport_";n+=t.replace(/ /g,"_");var u="data:application/vnd.ms-excel:base64,"+encodeURIComponent(r);var g=document.createElement("a");g.href=u;g.style="visibility:hidden";g.download=n+".xls";document.body.appendChild(g);g.click();document.body.removeChild(g)},onConfirm:function(e){debugger;var t=e.getParameter("selectedItem").getText();this.getView().byId("idCustDay").setValue(t)},onUpdateFinished:function(e){var t=e.getSource();var i=t.getItems();var a=i.length;var r=a<=20?0:a-20;var o;var s;console.log(a);var d=this.getView().getModel("i18n").getProperty("allEntries");this.getView().byId("idTitle").setText(d+" "+"("+a+")");this.getView().byId("idTable1").setBlocked(false);this.getView().byId("idTable1").setShowOverlay(false);for(var l=0;l<a;l++){var n=t.getItems()[l].getCells()[2].getText();var u=t.getItems()[l].getCells()[3].getText();var g=this.allMasterData.customers[n];var p=this.allMasterData.materials[u];t.getItems()[l].getCells()[1].setText(g.CustomerCode+" - "+g.Name);if(u!==""&&p!==undefined){t.getItems()[l].getCells()[3].setText(p.ProductCode+" - "+p.ProductName)}}},onFilterSearch:function(e){var t=this;var r=[];var o=this.getView().byId("idCustDay").getValue();if(o!==""){var s=this.allMasterData.customersId[o].id;var d=t.allMasterData.customers;var l="N";for(var n in d){var u=d[n].Group;var g=t.allMasterData.groups[u].hide;var p=d[n].CustomerCode;if(o===p){l="Y";break}}if(g===true){var c=t.getModel("local").getProperty("/CurrentUser");if(t.getModel("local").oData.AppUsers[c].Role!=="Admin"){i.show("Display of data are not allowed");return}}}var y=this.getView().byId("dateRangeId").getDateValue();var h=this.getView().byId("dateRangeId").getSecondDateValue();var m=new Date(h);if(y!==null&&h!==null){if(y.getTimezoneOffset()>0){y.setMinutes(y.getMinutes()+y.getTimezoneOffset())}else{y.setMinutes(y.getMinutes()-y.getTimezoneOffset())}if(h.getTimezoneOffset()>0){h.setMinutes(h.getMinutes()+h.getTimezoneOffset())}else{h.setMinutes(h.getMinutes()-h.getTimezoneOffset())}var f=new a([new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.BT,y,h)],true);r.push(f)}if(o!==""){var b=new sap.ui.model.Filter("Customer","EQ","'"+s+"'");r.push(b)}this.getView().byId("idTable1").getBinding("items").filter(r);if(y===null&&h===null){$.post("/getTotalEntryCustomer",{Customer:s}).then(function(e){t.getView().getModel("local").setProperty("/Footer",true);t.byId("idTC1").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC1").getText();parseFloat(t.byId("idTC1").getText());if(parseFloat(t.byId("idTC1").getText())>0){t.byId("idTC1").setState("Success")}else{t.byId("idTC1").setState("Warning")}t.byId("idTC11").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC11").getText();parseFloat(t.byId("idTC11").getText());if(parseFloat(t.byId("idTC11").getText())>0){t.byId("idTC11").setState("Success")}else{t.byId("idTC11").setState("Warning")}t.getView().byId("idG1").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG1").getText();parseFloat(t.byId("idG1").getText());if(parseFloat(t.byId("idG1").getText())>0){t.byId("idG1").setState("Success")}else{t.byId("idG1").setState("Warning")}t.getView().byId("idG11").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG11").getText();parseFloat(t.byId("idG11").getText());if(parseFloat(t.byId("idG11").getText())>0){t.byId("idG11").setState("Success")}else{t.byId("idG11").setState("Warning")}t.getView().byId("idS1").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS1").getText();parseFloat(t.byId("idS1").getText());parseFloat(t.byId("idS1").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS1").getText()).toFixed(3))>0){t.byId("idS1").setState("Success")}else{t.byId("idS1").setState("Warning")}t.getView().byId("idS11").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS11").getText();parseFloat(t.byId("idS11").getText());parseFloat(t.byId("idS11").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS11").getText()).toFixed(3))>0){t.byId("idS11").setState("Success")}else{t.byId("idS11").setState("Warning")}})}else{if(o===""){var I=o}else{var I=s}y.setHours(0,0,0,0);$.post("/getTotalEntryCustomerBetween",{Customer:I,max:m,min:y}).then(function(e){t.getView().getModel("local").setProperty("/Footer",true);t.byId("idTC1").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC1").getText();parseFloat(t.byId("idTC1").getText());if(parseFloat(t.byId("idTC1").getText())>0){t.byId("idTC1").setState("Success")}else{t.byId("idTC1").setState("Warning")}t.byId("idTC11").setText(parseFloat(e.CashTotal).toFixed(2));t.byId("idTC11").getText();parseFloat(t.byId("idTC11").getText());if(parseFloat(t.byId("idTC11").getText())>0){t.byId("idTC11").setState("Success")}else{t.byId("idTC11").setState("Warning")}t.getView().byId("idG1").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG1").getText();parseFloat(t.byId("idG1").getText());if(parseFloat(t.byId("idG1").getText())>0){t.byId("idG1").setState("Success")}else{t.byId("idG1").setState("Warning")}t.getView().byId("idG11").setText(parseFloat(e.GoldTotal.toFixed(3)));t.byId("idG11").getText();parseFloat(t.byId("idG11").getText());if(parseFloat(t.byId("idG11").getText())>0){t.byId("idG11").setState("Success")}else{t.byId("idG11").setState("Warning")}t.getView().byId("idS1").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS1").getText();parseFloat(t.byId("idS1").getText());parseFloat(t.byId("idS1").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS1").getText()).toFixed(3))>0){t.byId("idS1").setState("Success")}else{t.byId("idS1").setState("Warning")}t.getView().byId("idS11").setText(parseFloat(e.SilverTotal.toFixed(2)));t.byId("idS11").getText();parseFloat(t.byId("idS11").getText());parseFloat(t.byId("idS11").getText()).toFixed(3);if(parseFloat(parseFloat(t.byId("idS11").getText()).toFixed(3))>0){t.byId("idS11").setState("Success")}else{t.byId("idS11").setState("Warning")}})}},onFilterClear:function(e){this.getView().getModel("local").setProperty("/Footer",false);this.getView().byId("idTable1").getBinding("items").filter("/")},createColumnConfig:function(){var e=[];var t=[];e.push({label:"Date",property:["Date"],type:l.Date});e.push({property:["Name","CustomerCode"]});e.push({property:"Customer",type:l.String});e.push({property:"Product",type:l.String});e.push({property:"Cash",type:l.Number});e.push({property:"Gold",type:l.Number});e.push({property:"Silver",type:l.Number});e.push({property:"Remarks",type:l.String});t.push({property:"TA",type:l.Number});return e},onExport:function(){var e,t,i,a,r;if(!this._oTable){this._oTable=this.byId("idTable1")}r=this._oTable;t=r.getBinding("items");e=this.createColumnConfig();var s=t.getModel();i={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:{type:"OData",dataUrl:t.getDownloadUrl?t.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:s.getHeaders?s.getHeaders():null,count:t.getLength?t.getLength():null,useBatch:true},fileName:"Table export sample.xlsx",worker:false};a=new o(i);a.build().finally(function(){a.destroy()})},totalFormatter:function(e){return e.length},decimalvalidator1:function(e){if(e.mParameters.id==="__component0---idEntry--idCash"){$(function(){$("input").on("input.idCash",function(e){if(e.currentTarget.id=="__component0---idEntry--idCash-inner"){this.value=this.value.match(/^[+-]?\d{0,8}(\.\d{0,2})?/)[0]}})})}},decimalvalidator2:function(e){if(e.mParameters.id==="__component0---idEntry--idGold"){$(function(){$("input").on("input.idGold",function(e){if(e.currentTarget.id=="__component0---idEntry--idGold-inner"){this.value=this.value.match(/^[+-]?\d{0,6}(\.\d{0,3})?/)[0]}})})}},decimalvalidator3:function(e){if(e.mParameters.id==="__component0---idEntry--idSilver"){$(function(){$("input").on("input.idSilver",function(e){if(e.currentTarget.id=="__component0---idEntry--idSilver-inner"){this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,2})?/)[0]}})})}},decimalvalidator4:function(e){if(e.mParameters.id==="__component0---idEntry--idweight"){$(function(){$("input").on("input.idweight",function(e){if(e.currentTarget.id=="__component0---idEntry--idweight-inner"){this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,3})?/)[0]}})})}},decimalvalidator5:function(e){if(e.mParameters.id==="__component0---idEntry--idtunch"){$(function(){$("input").on("input.idtunch",function(e){if(e.currentTarget.id=="__component0---idEntry--idtunch-inner"){this.value=this.value.match(/^[+-]?\d{0,5}(\.\d{0,3})?/)[0]}})})}},onMaterialSelect:function(e){var t=e.getParameter("selectedItem").getModel().getProperty(e.getParameter("selectedItem").getBindingContext().getPath());var i=e.getParameter("selectedItem").getText();var a=e.getParameter("selectedItem").getAdditionalText();var r=e.getParameter("selectedItem").getKey();this.getView().byId("idMat").setValue(i);this.getView().byId("idMatText").setText(a+" - "+r)},onRemarksSubmit:function(e){this.getView().byId("sendButton").focus()},onSubmit:function(e){var t=this;var r=this.getView().byId("idCustDay").getValue();var o=t.allMasterData.customers;var s=[];var d="N";for(var l in o){var n=o[l].Group;var u=t.allMasterData.groups[n].hide;var g=o[l].CustomerCode;if(r===g){d="Y";break}}if(u===true){var p=t.getModel("local").getProperty("/CurrentUser");if(t.getModel("local").oData.AppUsers[p].Role!=="Admin"){i.show("Display of data are not allowed");return}}if(d==="N"){var p=t.getModel("local").getProperty("/CurrentUser");if(t.getModel("local").oData.AppUsers[p].Role!=="Admin"){var c=new a([new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.EQ,"")],true);t.getView().byId("idTable1").getBinding("items").filter(c);i.show("This is Hide Data")}return}},onCashSubmit:function(e){this.getView().byId("idGold").focus()},onGoldSubmit:function(e){this.getView().byId("idSilver").focus()},onSilverSubmit:function(e){this.getView().byId("idRemarks").focus()},onSubmitSideWeight:function(e){this.getView().byId("idtunch").focus()},onSubmitSideTunch:function(e){this.getView().byId("calculateButton").focus()},onSelect:function(e){jQuery.sap.delayedCall(500,this,function(){})},inpField:"",onSelectValue:function(e){var t=e.getParameter("selectedItem");var i=t.getLabel();sap.ui.getCore().byId(this.inpField).setValue(i);var a=this;this.getView().byId("idCustDay").setValue(i)},onSuggest:function(e){const t=e.key;var i=e.getParameter("id").split("--")[2];var a=e.getParameter("suggestValue");if(a===""||t==8||t==="Backspace"||t==="Delete"){this.getView().byId("idCustDay").setValue("");return}if(!a){a=e.getParameter("newValue")}if(a){var r=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,a.toUpperCase()),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,a.toUpperCase())],and:false})}e.getSource().getBinding("suggestionItems").filter(r);var o=new sap.ui.model.Sorter({path:"CustomerCode",descending:false});e.getSource().getBinding("suggestionItems").sort(o);this.getView().byId("idCustDay").setValue(a)}})});
//# sourceMappingURL=dayBook.controller.js.map