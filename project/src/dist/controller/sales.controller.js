sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","victoria/models/formatter","sap/m/MessageToast","sap/m/MessageBox","sap/m/Dialog"],function(e,t,r,a,s,i){"use strict";return e.extend("victoria.controller.sales",{formatter:r,orderAmount:0,finalBal:0,settings:false,noChange:{index:0,flag:"true"},noChangeTable:[],headerNoChange:false,noChangeReturn:false,valueChange:false,onInit:function(t){e.prototype.onInit.apply(this);var r=this.getRouter();r.getRoute("sales").attachMatched(this._onRouteMatched,this);this.byId("idRetailTransfer").setEnabled(false);var a=this;var s=this.getModel("local").getProperty("/CurrentUser");var i=this.getModel("local").oData.AppUsers[s].UserName;i="Hey "+i;this.getView().byId("idUser").setText(i)},_onRouteMatched:function(e){var t=this;var r="";this.onClear(e,r);this.getPrintCustHeaderData();setTimeout(function(){$("input[type='Number']").focus(function(){$(this).select()})},3e3)},getPrintCustHeaderData:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){var r=e.getView().getModel("local").getProperty("/printCustomizing");for(var a=0;a<t.results.length;a++){switch(t.results[a].Name){case"__component0---idPrint--idAdd":r.Address=t.results[a].Value;break;case"__component0---idPrint--idCompName":r.CompName=t.results[a].Value;break;case"__component0---idPrint--idTnC":r.TnC=t.results[a].Value;break;case"__component0---idPrint--idgstn":r.GSTNumber=t.results[a].Value;break;case"__component0---idPrint--idContNo":r.ContNumber=t.results[a].Value;break;case"__component0---idPrint--idMarking":r.Marking=t.results[a].Value;break;default:}}e.getView().getModel("local").setProperty("/printCustomizing",r)}).catch(function(e){})},getIndianCurr:function(e){if(e){var t=e;t=t.toString();var r=t.split(".",2);t=r[0];var a=t.substring(t.length-3);var s=t.substring(0,t.length-3);if(s!="")a=","+a;if(r[1]){var i=s.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a+"."+r[1].match(/\d{0,2}/)}else{var i=s.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a}return i}},onTransfer:function(e){var t=this;var r=new sap.ui.core.Locale("en-US");var i=sap.ui.core.format.NumberFormat.getFloatInstance(r);var o=this.getView().getModel("local").getProperty("/orderHeader");var l=this.getView().getModel("local").getProperty("/orderHeaderTemp");var n=i.parse(l.FinalBalance);var d=o.Customer;var g=l.OrderId;var u=new Date(o.Date);var h=t.getView().getModel("local").getProperty("/EntryData");if(h.Cash===n){var c=t.getView().getModel("i18n").getResourceBundle().getText("noAmountToTransfer");s.show(c,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}else if(h.Cash!==""&&h.Cash!=="0"&&h.Cash!==0&&n&&(n!==""||n!==0)&&t.byId("Sales--idSaveIcon").getColor()==="green"&&h.Cash!==n){var p=this.getView().getModel("local").getProperty("/EntryData");p.Date=new Date(o.Date);p.OrderNo=l.OrderId;p.OrderType="R";var u=this.getView().byId("Sales--DateId").getDateValue();p.Remarks="[Auto-Entry]Retail Transfer for Order"+""+o.OrderNo+" "+u;var m=h.id;p.Cash=0-n;p.Customer=o.Customer;p.ChangedBy="";p.ChangedOn="";p.CreatedBy="";p.CreatedOn="";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Entrys('"+m+"')","PUT",{},p,this).then(function(e){var r=t.getView().getModel("i18n").getResourceBundle().getText("TransferAmountUpdated");a.show(r)})}else if((h.Cash===""||h.Cash==="0"||h.Cash===0)&&t.byId("Sales--idSaveIcon").getColor()==="green"&&n&&(n!==""||n!==0)){t.getView().setBusy(true);var p=this.getView().getModel("local").getProperty("/EntryData");p.Date=o.Date;p.OrderNo=l.OrderId;p.OrderType="R";var u=this.getView().byId("Sales--DateId").getDateValue();p.Remarks="[Auto-Entry]Retail Transfer for Order"+""+o.OrderNo+" "+u;p.Cash=0-n;p.Customer=o.Customer;p.ChangedBy="";p.ChangedOn="";p.CreatedBy="";p.CreatedOn="";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Entrys","POST",{},p,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show("Data Transferred Successfully")}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}else if(!n&&(n===""||n===0)){var c=t.getView().getModel("i18n").getResourceBundle().getText("noAmountToTransfer");s.show(c,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}else{var c=t.getView().getModel("i18n").getResourceBundle().getText("saveBeforeTransfer");s.show(c,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},valueHelpCustomer:function(e){this.getCustomerPopup(e)},onEnter:function(e){this.getCustomer(e)},getRouter:function(){return this.getOwnerComponent().getRouter()},onPrint:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){debugger;e.retailPrint(t)}).catch(function(e){})},retailPrint:function(e){debugger;var t=[];var a=[];var s=this.getView().getModel("local").getProperty("/orderHeaderTemp");var i=this.getView().getModel("local").getProperty("/orderHeader");var o=this.getView().getModel("local").getProperty("/printCustomizing");if(i.Date){var l=i.Date}else{l=new Date}if(typeof l==="string"){var n=parseInt(l.split("-")[2]);var d=parseInt(l.split("-")[1]);var g=parseInt(l.split("-")[0]);if(n<10){n="0"+n}if(d<10){d="0"+d}var u=n+"."+d+"."+g}else{var n=l.getDate();var d=l.getMonth()+1;var g=l.getFullYear();if(n<10){n="0"+n}if(d<10){d="0"+d}var u=n+"."+d+"."+g}if(i.Customer){var h=i.Customer;var c=this.allMasterData.customers[h]}if(s.CustomerId==="SALE"){c.MobilePhone=i.ContactNo;s.CustomerName=i.CustomerName}var p=r.getFormattedDate(0);var m,y,f,v,w,C,b,V,M="Estimate",D,R;for(var I=0;I<e.results.length;I++){switch(e.results[I].Name){case"__component0---idPrint--idRCompName":if(e.results[I].Value==="true"){m=o.CompName}else{t.push("idRCompName")}break;case"__component0---idPrint--idRAddress":if(e.results[I].Value==="true"){y=o.Address}else{t.push("idRAddress")}break;case"__component0---idPrint--idContNo":if(e.results[I].Value==="true"){f=o.ContNumber}else{t.push("idRPhoneNumber")}break;case"__component0---idPrint--idRGSTN":if(e.results[I].Value==="true"){v=o.GSTNumber}else{t.push("idRGSTN")}break;case"__component0---idPrint--idRWeight":if(e.results[I].Value==="false"){t.push("idRWeight")}break;case"__component0---idPrint--idREstimate":if(e.results[I].Value==="true"){M="Estimate"}else{M="Invoice"}break;case"__component0---idPrint--idRSubTotal":if(e.results[I].Value==="false"){t.push("idRSubTotal")}break;case"__component0---idPrint--idRBhav":if(e.results[I].Value==="false"){t.push("idRBhav")}break;case"__component0---idPrint--idRMakingCharge":if(e.results[I].Value==="false"){t.push("idRMakingCharge")}break;case"__component0---idPrint--idRTnC":if(e.results[I].Value==="true"){D=o.TnC}else{t.push("idRTnC")}break;case"__component0---idPrint--idRMarking":if(e.results[I].Value==="true"){R=o.Marking}else{t.push("idRMarking")}break;case"__component0---idPrint--idRQuantity":if(e.results[I].Value==="false"){t.push("idRQuantity")}break;case"__component0---idPrint--idRReturnWeight":if(e.results[I].Value==="false"){t.push("idRReturnWeight")}break;case"__component0---idPrint--idRReturnBhav":if(e.results[I].Value==="false"){t.push("idRReturnBhav")}break;case"__component0---idPrint--idRWeightD":if(e.results[I].Value==="false"){t.push("idRWeightD")}break;case"__component0---idPrint--idRQuantityD":if(e.results[I].Value==="false"){t.push("idRQuantityD")}break;case"__component0---idPrint--idRMakingChargeD":if(e.results[I].Value==="false"){t.push("idRMakingChargeD")}break;case"__component0---idPrint--idRRemarks":if(e.results[I].Value==="false"){t.push("idRRemarks")}break;case"__component0---idPrint--idRReturnRemarks":if(e.results[I].Value==="false"){t.push("idRReturnRemarks")}break;case"__component0---idPrint--idRReturnKattaWeight":if(e.results[I].Value==="false"){t.push("idRReturnKattaWeight")}break;case"__component0---idPrint--idRReturnTunch":if(e.results[I].Value==="false"){t.push("idRReturnTunch")}break;case"__component0---idPrint--idRReturnSubTotal":if(e.results[I].Value==="false"){t.push("idRReturnSubTotal")}default:}}var T='<h2 style="text-align: center;"><strong>'+M+"</strong></h2><hr />"+'<table style="display: inline-block; float: left; width: 450px; height: 100px;">'+"<tbody>"+'<table style="display: inline-block; width: 500px; height: 100px;">'+"<tbody>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Name</strong></td>'+'<td style="width: 350px;">'+s.CustomerName+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Contact</strong></td>'+'<td style="width: 350px;">'+c.MobilePhone+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Print Date</strong></td>'+'<td style="width: 350px;">'+p+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />"+'<table style="width: 900px;">'+"<tbody>"+"<tr>"+'<td style="width: 160px;"><strong>Invoice Number</strong></td>'+'<td style="width: 300px;">&nbsp;'+i.OrderNo+"</td>"+'<td style="width: 150px;"><strong>Date</strong></td>'+'<td style="width: 270px;">&nbsp;'+u+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />";var S="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Material</h4></th>'+'<th class="idRQuantity" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Qty</h4></th>'+'<th class="idRQuantityD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;QtyD</h4></th>'+'<th class="idRWeight" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idRWeightD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">WeightD</h4></th>'+'<th class="idRMakingCharge" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">Making</h4></th>'+'<th class="idRMakingChargeD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">MakingD</h4></th>'+'<th class="idRRemarks" style="width: 80px;border: 1px solid black"><h4 style="text-align: center;">Remarks</h4></th>'+'<th class="idRSubTotal" style="width: 80px;border: 1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>";var P=this.getView().byId("orderItemBases");var O=P.getBinding("rows");var k=0;var x=0;var B=0;for(var I=0;I<O.getLength();I++){if(O.oList[I].MaterialCode){k=k+O.oList[I].Qty;x=x+O.oList[I].Weight;var N=O.oList[I].MaterialCode.concat("-",O.oList[I].Description);if(O.oList[I].Remarks===undefined){O.oList[I].Remarks="  "}S+="<tr>";S+='<td style="width: 80px;border: 1px solid black;">&nbsp;'+N+"</td>"+'<td class="idRQuantity" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].Qty+"</td>"+'<td class="idRQuantityD" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].QtyD+"</td>"+'<td class="idRWeight" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].Weight+"</td>"+'<td class="idRWeightD" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].WeightD+"</td>"+'<td class="idRMakingCharge" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].Making+"</td>"+'<td class="idRMakingChargeD" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].MakingD+"</td>"+'<td class="idRRemarks" style="width: 80px;border: 1px solid black;">&nbsp;'+O.oList[I].Remarks+"</td>"+'<td class="idRSubTotal" style="width: 80px;border: 1px solid black;s">&nbsp;'+O.oList[I].SubTotal+"</td></tr>"}}S+="<tr>"+'<td style="width: 80px;">&nbsp;</td>'+'<td class="idRQuantity" style="width: 80px;"><strong>&nbsp;'+k+"</strong></td>"+'<td class="idRQuantityD" style="width: 80px;">&nbsp;</td>'+'<td class="idRWeight" style="width: 80px;"><strong>&nbsp;'+x+"</strong></td>"+'<td class="idRWeightD" style="width: 80px;">&nbsp;</td>'+'<td class="idRMakingCharge" style="width: 80px;">&nbsp;</td>'+'<td class="idRMakingChargeD" style="width: 80px;">&nbsp;</td>'+'<td class="idRRemarks" style="width: 80px;">&nbsp;</td>'+'<td class="idRSubTotal" style="width: 80px;"><strong>&nbsp;'+s.TotalOrderValue+"</strong></td></tr>";var W=this.getView().getModel("returnModel").getProperty("/TransData");if(W[0].Type){S+="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Product Type</h4></th>'+'<th class="idRReturnQuantity" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Quantity</h4></th>'+'<th class="idRReturnWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idRReturnKattaWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Katta Weight</h4></th>'+'<th class="idRReturnTunch"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Tunch(%)</h4></th>'+'<th class="idRReturnBhav" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Bhav</h4></th>'+'<th class="idRReturnRemarks" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Remarks</h4></th>'+'<th class="idRReturnSubTotal" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>"+"<p><h3>Returns:</h3></p>";for(var I=0;I<W.length;I++){if(W[I].Type){var H=H+W[I].Qty;var Q=Q+W[I].Weight;var E=W[I].Remarks?W[I].Remarks:"";S+="<tr>";S+='<td  style="width: 80px;border:1px solid black">&nbsp;'+W[I].Type+"</td>"+'<td  class="idRReturnQuantity" style="width: 80px;border:1px solid black">&nbsp;'+W[I].Qty+"</td>"+'<td  class="idRReturnWeight"   style="width: 80px;border:1px solid black">&nbsp;'+W[I].Weight+"</td>"+'<td  class="idRReturnKattaWeight"   style="width: 80px;border:1px solid black">&nbsp;'+W[I].KWeight+"</td>"+'<td  class="idRReturnTunch"   style="width: 80px;border:1px solid black">&nbsp;'+W[I].Tunch+"</td>"+'<td  class="idRReturnBhav"     style="width: 80px;border:1px solid black">&nbsp;'+W[I].Bhav+"</td>"+'<td  class="idRReturnRemarks"     style="width: 80px;border:1px solid black">&nbsp;'+E+"</td>"+'<td  class="idRReturnSubTotal" style="width: 80px;border:1px solid black">&nbsp;'+W[I].SubTotal+"</td></tr>"}}S+="<tr>"+'<td style="width: 80px;"><strong>&nbsp;Final Balance</strong></td>'+'<td class="idRReturnQuantity" style="width: 80px;">&nbsp;'+"</td>"+'<td class="idRReturnWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnKattaWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnTunch" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnBhav" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnRemarks" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnSubTotal" style="width: 80px;"><strong>&nbsp;'+s.FinalBalance+"</strong></td></tr>"}S+="</table>";var F='<table style="height: 40px; width: 950px;">'+"<tbody>"+"<tr>"+'<td class="idRTnC" style="width: 150px;"><strong>Terms &amp; Conditions:</strong></td>'+'<td class="idRTnC" style="width: 800px;">&nbsp;'+D+"</td>"+"</tr>"+"<tr>"+'<td class="idRMarking" style="width: 150px;">&nbsp;<strong>Marking:</strong></td>'+'<td class="idRMarking" style="width: 800px;">&nbsp;'+R+"</td>"+"</tr>"+"</tbody></table>";var A=Math.floor(Math.random()*1e4);var _=window.open("","PrintWindow"+A,"width=1200,height=800");_.document.write(T+S+F);for(var I=0;I<t.length;I++){var L=_.document.getElementsByClassName(t[I]);for(var G=0;G<L.length;G++){L[G].style.display="none"}}_.document.close();_.focus();setTimeout(function(){_.print();_.stop()},1500)},onSubmitQuantity:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[3].focus()},onSubmitQuantityD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[4].focus(e)},onSubmitWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[5].focus()},onSubmitWeightD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[6].focus(e)},onSubmitMaking:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[7].focus()},onSubmitMakingD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[8].focus()},onSubmitTunch:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[9].focus()},onSubmitRemarks:function(e){var t=e.getSource();var r=t.getParent();r.getParent().getRows()[r.getIndex()+1].getCells()[0].focus()},onReturnSubmitWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[2].focus()},onReturnSubmitKWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[3].focus()},onReturnSubmitTunch:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[4].focus()},onReturnSubmitQty:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[5].focus()},onReturnSubmitBhav:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[6].focus()},onReturnSubmitDropdown:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[1].focus()},onConfirm:function(e){var t=this;if(e.getParameters().selectedItem.mBindingInfos.label.binding.sPath==="OrderNo"){this.byId("Sales--idSaveIcon").setColor("green");this.byId("idRetailTransfer").setEnabled(true);delete this.orderAmount;delete this.deduction;var r=e.getSource().getParent().getId().split("---")[1];var a=this.getView().getModel("local").getProperty("/orderHeader/Date");var s=this.getView().getModel("local").getProperty("/orderHeader");this.orderItem(e,r);this.materialPopupOrderItem(e,r);this.orderReturn(e,r);this.setWidths(false);var i=e.getParameter("selectedItem").getLabel();var o=e.getParameter("selectedItem").getBindingContextPath().split("'")[1];this.getView().getModel("local").setProperty("/orderHeader/OrderNo",i);this.getView().getModel("local").setProperty("/orderHeader/Date",a);if(s.Customer){this.byId("Sales--idSaveIcon").setColor("red");var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,s.Customer)}else{var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}e.sId="orderReload";this.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",o);this.getOrderDetails(e,o,l,i);this.byId("Sales--idSaveIcon").setColor("green")}else{var n=this.getView().getModel("local").getProperty("/orderHeaderTemp");var d=e.getParameter("selectedItem").getLabel();var g=e.getParameter("selectedItem").getValue();n.CustomerId=d;n.CustomerName=g;this.getView().byId("Sales--custName").setText(g);this.getView().getModel("local").setProperty("/orderHeader/Customer",e.getParameter("selectedItem").getBindingContextPath().split("'")[1]);this.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",d);this.getView().byId("__component0---idsales--Sales--idCustomerNameForSale").setVisible(d==="SALE").getFields()[0].setValue();this.getView().byId("__component0---idsales--Sales--idCustomerCityForSale").setVisible(d==="SALE").getFields()[0].setValue()}},onPayDateChange:function(e){if(e.getParameter("newValue")){this.getView().getModel("local").setProperty("/orderHeader/Date",e.getParameter("newValue"))}},getEntryData:function(e,t,r,a,s){var i;var o=this;var l=a;var n=this.getView().getModel("local").getProperty("/orderHeaderTemp/OrderId");var d=this.getView().getModel("local").getProperty("/EntryData");d.OrderNo=n;d.Date=l;d.Customer=t;$.post("/EntryTransfer",{entryData:d}).then(function(e){s.Customer=e.Customer;s.Cash=e.Cash;s.OrderNo=e.OrderNo;s.id=e.id;i=true});return i},getOrderDetails:function(e,t,r,a){var s=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')","GET",{filters:[r]},{},this).then(function(r){var a=r.Date;var i=r.Customer;var o=s.allMasterData.customers[i];var l=o.City;s.getView().getModel("local").setProperty("/orderHeader",r);s.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",o.CustomerCode);s.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerName",o.Name+" - "+s.allMasterData.cities[l].cityName);s.getView().byId("Sales--custName").setText(o.Name+" - "+s.allMasterData.cities[l].cityName);var n=s.getView().getModel("local").getProperty("/EntryData");s.ODataHelper.callOData(s.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')/ToOrderItems","GET",{},{},s).then(function(t){if(t.results.length>0){var r=s.getView().getModel("orderItems").getProperty("/itemData");for(var a=0;a<t.results.length;a++){r[a].OrderNo=t.results[a].OrderNo;r[a].itemNo=t.results[a].id;r[a].Making=t.results[a].Making;r[a].MakingD=t.results[a].MakingD;r[a].Qty=t.results[a].Qty;r[a].QtyD=t.results[a].QtyD;r[a].Weight=t.results[a].Weight;r[a].WeightD=t.results[a].WeightD;r[a].Remarks=t.results[a].Remarks;var i=s.allMasterData.materials[t.results[a].Material];r[a].Material=t.results[a].Material;r[a].Description=i.ProductName;r[a].MaterialCode=i.ProductCode;var o="/itemData"+"/"+a;e.sId="orderReload";s.Calculation(e,o,a)}s.getView().getModel("orderItems").setProperty("/itemData",r)}}).catch(function(e){s.getView().setBusy(false);var t=s.getErrorMessage(e)});s.ODataHelper.callOData(s.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')/ToOrderReturns","GET",{},{},s).then(function(t){if(t.results.length>0){var r=s.getView().getModel("returnModel").getProperty("/TransData");for(var a=0;a<t.results.length;a++){r[a].ReturnId=t.results[a].id;r[a].Type=t.results[a].Type;r[a].Weight=t.results[a].Weight;r[a].KWeight=t.results[a].KWeight;r[a].Tunch=t.results[a].Tunch;r[a].Qty=t.results[a].Qty;r[a].Bhav=t.results[a].Bhav;r[a].Key=t.results[a].Key;r[a].Remarks=t.results[a].Remarks;s.getView().getModel("returnModel").setProperty("/TransData",r);var i="/TransData"+"/"+a;e.sId="orderReload";var o=s.getView().getModel("local").getProperty("/orderHeader");s.returnCalculation(e,o,i)}}}).catch(function(e){s.getView().setBusy(false);var t=s.getErrorMessage(e)})}).catch(function(e){s.getView().setBusy(false);var t=s.getErrorMessage(e)})},valueHelpOrder:function(e){this.orderPopup(e)},onCancel:function(e){},orderCreate:function(e){var t=this;var r=t.getView().getModel("local").getProperty("/orderHeader").Customer;if(this.getView().getModel("local").getProperty("/orderHeader").OrderNo){var a=e.getSource().getParent().getParent().getParent().getId().split("---")[1].split("--")[0];var i=this.getView().getModel("i18n").getResourceBundle().getText("deleteUnsaveData");sap.m.MessageBox.confirm(i,{title:"Confirm",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(i){if(i===s.Action.OK){var o=t.getView().getModel("local").getProperty("/orderHeader").Date;var l=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerId;var n=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerName;var d=t.getView().getModel("local").getProperty("/orderHeader");t.onClear(e,a);t.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",l);t.getView().byId("Sales--custName").setText(n);t.getView().getModel("local").setProperty("/orderHeader/Customer",r);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/CustomCalculations","GET",{},{},t).then(function(e){t.orderCheck()}).catch(function(e){t.getView().getModel("local").setProperty("/orderHeader/GoldBhav22",0);t.getView().getModel("local").setProperty("/orderHeader/GoldBhav20",0);t.getView().getModel("local").setProperty("/orderHeader/GoldBhav",0);t.getView().getModel("local").setProperty("/orderHeader/SilverBhav",0)})}}})}else{var o=this.getView().byId("Sales--DateId").getValue();$.get("/getOrderNoForSale?Date="+o,{}).then(function(e){t.orderCheck(e.OrderNo)}).catch(function(e){if(r===""){t.getView().byId("Sales--customerId").setValueState("Error").setValueStateText("Mandatory Input");t.getView().setBusy(false)}else if(e.responseText.includes("last order already empty use same")){var a=e.responseText.split(":")[1];if(a){var s=t.getView().getModel("local").getProperty("/orderHeader/Customer");t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/OrderHeaders("+a+")","GET",{},{},t).then(function(e){t.getView().setBusy(false);var r=t.getView().getModel("local").getProperty("/orderHeader");var a=t.getView().getModel("local").getProperty("/OrderId");r.OrderNo=e.OrderNo;r.Customer=s;a.OrderId=e.id;a.OrderNo=e.OrderNo;t.headerNoChange=true;t.getView().getModel("local").setProperty("/OrderId",a);t.getView().getModel("local").setProperty("/orderHeader",r);t.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",e.id);var i=t.getView().getModel("i18n").getResourceBundle().getText("orderReloadMessage");sap.m.MessageToast.show(i,{duration:3e3,width:"15em"})}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}else{t.getView().setBusy(false);var i=t.getErrorMessage(e)}}else{t.getView().setBusy(false);var i=t.getErrorMessage(e)}})}},orderCheck:function(e){var t=this;t.getView().setBusy(true);t.byId("Sales--idSaveIcon").setColor("red");var r=this.getView().getModel("local").getProperty("/orderHeader");if(r.Customer===""){this.getView().byId("Sales--customerId").setValueState("Error").setValueStateText("Mandatory Input");t.getView().setBusy(false)}else{if(r){r.id="";r.CreatedBy="";r.ChangedBy="";r.CreatedOn="";r.CreatedBy="";delete r.ToOrderItems;delete r.ToCustomers;delete r.ToOrderReturns;t.orderCustomCalculations()}this.getView().byId("Sales--customerId").setValueState("None");r.Date=this.getView().byId("Sales--DateId").getValue();r.OrderNo=e;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders","POST",{},r,this).then(function(e){t.getView().setBusy(false);var r=t.getView().getModel("local").getProperty("/OrderId");r.OrderId=e.id;r.OrderNo=e.OrderNo;t.getView().getModel("local").setProperty("/OrderId",r);t.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",e.id);t.getView().getModel("local").setProperty("/orderHeader/OrderNo",e.OrderNo)}).catch(function(e){s.error("Error in creating order")})}},onValidation:function(){var e=this;var t=true;var r=this.getView().getModel("local").getProperty("/orderHeader");if(r.OrderNo===0||r.OrderNo===""){t=false;var a=e.getView().getModel("i18n").getResourceBundle().getText("orderValidation");s.show(a,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}e.getView().setBusy(false);return t},onValidationItem:function(e,t){var r=this;var a=this.getView().getModel("orderItems").getProperty("/itemData");var s=r.getView().getModel("local").getProperty("/OrderItem");var i=r.getView().byId("orderItemBases");var o=i.getBinding("rows");var l=false;if(e.Weight&&e.WeightD&&e.WeightD>=e.Weight){if(this.settings===true){i.getRows()[t].getCells()[3].setValueState("Error")}else{i.getRows()[t].getCells()[4].setValueState("Error");i.getRows()[t].getCells()[5].setValueState("Error");l=true;this.getView().setBusy(false);return}}else{if(this.settings===true){i.getRows()[t].getCells()[3].setValueState("None")}else{i.getRows()[t].getCells()[4].setValueState("None");i.getRows()[t].getCells()[5].setValueState("None")}}if(e.Type==="GS"||(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs")){if(e.Qty===""||e.Qty===0||e.Qty==="0"){this.getView().setBusy(false);if(this.settings===true){i.getRows()[t].getCells()[2].setValueState("Error");i.getRows()[t].getCells()[3].setValueState("None")}else{i.getRows()[t].getCells()[2].setValueState("Error");i.getRows()[t].getCells()[4].setValueState("None")}l=true;return}else{s.Qty=e.Qty;i.getRows()[t].getCells()[2].setValueState("None");this.getView().setBusy(false)}}else if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(e.Weight===""||e.Weight===0||e.Weight==="0"){this.getView().setBusy(false);if(this.settings===true){i.getRows()[t].getCells()[3].setValueState("Error");i.getRows()[t].getCells()[2].setValueState("None")}else{i.getRows()[t].getCells()[4].setValueState("Error");i.getRows()[t].getCells()[2].setValueState("None")}l=true;return}else{s.Weight=e.Weight;if(this.settings===true){i.getRows()[t].getCells()[3].setValueState("None")}else{i.getRows()[t].getCells()[4].setValueState("None")}this.getView().setBusy(false)}}return l},onReturnSave:function(e,t,r,a){var s=this.getView().getModel("local").getProperty("/OrderReturn");var i=this.getView().byId("OrderReturn");var o=i.getBinding("rows");for(var l=0;l<o.getLength();l++){var n=this;var d=o.oList[l];if(d.Key!=""){s.Key=d.Key;if(d.Type===""||d.Type===0){s.Type=0}else{s.Type=d.Type;if(t||t!=""){s.OrderNo=t}else if(a.id){s.OrderNo=a.id}if(d.Weight===""||d.Weight===0){s.Weight=0}else{s.Weight=d.Weight}if(d.KWeight===""||d.KWeight===0){s.KWeight=0}else{s.KWeight=d.KWeight}if(d.Tunch===""||d.Tunch===0){s.Tunch=0}else{s.Tunch=d.Tunch}if(d.Qty===""||d.Qty===0){s.Qty=0}else{s.Qty=d.Qty}if(d.Bhav===""||d.Bhav===0){s.Bhav=0}else{s.Bhav=d.Bhav}if(d.Remarks===""){s.Remarks=""}else{s.Remarks=d.Remarks}var g=JSON.parse(JSON.stringify(s));if(d.ReturnId){}else{n.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderReturns","POST",{},g,n).then(function(e){n.getView().setBusy(false);var a=n.getView().getModel("returnModel").getProperty("/TransData");for(var s=0;s<a.length;s++){if(a[s].Type===e.Type&&a[s].ReturnId===""){a[s].ReturnId=e.id;a[s].orderNo=t;r=true;break}}n.getView().getModel("returnModel").setProperty("/TransData",a);n.getView().setBusy(false);var i=n.getView().getModel("i18n").getResourceBundle().getText("dataSave");sap.m.MessageToast.show(i)}).catch(function(e){n.getView().setBusy(false);var t=n.getErrorMessage(e)})}}}}return r},ValueChangeHeader:function(e){var t=this;var r=t.getView().getModel("local").getProperty("/orderHeader");var a=this.getView().byId("orderItemBases").getBinding("rows");var s=a.getPath();var i=a.getLength();var o=e.getSource().getId().split("---")[1].split("--")[2];var l=e.getParameter("newValue");var n=new sap.ui.core.Locale("en-US");var d=sap.ui.core.format.NumberFormat.getFloatInstance(n);this.headerNoChange=true;if(o==="Gbhav2Id"){if(l===""){r.GoldBhav22=0;this.headerNoChange=true}else if(l===0){r.GoldBhav22=0}else{r.GoldBhav22=d.parse(l)}}else if(o==="Gbhav1Id"){if(l===""){r.GoldBhav20=0}else if(l===0){r.GoldBhav20=0}else{r.GoldBhav20=d.parse(l)}}else if(o==="GoldbhavId"){}else if(o==="sbhavid"){}t.getView().getModel("local").setProperty("/orderHeader",r);for(var g=0;g<i;g++){var u=s+"/"+g;this.Calculation(e,u,g);this.noChangeTable.push(this.noChange)}},onSave:function(e){var t=this;if(this.onValidation()===true){var r=this.getView().getModel("local").getProperty("/OrderItem");var a=this.getView().byId("orderItemBases");var s=a.getBinding("rows");var i=false;var o=false;var l=false;for(var n=0;n<s.getLength();n++){var t=this;var d=s.oList[n];if(d.Material!==""){o=true;if(n===0&&l===false){if(this.onRetItemValidation()===false){l=true}}this.getView().setBusy(true);var g=false;if(this.onValidationItem(d,n,g)===false){i=false}else{i=true}}}if(l===true&&i===false){this.commitRecords(e)}if(o===false){var u=t.getView().getModel("i18n").getResourceBundle().getText("validEntries");sap.m.MessageBox.error(u,{title:"Error",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){}})}}else{this.byId("idRetailTransfer").setEnabled(true)}if(o===true&&l===true&&i===false){var h=true;this.byId("idRetailTransfer").setEnabled(true);return h}},commitRecords:function(e){if(this.byId("Sales--idSaveIcon").getColor()==="red"){var t=this;var r=t.getView().getModel("local").getProperty("/orderHeader");var a=t.getView().getModel("local").getProperty("/orderHeaderTemp").OrderId;if(this.headerNoChange===true){r.Date=new Date(r.Date);var s=JSON.parse(JSON.stringify(r));$.post("/updateRetailOrderHdr",{OrderDetails:s}).done(function(e,t){sap.m.MessageToast.show("Order Header updated")}).fail(function(e,t,r){sap.m.MessageBox.error("Failed to update Header")});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders('"+a+"')","PUT",{},r,this).then(function(e){var r=t.getView().getModel("i18n").getResourceBundle().getText("orderSave");sap.m.MessageToast.show(r);t.getView().setBusy(false)}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}var i=this.getView().getModel("local").getProperty("/OrderItem");var o=this.getView().byId("orderItemBases");var l=o.getBinding("rows");var n=false;var d=false;for(var g=0;g<l.getLength();g++){var t=this;var u=l.oList[g];if(u.Material!==""){if(a!=""){i.OrderNo=a;this.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",a)}else if(r.id){i.OrderNo=r.id;this.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",r.id)}i.Material=u.Material;if(u.Qty===""||u.Qty===0){i.Qty=0}else{i.Qty=u.Qty}if(u.QtyD===""||u.QtyD===0){i.QtyD=0}else{i.QtyD=u.QtyD}if(u.Weight===""||u.Weight===0){i.Weight=0}else{i.Weight=u.Weight}if(u.WeightD===""||u.WeightD===0){i.WeightD=0}else{i.WeightD=u.WeightD}if(u.Making===""||u.Making===0){i.Making=0}else{i.Making=u.Making}if(u.MakingD===""||u.MakingD===0){i.MakingD=0}else{i.MakingD=u.MakingD}i.Remarks=u.Remarks;var h=JSON.parse(JSON.stringify(i));if(u.itemNo){}else{t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderItems","POST",{},h,this).then(function(e){var r=t.getView().getModel("orderItems").getProperty("/itemData");t.getView().setBusy(false);for(var s=0;s<r.length;s++){if(r[s].Material===e.Material&&r[s].itemNo===""){r[s].itemNo=e.id;r[s].OrderNo=a;t.stockTransfer(r[s]);break}}t.getView().getModel("orderItems").setProperty("/itemData",r);t.getView().setBusy(false);var i=t.getView().getModel("i18n").getResourceBundle().getText("dataSucess");sap.m.MessageToast.show(i)}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)});t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+h.Material+"')","PUT",{},{CustomerMaking:h.Making},t).then(function(e){}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}}}if(d===false){t.onReturnSave(e,a,d,r)}t.byId("Sales--idSaveIcon").setColor("green");this.byId("idRetailTransfer").setEnabled(true)}else{var c=this.getView().getModel("i18n").getResourceBundle().getText("dataNoChnage");sap.m.MessageBox.error(c,{title:"Error",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){}})}},stockTransfer:function(e){var t=this;var r=this.getView().getModel("local").getProperty("/orderHeader/OrderNo");var a=this.getView().getModel("local").getProperty("/orderHeader/Date");var s=this.getView().getModel("local").getProperty("/stockMaint");s.Product=e.Material;s.Description=e.MaterialCode;if(e.Qty===""){s.Quantity="0"}else{s.Quantity=e.Qty}if(e.Weight===""){s.Weight="0"}else{s.Weight=e.Weight}s.OrderItemId=e.itemNo;s.OrderType="R";s.Date=a;s.Remarks="[Auto-Entry]Retail Sales Stock "+"for order"+" "+r;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/stockMaints","POST",{},s,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show("Stock Updated Successfully")}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})},onClearScreen:function(e){var t=this;var r=this.byId("Sales--idSaveIcon").getColor();if(!i){var i=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[1]}if(r=="red"){var o=t.getView().getModel("i18n").getResourceBundle().getText("clearConfirmation");sap.m.MessageBox.error(o,{title:"Alert!",actions:["Save & Clear","Clear",s.Action.CANCEL],onClose:function(r){if(r==="Clear"){t.onClear(e,i);t.byId("Sales--idSaveIcon").setColor("green");var s=t.getView().getModel("i18n").getResourceBundle().getText("clearSucess");a.show(s)}else if(r==="Save & Clear"){if(t.onSave(e)){t.onClear(e,i);a.show("Data has been Saved! Screen cleared successfully!")}}}})}else{t.onClear(e,i);t.byId("Sales--idSaveIcon").setColor("green");var o=t.getView().getModel("i18n").getResourceBundle().getText("clearSucess");a.show(o)}},onClear:function(e,t){var a=this;delete this.orderAmount;delete this.deduction;delete this.finalBal;this.settings=false;a.byId("Sales--idSaveIcon").setColor("green");var s=new sap.ui.model.json.JSONModel({set:true});this.setModel(s,"VisibleSet");var i=this.getView().getModel("local").getProperty("/orderHeader");var o=this.getView().getModel("local").getProperty("/orderHeaderTemp");this.getView().byId("Sales--custName").setText("");o.CustomerId="";o.FinalBalance="0";o.Deduction="0";o.TotalOrderValue="0";i.OrderNo="";i.CustomerName=null;i.ContactNo=null;i.Customer="";i.GoldBhav22=0;i.GoldBhav20=0;i.GoldBhav=0;i.SilverBhav=0;this.getView().getModel("local").setProperty("/orderHeaderTemp",o);a.getView().getModel("local").setProperty("/orderHeader",i);a.getView().getModel("local").setProperty("/orderHeader/Date",r.getFormattedDate(0));a.getView().byId("Sales--DateId").setDateValue(new Date);var l=a.getView().getModel("local").getProperty("/EntryData");l.Customer="";l.Date="";l.OrderNo="";l.OrderType="";l.Remarks="";l.id="";l.Cash="";l.ChangedBy="";l.ChangedOn="";l.CreatedBy="";l.CreatedOn="";a.getView().getModel("local").setProperty("/EntryData",l);this.orderCustomCalculations();this.orderItem(e,t);this.materialPopupOrderItem(e,t);this.orderReturn(e,t);this.setWidths(false)},setWidths:function(e){var t=this.getView().byId("orderItemBases");var r=this.getView().byId("OrderReturn");var a=t.getBinding("rows");if(e===false){t.getColumns()[0].setWidth("10%");t.getColumns()[1].setWidth("15%");t.getColumns()[2].setWidth("5%");t.getColumns()[3].setWidth("5%");t.getColumns()[4].setWidth("10%");t.getColumns()[5].setWidth("10%");t.getColumns()[6].setWidth("10%");t.getColumns()[7].setWidth("10%");t.getColumns()[8].setWidth("10%");t.getColumns()[9].setWidth("15%");for(var s=0;s<t.getRows().length;s++){t.getRows()[s].getCells()[2].setValueState("None");t.getRows()[s].getCells()[4].setValueState("None");t.getRows()[s].getCells()[5].setValueState("None")}}else{for(var s=0;s<t.getRows().length;s++){t.getRows()[s].getCells()[2].setValueState("None");t.getRows()[s].getCells()[3].setValueState("None");t.getRows()[s].getCells()[4].setValueState("None")}}for(var s=0;s<r.getRows().length;s++){r.getRows()[s].getCells()[1].setValueState("None");r.getRows()[s].getCells()[2].setValueState("None");r.getRows()[s].getCells()[3].setValueState("None");r.getRows()[s].getCells()[4].setValueState("None");r.getRows()[s].getCells()[5].setValueState("None")}},onDelete:function(e){var t=this;var r=new sap.ui.core.Locale("en-US");var a=sap.ui.core.format.NumberFormat.getFloatInstance(r);var i=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[0];var o=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[1];var l=t.getView().byId(o).getSelectedIndices();if(l.length&&l.length!==0){sap.m.MessageBox.confirm("Are you sure to delete the selected entries",{title:"Confirm",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(r){if(r===s.Action.OK){for(var n=l.length-1;n>=0;--n){if(o==="orderItemBases"){var d=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]];var g=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]].itemNo;var u=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]].Material;var h=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]].OrderNo;var c=t.getView().byId("Sales--DateId").getDateValue();var p=a.parse(d.SubTotal);if(p){t.orderAmount=t.orderAmount-p;var m=t.getIndianCurr(t.orderAmount);t.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",m)}t.finalBal=t.orderAmount-t.deduction;if(this.finalBal===0){var y=0}else{var y=t.getIndianCurr(t.finalBal)}t.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalance",y);if(g){var f=t.getView().getModel("local").getProperty("/stockMaint");f.Product=u;f.OrderItemId=g;f.Date=c;f.Weight=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]].Weight;f.Quantity=t.getView().getModel("orderItems").getProperty("/itemData")[l[n]].Qty;t.byId("Sales--idSaveIcon").setColor("green");t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/OrderItems('"+g+"')","DELETE",{},{},t);$.post("/StockDelete",{Stock:f}).then(function(e){var r=e.id;t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/stockMaints('"+r+"')","DELETE",{},{},t)});sap.m.MessageToast.show("Data Deleted Successfully")}else{t.byId("Sales--idSaveIcon").setColor("red")}var v=t.getView().getModel("orderItems").getProperty("/itemData");v.splice(l[n],1);t.getView().getModel("orderItems").setProperty("/itemData",v);v.push({OrderNo:"",itemNo:"",Material:"",MaterialCode:"",Description:"",Qty:0,QtyD:0,Weight:0,WeightD:0,Making:0,MakingD:0,Tunch:0,Remarks:"",SubTotal:0,SubTotalS:0,SubTotalG:0,Category:"",CreatedBy:"",CreatedOn:"",ChangedBy:"",ChangedOn:""});t.getView().getModel("orderItems").setProperty("/itemData",v)}else if(o==="OrderReturn"){t.deleteReturnValues(e,n,l[n],i,v)}}if(o==="orderItemBases"){t.getView().byId("orderItemBases").clearSelection()}else{t.getView().byId("OrderReturn").clearSelection()}}}})}else{var n=t.getView().getModel("i18n").getResourceBundle().getText("selecteDeleteItem");s.show(n,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},onSetting:function(e){this.settings=true;this.hideDColumns(e)},previousOrder:function(e){var t=this.getView().byId("Sales--DateId").getDateValue();var r=new Date(t);r.setDate(t.getDate());r.setHours(0,0,0,1);var a=new Date(t);a.setDate(t.getDate());a.setHours(23,59,59,59);var s=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.GE,r);var i=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.LE,a);var o=new sap.ui.model.Filter({filters:[s,i],and:true});var l=this;this.setWidths(false);var n=this.getView().getModel("local").getProperty("/orderHeader");$.post("/previousOrder",{OrderDetails:n}).then(function(t){l.byId("idRetailTransfer").setEnabled(true);console.log(t);if(t){delete l.orderAmount;delete l.deduction;delete l.finalBal;var r=l.getView().getModel("local").getProperty("/orderHeaderTemp");r.FinalBalance="0";r.Deduction="0";r.TotalOrderValue="0";l.getView().getModel("local").setProperty("/orderHeaderTemp",r);var a=t.id;l.byId("Sales--idSaveIcon").setColor("green");if(t.Customer){var s=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t.Customer)}else{var s=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}var i="sales";l.orderItem(e,i);l.orderReturn(e,i);e.sId="orderReload";l.getOrderDetails(e,a,s);if(!l.navigation){var s=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"");l.getOrderDetails(e,t.id,o);l.orderSearchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",l);l.getView().addDependent(l.orderSearchPopup);l.orderSearchPopup.bindAggregation("items",{path:"/OrderHeaders",filters:o,template:new sap.m.DisplayListItem({label:"{OrderNo}",value:{path:"Customer",formatter:l.getCustomerName.bind(l)}})});l.navigation=true}}})},changeInMaterial:function(e){},nextOrder:function(e){var t=this.getView().byId("Sales--DateId").getDateValue();var r=new Date(t);r.setDate(t.getDate());r.setHours(0,0,0,1);var a=new Date(t);a.setDate(t.getDate());a.setHours(23,59,59,59);var s=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.GE,r);var i=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.LE,a);var o=new sap.ui.model.Filter({filters:[s,i],and:true});var l=this;this.setWidths(false);var n=this.getView().getModel("local").getProperty("/orderHeader");if(!n.OrderNo&&false){this.orderPopup(e);this.ODataHelper.callOData(l.getOwnerComponent().getModel(),"/OrderHeaders","GET",{filters:[o]},{},l).then(function(t){var r=t.results.length;if(r==0){sap.m.MessageToast.show("No orders for selected date")}else{var a=t.results[0];var s=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"");l.getOrderDetails(e,a.id,o);l.orderSearchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",l);l.getView().addDependent(l.orderSearchPopup);l.orderSearchPopup.bindAggregation("items",{path:"/OrderHeaders",filters:o,template:new sap.m.DisplayListItem({label:"{OrderNo}",value:{path:"Customer",formatter:l.getCustomerName.bind(l)}})})}})}else{$.post("/nextOrder",{OrderDetails:n}).then(function(t){console.log(t);l.byId("idRetailTransfer").setEnabled(true);if(t){var r="sales";delete l.orderAmount;delete l.deduction;delete l.finalBal;var a=l.getView().getModel("local").getProperty("/orderHeaderTemp");a.FinalBalance="0";a.Deduction="0";a.TotalOrderValue="0";l.getView().getModel("local").setProperty("/orderHeaderTemp",a);l.orderItem(e,r);l.orderReturn(e,r);var s=t.id;l.byId("Sales--idSaveIcon").setColor("green");if(t.Customer){var i=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t.Customer)}else{var i=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}e.sId="orderReload";l.getOrderDetails(e,s,i);if(!l.navigation){var i=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"");l.getOrderDetails(e,t.id,o);l.orderSearchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",l);l.getView().addDependent(l.orderSearchPopup);l.orderSearchPopup.bindAggregation("items",{path:"/OrderHeaders",filters:o,template:new sap.m.DisplayListItem({label:"{OrderNo}",value:{path:"Customer",formatter:l.getCustomerName.bind(l)}})});l.navigation=true}}})}},getTotals:function(e){var t=this.getView().getModel("local").getProperty("/orderHeaderTemp");var r=new sap.ui.core.Locale("en-US");var a=sap.ui.core.format.NumberFormat.getFloatInstance(r);if(t.FinalBalance&&t.FinalBalance!==""){this.finalBal=a.parse(t.FinalBalance)}if(t.TotalOrderValue&&t.TotalOrderValue!==""){this.orderAmount=a.parse(t.TotalOrderValue)}if(t.Deduction&&t.Deduction!==""){this.deduction=a.parse(t.Deduction)}},ValueChange:function(e){var t="";var r="";this.getTotals(e);this.Calculation(e,t,r);this.noChangeTable.push(this.noChange);this.byId("Sales--idSaveIcon").setColor("red")},setNewValue:function(e,t,r){if(t==="IdWeight"){if(e.Weight!==r){e.Weight=r}}if(t==="IdWeightD"){if(e.WeightD!==r){e.WeightD=r}}if(t==="IdMaking"){if(e.Making!==r){e.Making=r}}if(t==="IdMakingD"){if(e.MakingD!==r){e.MakingD=r}}if(t==="IdQtyD"){if(e.QtyD!==r){e.QtyD=r}}if(t==="IdQty"){if(e.Qty!==r){e.Qty=r}}},getFloatValue:function(e,t,r){if(e.Making){if(e.Making===""){e.Making=0}else if(e.Making===0){e.Making=0}else{var a=e.Making.toString();e.Making=t.parse(a)}}else{e.Making=0}if(e.MakingD){if(e.MakingD===""){e.MakingD=0;s=0}else if(e.MakingD===0){e.MakingD=0;s=0}else{var s=e.MakingD.toString();e.MakingD=t.parse(s)}}else{e.MakingD=0;s=0}if(e.Weight){if(e.Weight===""){e.Weight=0}else if(e.Weight===0){e.Weight=0}else{var i=e.Weight.toString();e.Weight=t.parse(i)}}else{e.Weight=0}if(e.WeightD){if(e.WeightD===""){e.WeightD=0}else if(e.WeightD===0){e.WeightD=0}else{var o=e.WeightD.toString();e.WeightD=t.parse(o)}}else{e.WeightD=0}if(e.Qty){if(e.Qty===""){e.Qty=0}else if(e.Qty===0){e.Qty=0}else{var l=e.Qty.toString();e.Qty=t.parse(l)}}else{e.Qty=0}if(e.QtyD){if(e.QtyD===""){e.QtyD=0;r=0}else if(e.QtyD===0){e.QtyD=0;r=0}else{var n=e.QtyD.toString();e.QtyD=t.parse(n);r=e.QtyD}}else{e.QtyD=0}},deleteReturn:function(e,t){var r=this.getView().getModel("local").getProperty("/orderHeaderTemp");var a=new sap.ui.core.Locale("en-US");var s=sap.ui.core.format.NumberFormat.getFloatInstance(a);var i=s.parse(this.getView().getModel("returnModel").getProperty("/TransData")[t].SubTotal);this.deduction=this.deduction-i;if(this.deduction===0){this.finalBal=this.orderAmount}else{this.finalBal=this.orderAmount-this.deduction}if(this.deduction&&this.deduction!==""){r.Deduction=this.getIndianCurr(this.deduction)}else{r.Deduction=0}if(this.orderAmount&&this.orderAmount!==""){r.TotalOrderValue=this.getIndianCurr(this.orderAmount)}if(this.finalBal&&this.finalBal!==""){r.FinalBalance=this.getIndianCurr(this.finalBal)}this.getView().getModel("local").setProperty("/orderHeaderTemp",r)},finalCalculation:function(e,t,r,a,s,i,o,l,n){debugger;var d=new sap.ui.core.Locale("en-US");var g=sap.ui.core.format.NumberFormat.getFloatInstance(d);var u=t.Weight*t.Qty;var h=t.WeightD*t.QtyD;if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="GLD"&&e.Category==="gm"||e.Type==="SLV"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(t.WeightD!==""||t.WeightD!==0){var c=t.Weight-t.WeightD}else{var c=t.Weight}if(e.Type==="Gold"||e.Type==="GLD"){if(e.Karat==="22/22"){r=c*l}else if(e.Karat==="22/20"){r=c*o}}else if(e.Type==="Silver"||e.Type==="SLV"){r=c*n}var p=t.Making*c;var m=i*t.MakingD;if(r||p||m||(r===0||p===0||m===0)){var y=r+p+m;if(t.SubTotal&&t.SubTotal!=""){var f=g.parse(t.SubTotal);this.orderAmount=y+this.orderAmount-f}else{t.SubTotal=0;this.orderAmount=y+this.orderAmount;var v=this.orderAmount}var v=this.orderAmount;var v=v.toString();var w=this.getIndianCurr(v);this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",w);var C=this.getIndianCurr(y);if(a){if(C){e.SubTotal=C}else{e.SubTotal=0}this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{if(C!=""){s[s.length-1].setText(C)}else{s[s.length-1].setText("0")}}}else{s[s.length-1].setText(0)}}else if(e.Type==="GS"){var b=t.Qty*t.Making;var V=t.QtyD*t.MakingD;if(b){var y=b+V;var C=this.getIndianCurr(y);if(t.SubTotal&&t.SubTotal!=""){var f=g.parse(t.SubTotal);this.orderAmount=y+this.orderAmount-f}else{this.orderAmount=y+this.orderAmount}var v=this.orderAmount;var v=v.toString();var w=this.getIndianCurr(v);this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",w);if(a){e.SubTotal=C;this.noChange=true;this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{s[s.length-1].setText(C)}}else{s[s.length-1].setText(0)}}else if(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="GLD"&&e.Category==="pcs"||e.Type==="SLV"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs"){if(t.WeightD!==""||t.WeightD!==0){var c=t.Weight-t.WeightD}else{var c=t.Weight}if(e.Type==="Gold"||e.Type==="GLD"){if(e.Karat==="22/22"){r=c*l}else if(e.Karat==="22/20"){r=c*o}}else if(e.Type==="Silver"||e.Type==="SLV"){r=c*n}if(!r){var r=0}var M=t.Qty*t.Making;if(!M){var M=0}var m=i*t.MakingD;if(!m){var m=0}if(r||M||m){var y=r+M+m;if(t.SubTotal&&t.SubTotal!=""){var f=g.parse(t.SubTotal);this.orderAmount=y+this.orderAmount-f}else{this.orderAmount=y+this.orderAmount}var v=this.orderAmount;var v=v.toString();var w=this.getIndianCurr(v);this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",w);var C=this.getIndianCurr(y);if(a){e.SubTotal=C;this.noChange=true;this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{s[s.length-1].setText(C)}}else{s[s.length-1].setText(0)}}},onSuggest:function(e){const t=e.key;var r=e.getParameter("id").split("--")[2];var a=e.getParameter("suggestValue");if(a===""||t==8||t==="Backspace"||t==="Delete"){this.getView().byId("customerId").setValue("");return}if(!a){a=e.getParameter("newValue")}if(a){var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,a.toUpperCase()),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,a.toUpperCase())],and:false})}e.getSource().getBinding("suggestionItems").filter(s);var i=new sap.ui.model.Sorter({path:"CustomerCode",descending:false});e.getSource().getBinding("suggestionItems").sort(i);this.getView().byId("customerId").setValue(a)},Calculation:function(e,t,r){var a=this;var s=0;var i=this.getView().getModel("local").getProperty("/orderHeader");if(e.getId()==="orderReload"||e.getSource().getBindingInfo("value").binding.getPath().split("/")[1]==="orderHeader"){if(t){var o=this.getView().byId("orderItemBases").getModel("orderItems").getProperty(t);var l=t;var n=this.getView().byId("orderItemBases")._getVisibleColumns();if(e.getId()!="orderReload"){this.byId("Sales--idSaveIcon").setColor("red")}}}else{var d=e.getSource().getParent().getBindingContext("orderItems").getPath();var o=this.getView().byId("orderItemBases").getModel("orderItems").getProperty(d);var l=this.getView().byId("orderItemBases").getBinding().getPath()+"/"+e.getSource().getParent().getIndex();var g=e.getSource().getParent();var n=g.getCells();var r=e.getSource().getParent().getIndex()}var u=this.getView().getModel("orderItems").getProperty(l);var h=0;var c=0;if(e.getId()!="orderReload"){var p=e.getSource().getId().split("---")[1].split("--")[1].split("-")[0];var m=e.getParameters().newValue}var y=i.GoldBhav22/10;var f=i.GoldBhav20/10;var v=i.SilverBhav/1e3;var w=u.QtyD;var C=new sap.ui.core.Locale("en-US");var b=sap.ui.core.format.NumberFormat.getFloatInstance(C);if(!o.Category||!o.Type){if(o.Material!==""){a.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+o.Material+"')","GET",{},{},a).then(function(e){o.Category=e.Category;if(!o.Making||o.Making===0){o.Making=e.Making}o.Tunch=e.Tunch;o.Type=e.Type;o.Karat=e.Karat;if(p){a.setNewValue(u,p,m);this.valueChange="true"}a.getFloatValue(u,b,w);a.finalCalculation(o,u,h,t,n,w,f,y,v);a.finalBal=a.orderAmount-a.deduction;if(a.finalBal===0){var r=0}else{var r=a.getIndianCurr(a.finalBal)}if(a.deduction===0){var s=0}else{var s=a.getIndianCurr(a.deduction)}if(a.orderAmount===0){var i=0}else{var i=a.getIndianCurr(a.orderAmount)}a.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",i);a.getView().getModel("local").setProperty("/orderHeaderTemp/Deduction",s);a.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalance",r)}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}}else{if(m!=""){this.setNewValue(u,p,m);this.valueChange="true"}this.getFloatValue(u,b,w);this.finalCalculation(o,u,h,t,n,w,f,y,v);a.finalBal=a.orderAmount-a.deduction;if(a.finalBal===0){var V=0}else{var V=this.getIndianCurr(this.finalBal)}if(a.deduction===0){var M=0}else{var M=a.getIndianCurr(a.deduction)}if(a.orderAmount===0){var D=0}else{var D=a.getIndianCurr(a.orderAmount)}a.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValue",D);a.getView().getModel("local").setProperty("/orderHeaderTemp/Deduction",M);a.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalance",V)}this.byId("IdMaking");this.byId("IdMakingD");this.byId("IdWeightD");this.byId("IdWeight");this.byId("IdQty");this.byId("IdQtyD");this.byId("sbhavid")},toggleFullScreen:function(){var e="idFullScreenBtn";var t="Sales--orderHeader";this.toggleUiTable(e,t)}})});