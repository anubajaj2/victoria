sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","victoria/models/formatter","sap/m/MessageToast","sap/m/MessageBox","sap/m/Dialog"],function(e,t,r,a,s,i){"use strict";return e.extend("victoria.controller.sales",{formatter:r,orderAmount:0,finalBal:0,noChange:{index:0,flag:"true"},noChangeTable:[],headerNoChange:false,noChangeReturn:false,valueChange:false,onInit:function(t){e.prototype.onInit.apply(this);this.byId("idTransferButton").setEnabled(false);var r=this.getRouter();r.getRoute("sales").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){var t=this;var r="";this.onClear(e,r);this.getPrintCustHeaderData()},getPrintCustHeaderData:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){var r=e.getView().getModel("local").getProperty("/printCustomizing");for(var a=0;a<t.results.length;a++){switch(t.results[a].Name){case"__component0---idPrint--idAdd":r.Address=t.results[a].Value;break;case"__component0---idPrint--idCompName":r.CompName=t.results[a].Value;break;case"__component0---idPrint--idTnC":r.TnC=t.results[a].Value;break;case"__component0---idPrint--idgstn":r.GSTNumber=t.results[a].Value;break;case"__component0---idPrint--idContNo":r.ContNumber=t.results[a].Value;break;case"__component0---idPrint--idMarking":r.Marking=t.results[a].Value;break;default:}}e.getView().getModel("local").setProperty("/printCustomizing",r)}).catch(function(e){})},getIndianCurr:function(e){if(e){var t=e;t=t.toString();var r=t.split(".",2);t=r[0];var a=t.substring(t.length-3);var s=t.substring(0,t.length-3);if(s!="")a=","+a;if(r[1]){var i=s.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a+"."+r[1]}else{var i=s.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a}return i}},valueHelpCustomer:function(e){this.getCustomerPopup(e)},getRouter:function(){return this.getOwnerComponent().getRouter()},onPrint:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){e.retailPrint(t)}).catch(function(e){})},retailPrint:function(e){var t=[];var a=[];var s=this.getView().getModel("local").getProperty("/orderHeaderTemp");var i=this.getView().getModel("local").getProperty("/orderHeader");var l=this.getView().getModel("local").getProperty("/printCustomizing");if(i.Date){var o=i.Date.toLocaleDateString()}if(i.Customer){var d=i.Customer;var n=this.allMasterData.customers[d]}var g=r.getFormattedDate(0);var h,u,c,p,y,f,m,v,b,w,C;for(var M=0;M<e.results.length;M++){switch(e.results[M].Name){case"__component0---idPrint--idRCompName":if(e.results[M].Value==="true"){h=l.CompName}else{t.push("idRCompName")}break;case"__component0---idPrint--idRAddress":if(e.results[M].Value==="true"){u=l.Address}else{t.push("idRAddress")}break;case"__component0---idPrint--idContNo":if(e.results[M].Value==="true"){c=l.ContNumber}else{t.push("idRPhoneNumber")}break;case"__component0---idPrint--idRGSTN":if(e.results[M].Value==="true"){p=l.GSTNumber}else{t.push("idRGSTN")}break;case"__component0---idPrint--idRWeight":if(e.results[M].Value==="false"){t.push("idRWeight")}break;case"__component0---idPrint--idREstimate":if(e.results[M].Value==="true"){b="Estimate"}else{b="Invoice"}break;case"__component0---idPrint--idRSubTotal":if(e.results[M].Value==="false"){t.push("idRSubTotal")}break;case"__component0---idPrint--idRBhav":if(e.results[M].Value==="false"){t.push("idRBhav")}break;case"__component0---idPrint--idRMakingCharge":if(e.results[M].Value==="false"){t.push("idRMakingCharge")}break;case"__component0---idPrint--idRTnC":if(e.results[M].Value==="true"){w=l.TnC}else{t.push("idRTnC")}break;case"__component0---idPrint--idRMarking":if(e.results[M].Value==="true"){C=l.Marking}else{t.push("idRMarking")}break;case"__component0---idPrint--idRQuantity":if(e.results[M].Value==="false"){t.push("idRQuantity")}break;case"__component0---idPrint--idRReturnWeight":if(e.results[M].Value==="false"){t.push("idRReturnWeight")}break;case"__component0---idPrint--idRReturnBhav":if(e.results[M].Value==="false"){t.push("idRReturnBhav")}break;case"__component0---idPrint--idRWeightD":if(e.results[M].Value==="false"){t.push("idRWeightD")}break;case"__component0---idPrint--idRQuantityD":if(e.results[M].Value==="false"){t.push("idRQuantityD")}break;case"__component0---idPrint--idRMakingChargeD":if(e.results[M].Value==="false"){t.push("idRMakingChargeD")}break;case"__component0---idPrint--idRRemarks":if(e.results[M].Value==="false"){t.push("idRRemarks")}break;case"__component0---idPrint--idRReturnRemarks":if(e.results[M].Value==="false"){t.push("idRReturnRemarks")}break;case"__component0---idPrint--idRReturnKattaWeight":if(e.results[M].Value==="false"){t.push("idRReturnKattaWeight")}break;case"__component0---idPrint--idRReturnTunch":if(e.results[M].Value==="false"){t.push("idRReturnTunch")}break;case"__component0---idPrint--idRReturnSubTotal":if(e.results[M].Value==="false"){t.push("idRReturnSubTotal")}default:}}var R='<h2 style="text-align: center;"><strong>'+b+"</strong></h2><hr />"+'<table style="display: inline-block; float: left; width: 450px; height: 100px;">'+"<tbody>"+"<tr>"+'<td class="idRCompName" style="width: 150px; height: 13.5px;"><strong>Company Name</strong></td>'+'<td class="idRCompName" style="width: 300px; height: 13.5px;">'+h+"</td>"+"</tr>"+"<tr>"+'<td class="idRAddress" style="width: 150px; height: 13px;"><strong>Address</strong></td>'+'<td class="idRAddress" style="width: 300px; height: 13px;">'+u+"</td>"+"</tr>"+"<tr>"+'<td class="idRPhoneNumber" style="width: 150px; height: 13px;"><strong>Ph No</strong></td>'+'<td class="idRPhoneNumber" style="width: 300px; height: 13px;">'+c+"</td>"+"</tr>"+"<tr>"+'<td class="idRGSTN" style="width: 150px; height: 13px;"><strong>GSTN</strong></td>'+'<td class="idRGSTN" style="width: 300px; height: 13px;">'+p+"</td>"+"</tr>"+"</tbody>"+"</table>"+'<table style="display: inline-block; width: 500px; height: 100px;">'+"<tbody>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Name</strong></td>'+'<td style="width: 350px;">'+s.CustomerName+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>City</strong></td>'+'<td style="width: 350px;">'+this.allMasterData.cities[n.City].cityName+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Contact</strong></td>'+'<td style="width: 350px;">'+n.MobilePhone+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Print Date</strong></td>'+'<td style="width: 350px;">'+g+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />"+'<table style="width: 900px;">'+"<tbody>"+"<tr>"+'<td style="width: 160px;"><strong>Invoice Number</strong></td>'+'<td style="width: 300px;">&nbsp;'+i.OrderNo+"</td>"+'<td style="width: 150px;"><strong>Date</strong></td>'+'<td style="width: 270px;">&nbsp;'+o+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />";var x="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Material</h4></th>'+'<th style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Description</h4></th>'+'<th class="idRQuantity" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Qty</h4></th>'+'<th class="idRQuantityD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">&nbsp;QtyD</h4></th>'+'<th class="idRWeight" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idRWeightD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">WeightD</h4></th>'+'<th class="idRMakingCharge" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">Making</h4></th>'+'<th class="idRMakingChargeD" style="width: 80px;border: 1px solid black;"><h4 style="text-align: center;">MakingD</h4></th>'+'<th class="idRRemarks" style="width: 80px;border: 1px solid black"><h4 style="text-align: center;">Remarks</h4></th>'+'<th class="idRSubTotal" style="width: 80px;border: 1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>";var I=this.getView().byId("orderItemBases");var V=I.getBinding("rows");var D=0;var k=0;for(var M=0;M<V.getLength();M++){if(V.oList[M].MaterialCode){D=D+V.oList[M].Qty;x+="<tr>";x+='<td style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].MaterialCode+"</td>"+'<td style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].Description+"</td>"+'<td class="idRQuantity" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].Qty+"</td>"+'<td class="idRQuantityD" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].QtyD+"</td>"+'<td class="idRWeight" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].Weight+"</td>"+'<td class="idRWeightD" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].WeightD+"</td>"+'<td class="idRMakingCharge" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].Making+"</td>"+'<td class="idRMakingChargeD" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].MakingD+"</td>"+'<td class="idRRemarks" style="width: 80px;border: 1px solid black;">&nbsp;'+V.oList[M].Remarks+"</td>"+'<td class="idRSubTotal" style="width: 80px;border: 1px solid black;s">&nbsp;'+V.oList[M].SubTotal+"</td></tr>"}}x+="<tr>"+'<td style="width: 80px;">&nbsp;</td>'+'<td style="width: 80px;">&nbsp;</td>'+'<td class="idRQuantity" style="width: 80px;color:red">&nbsp;'+D+"</td>"+'<td class="idRQuantityD" style="width: 80px;">&nbsp;</td>'+'<td class="idRWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idRWeightD" style="width: 80px;">&nbsp;</td>'+'<td class="idRMakingCharge" style="width: 80px;">&nbsp;</td>'+'<td class="idRMakingChargeD" style="width: 80px;">&nbsp;</td>'+'<td class="idRRemarks" style="width: 80px;">&nbsp;</td>'+'<td class="idRSubTotal" style="width: 80px;color:red"><strong>&nbsp;'+i.TotalOrderValue+"</td></tr>";var S=this.getView().getModel("returnModel").getProperty("/TransData");if(S[0].Type){x+="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Product Type</h4></th>'+'<th class="idRReturnQuantity" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Quantity</h4></th>'+'<th class="idRReturnWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idRReturnKattaWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Katta Weight</h4></th>'+'<th class="idRReturnTunch"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Tunch(%)</h4></th>'+'<th class="idRReturnBhav" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Bhav</h4></th>'+'<th class="idRReturnRemarks" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Remarks</h4></th>'+'<th class="idRReturnSubTotal" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>"+"<p><h3>Returns:</h3></p>";for(var M=0;M<S.length;M++){if(S[M].Type){x+="<tr>";x+='<td  style="width: 80px;border:1px solid black">&nbsp;'+S[M].Type+"</td>"+'<td  class="idRReturnQuantity" style="width: 80px;border:1px solid black">&nbsp;'+S[M].Qty+"</td>"+'<td  class="idRReturnWeight"   style="width: 80px;border:1px solid black">&nbsp;'+S[M].Weight+"</td>"+'<td  class="idRReturnKattaWeight"   style="width: 80px;border:1px solid black">&nbsp;'+S[M].KWeight+"</td>"+'<td  class="idRReturnTunch"   style="width: 80px;border:1px solid black">&nbsp;'+S[M].Tunch+"</td>"+'<td  class="idRReturnBhav"     style="width: 80px;border:1px solid black">&nbsp;'+S[M].Bhav+"</td>"+'<td  class="idRReturnRemarks"     style="width: 80px;border:1px solid black">&nbsp;'+S[M].Remarks+"</td>"+'<td  class="idRReturnSubTotal" style="width: 80px;border:1px solid black">&nbsp;'+S[M].SubTotal+"</td></tr>"}}x+="<tr>"+'<td style="width: 80px;color:red"><strong>&nbsp;Final Balance</strong></td>'+'<td class="idRReturnQuantity" style="width: 80px;">&nbsp;'+"</td>"+'<td class="idRReturnWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnKattaWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnTunch" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnBhav" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnRemarks" style="width: 80px;">&nbsp;</td>'+'<td class="idRReturnSubTotal" style="width: 80px;color:red"><strong>&nbsp;'+i.FinalBalance+"</strong></td></tr>"}x+="</table>";var P='<table style="height: 40px; width: 950px;">'+"<tbody>"+"<tr>"+'<td class="idRTnC" style="width: 150px;"><strong>Terms &amp; Conditions:</strong></td>'+'<td class="idRTnC" style="width: 800px;">&nbsp;'+w+"</td>"+"</tr>"+"<tr>"+'<td class="idRMarking" style="width: 150px;">&nbsp;<strong>Marking:</strong></td>'+'<td class="idRMarking" style="width: 800px;">&nbsp;'+C+"</td>"+"</tr>"+"</tbody></table>";var T=window.open("","PrintWindow","width=200,height=100");T.document.write(R+x+P);for(var M=0;M<t.length;M++){var B=T.document.getElementsByClassName(t[M]);for(var W=0;W<B.length;W++){B[W].style.display="none"}}myWindows.document.close();myWindows.focus();setTimeout(function(){myWindows.print();myWindows.stop()},1500)},onConfirm:function(e){var t=this;if(e.getParameter("id")==="orderNo"){this.byId("Sales--idSaveIcon").setColor("green");delete this.orderAmount;delete this.deduction;var r=e.getSource().getParent().getId().split("---")[1];var a=this.getView().getModel("local").getProperty("/orderHeader/Date");var s=this.getView().getModel("local").getProperty("/orderHeader");this.orderItem(e,r);this.orderReturn(e,r);this.setWidths(false);var i=e.getParameter("selectedItem").getLabel();var l=e.getParameter("selectedItem").getBindingContextPath().split("'")[1];this.getView().getModel("local").setProperty("/orderHeader/OrderNo",i);this.getView().getModel("local").setProperty("/orderHeader/Date",a);if(s.Customer){this.byId("Sales--idSaveIcon").setColor("red");var o=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,s.Customer)}else{var o=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}e.sId="orderReload";this.getOrderDetails(e,l,o);this.byId("Sales--idSaveIcon").setColor("green")}else{var d=this.getView().getModel("local").getProperty("/orderHeaderTemp");var n=e.getParameter("selectedItem").getLabel();var g=e.getParameter("selectedItem").getValue();d.CustomerId=n;d.CustomerName=g;this.getView().byId("Sales--custName").setText(g);this.getView().getModel("local").setProperty("/orderHeader/Customer",e.getParameter("selectedItem").getBindingContextPath().split("'")[1]);this.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",n)}},onPayDateChange:function(e){if(e.getParameter("newValue")){this.getView().getModel("local").setProperty("/orderHeader/Date",e.getParameter("newValue"))}},getOrderDetails:function(e,t,r){var a=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')","GET",{filters:[r]},{},this).then(function(r){a.getView().setBusy(false);var s=r.Customer;var i=a.allMasterData.customers[s];a.getView().getModel("local").setProperty("/orderHeader",r);a.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",i.CustomerCode);a.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerName",i.Name+" - "+i.City);a.getView().byId("Sales--custName").setText(i.Name+" - "+i.City);a.ODataHelper.callOData(a.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')/ToOrderItems","GET",{},{},a).then(function(t){if(t.results.length>0){var r=a.getView().getModel("orderItems").getProperty("/itemData");for(var s=0;s<t.results.length;s++){r[s].OrderNo=t.results[s].OrderNo;r[s].itemNo=t.results[s].id;r[s].Making=t.results[s].Making;r[s].MakingD=t.results[s].MakingD;r[s].Qty=t.results[s].Qty;r[s].QtyD=t.results[s].QtyD;r[s].Weight=t.results[s].Weight;r[s].WeightD=t.results[s].WeightD;r[s].Remarks=t.results[s].Remarks;var i=a.allMasterData.materials[t.results[s].Material];r[s].Material=t.results[s].Material;r[s].Description=i.ProductName;r[s].MaterialCode=i.ProductCode;var l="/itemData"+"/"+s;e.sId="orderReload";a.Calculation(e,l,s)}a.getView().getModel("orderItems").setProperty("/itemData",r)}}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)});a.ODataHelper.callOData(a.getOwnerComponent().getModel(),"/OrderHeaders('"+t+"')/ToOrderReturns","GET",{},{},a).then(function(t){e.sId="orderReload";if(t.results.length>0){var r=a.getView().getModel("returnModel").getProperty("/TransData");for(var s=0;s<t.results.length;s++){r[s].ReturnId=t.results[s].id;r[s].Type=t.results[s].Type;r[s].Weight=t.results[s].Weight;r[s].KWeight=t.results[s].KWeight;r[s].Tunch=t.results[s].Tunch;r[s].Qty=t.results[s].Qty;r[s].Bhav=t.results[s].Bhav;r[s].Key=t.results[s].Key;r[s].Remarks=t.results[s].Remarks;a.getView().getModel("returnModel").setProperty("/TransData",r);var i="/TransData"+"/"+s;var l=a.getView().getModel("local").getProperty("/orderHeader");a.returnCalculation(e,l,i)}}}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})},valueHelpOrder:function(e){this.orderPopup(e)},onCancel:function(e){},orderCreate:function(e){var t=this;if(this.getView().getModel("local").getProperty("/orderHeader").OrderNo){var r=e.getSource().getParent().getParent().getParent().getId().split("---")[1].split("--")[0];sap.m.MessageBox.confirm("Are you sure to delete the unsaved Data?",{title:"Confirm",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(a){if(a===s.Action.OK){var i=t.getView().getModel("local").getProperty("/orderHeader").Date;var l=t.getView().getModel("local").getProperty("/orderHeader").Customer;var o=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerId;var d=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerName;var n=t.getView().getModel("local").getProperty("/orderHeader");t.onClear(e,r);t.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",o);t.getView().byId("Sales--custName").setText(d);t.getView().getModel("local").setProperty("/orderHeader/Customer",l);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/CustomCalculations","GET",{},{},t).then(function(e){t.orderCheck()}).catch(function(e){t.getView().getModel("local").setProperty("/orderHeader/GoldBhav22",0);t.getView().getModel("local").setProperty("/orderHeader/GoldBhav20",0);t.getView().getModel("local").setProperty("/orderHeader/GoldBhav",0);t.getView().getModel("local").setProperty("/orderHeader/SilverBhav",0)})}}})}else{t.orderCheck()}},orderCheck:function(){var e=this;e.getView().setBusy(true);e.byId("Sales--idSaveIcon").setColor("red");var t=this.getView().getModel("local").getProperty("/orderHeader");if(t.Customer===""){this.getView().byId("Sales--customerId").setValueState("Error").setValueStateText("Mandatory Input");e.getView().setBusy(false)}else{if(t){t.id="";t.CreatedBy="";t.ChangedBy="";t.CreatedOn="";t.CreatedBy="";delete t.ToOrderItems;delete t.ToCustomers;delete t.ToOrderReturns;e.orderCustomCalculations()}this.getView().byId("Sales--customerId").setValueState("None");t.Date=this.getView().byId("Sales--DateId").getValue();this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders","POST",{},t,this).then(function(t){e.getView().setBusy(false);var r=e.getView().getModel("local").getProperty("/OrderId");r.OrderId=t.id;r.OrderNo=t.OrderNo;e.getView().getModel("local").setProperty("/OrderId",r);e.getView().getModel("local").setProperty("/orderHeader/OrderNo",t.OrderNo)}).catch(function(t){e.getView().setBusy(false);var r=e.getErrorMessage(t)})}},onValidation:function(){var e=this;var t=true;var r=this.getView().getModel("local").getProperty("/orderHeader");if(r.OrderNo===0||r.OrderNo===""){t=false;s.show("Please create Order Number first",{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}e.getView().setBusy(false);return t},onValidationItem:function(e,t){var r=this;var a=this.getView().getModel("orderItems").getProperty("/itemData");var s=r.getView().getModel("local").getProperty("/OrderItem");var i=r.getView().byId("orderItemBases");var l=i.getBinding("rows");var o=false;if(e.Type==="GS"||(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs")){if(e.Qty===""||e.Qty===0||e.Qty==="0"){this.getView().setBusy(false);i.getRows()[t].getCells()[2].setValueState("Error");i.getRows()[t].getCells()[4].setValueState("None");o=true;return}else{s.Qty=e.Qty;i.getRows()[t].getCells()[2].setValueState("None");this.getView().setBusy(false)}}else if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(e.Weight===""||e.Weight===0||e.Weight==="0"){this.getView().setBusy(false);i.getRows()[t].getCells()[4].setValueState("Error");i.getRows()[t].getCells()[2].setValueState("None");o=true;return}else{s.Weight=e.Weight;i.getRows()[t].getCells()[4].setValueState("None");this.getView().setBusy(false)}}return o},onReturnSave:function(e,t,r,a){var s=this.getView().getModel("local").getProperty("/OrderReturn");var i=this.getView().byId("OrderReturn");var l=i.getBinding("rows");for(var o=0;o<l.getLength();o++){var d=this;var n=l.oList[o];if(n.Key!=""){s.Key=n.Key;if(n.Type===""||n.Type===0){s.Type=0}else{s.Type=n.Type;if(t||t!=""){s.OrderNo=t}else if(a.id){s.OrderNo=a.id}if(n.Weight===""||n.Weight===0){s.Weight=0}else{s.Weight=n.Weight}if(n.KWeight===""||n.KWeight===0){s.KWeight=0}else{s.KWeight=n.KWeight}if(n.Tunch===""||n.Tunch===0){s.Tunch=0}else{s.Tunch=n.Tunch}if(n.Qty===""||n.Qty===0){s.Qty=0}else{s.Qty=n.Qty}if(n.Bhav===""||n.Bhav===0){s.Bhav=0}else{s.Bhav=n.Bhav}if(n.Remarks===""){s.Remarks=""}else{s.Remarks=n.Remarks}var g=JSON.parse(JSON.stringify(s));if(n.ReturnId){}else{d.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderReturns","POST",{},g,d).then(function(e){d.getView().setBusy(false);var a=d.getView().getModel("returnModel").getProperty("/TransData");for(var s=0;s<a.length;s++){if(a[s].Type===e.Type&&a[s].ReturnId===""){a[s].ReturnId=e.id;a[s].orderNo=t;r=true;break}}d.getView().getModel("returnModel").setProperty("/TransData",a);d.getView().setBusy(false);sap.m.MessageToast.show("Data Saved Successfully")}).catch(function(e){d.getView().setBusy(false);var t=d.getErrorMessage(e)})}}}}return r},ValueChangeHeader:function(e){var t=this;var r=t.getView().getModel("local").getProperty("/orderHeader");var a=this.getView().byId("orderItemBases").getBinding("rows");var s=a.getPath();var i=a.getLength();var l=e.getSource().getId().split("---")[1].split("--")[2];var o=e.getParameter("newValue");var d=new sap.ui.core.Locale("en-US");var n=sap.ui.core.format.NumberFormat.getFloatInstance(d);this.headerNoChange=true;if(l==="Gbhav2Id"){if(o===""){r.GoldBhav22=0;this.headerNoChange=true}else if(o===0){r.GoldBhav22=0}else{r.GoldBhav22=n.parse(o)}}else if(l==="Gbhav1Id"){if(o===""){r.GoldBhav20=0}else if(o===0){r.GoldBhav20=0}else{r.GoldBhav20=n.parse(o)}}else if(l==="GoldbhavId"){if(o===""){r.GoldBhav=0}else if(o===0){r.GoldBhav=0}else{r.GoldBhav=n.parse(o)}}else if(l==="sbhavid"){if(o===""){r.SilverBhav=0}else if(o===0){r.SilverBhav=0}else{r.SilverBhav=n.parse(o)}}t.getView().getModel("local").setProperty("/orderHeader",r);for(var g=0;g<i;g++){var h=s+"/"+g;this.Calculation(e,h,g);this.noChangeTable.push(this.noChange)}},onSave:function(e){var t=this;if(this.onValidation()===true){var r=this.getView().getModel("local").getProperty("/OrderItem");var a=this.getView().byId("orderItemBases");var s=a.getBinding("rows");var i=false;var l=false;var o=false;delete this.orderAmount;delete this.deduction;for(var d=0;d<s.getLength();d++){var t=this;var n=s.oList[d];if(n.Material!==""){l=true;if(d===0&&o===false){if(this.onRetItemValidation()===false){o=true}}this.getView().setBusy(true);var g=false;if(this.onValidationItem(n,d,g)===false){i=false}else{i=true}}}if(o===true&&i===false){this.commitRecords(e)}if(l===false){sap.m.MessageBox.error("Please Enter Valid entries before save",{title:"Error",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){}})}}else{}if(l===true&&o===true&&i===false){var h=true;return h}},commitRecords:function(e){if(this.byId("Sales--idSaveIcon").getColor()==="red"){var t=this;var r=t.getView().getModel("local").getProperty("/orderHeader");var a=t.getView().getModel("local").getProperty("/OrderId").OrderId;if(this.headerNoChange===true){t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders('"+a+"')","PUT",{},r,this).then(function(e){message.show("Order Saved");t.getView().setBusy(false)}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}var s=this.getView().getModel("local").getProperty("/OrderItem");var i=this.getView().byId("orderItemBases");var l=i.getBinding("rows");var o=false;var d=false;for(var n=0;n<l.getLength();n++){var t=this;var g=l.oList[n];if(g.Material!==""){if(a!=""){s.OrderNo=a}else if(r.id){s.OrderNo=r.id}s.Material=g.Material;if(g.Qty===""||g.Qty===0){s.Qty=0}else{s.Qty=g.Qty}if(g.QtyD===""||g.QtyD===0){s.QtyD=0}else{s.QtyD=g.QtyD}if(g.Weight===""||g.Weight===0){s.Weight=0}else{s.Weight=g.Weight}if(g.WeightD===""||g.WeightD===0){s.WeightD=0}else{s.WeightD=g.WeightD}if(g.Making===""||g.Making===0){s.Making=0}else{s.Making=g.Making}if(g.MakingD===""||g.MakingD===0){s.MakingD=0}else{s.MakingD=g.MakingD}s.Remarks=g.Remarks;var h=JSON.parse(JSON.stringify(s));if(g.itemNo){}else{t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderItems","POST",{},h,this).then(function(e){var r=t.getView().getModel("orderItems").getProperty("/itemData");t.getView().setBusy(false);for(var s=0;s<r.length;s++){if(r[s].Material===e.Material&&r[s].itemNo===""){r[s].itemNo=e.id;r[s].OrderNo=a;break}}t.getView().getModel("orderItems").setProperty("/itemData",r);t.getView().setBusy(false);sap.m.MessageToast.show("Data Saved Successfully")}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}}}if(d===false){t.onReturnSave(e,a,d,r)}t.byId("Sales--idSaveIcon").setColor("green")}else{sap.m.MessageBox.error("No Change in data records",{title:"Error",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){}})}},onClearScreen:function(e){var t=this;var r=this.byId("Sales--idSaveIcon").getColor();if(!i){var i=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[1]}if(r=="red"){sap.m.MessageBox.error("Are you sure you want to clear all entries? All unsaved changes will be lost!",{title:"Alert!",actions:["Save & Clear","Clear",s.Action.CANCEL],onClose:function(r){if(r==="Clear"){t.onClear(e,i);t.byId("Sales--idSaveIcon").setColor("green");a.show("Screen cleared successfully!")}else if(r==="Save & Clear"){if(t.onSave(e)){t.onClear(e,i);a.show("Data has been Saved! Screen cleared successfully!")}}}})}else{sap.m.MessageBox.error("Are you sure you want to clear all entries?",{title:"Alert!",actions:["Clear",s.Action.CANCEL],onClose:function(r){if(r==="Clear"){t.onClear(e,i);t.byId("Sales--idSaveIcon").setColor("green");a.show("Screen cleared successfully!")}}})}},onClear:function(e,t){var a=this;delete this.orderAmount;delete this.deduction;a.byId("Sales--idSaveIcon").setColor("green");var s=new sap.ui.model.json.JSONModel({set:true});this.setModel(s,"VisibleSet");var i=this.getView().getModel("local").getProperty("/orderHeader");var l=this.getView().getModel("local").getProperty("/orderHeaderTemp");this.getView().byId("Sales--custName").setText("");l.CustomerId="";i.OrderNo="";i.Customer="";i.GoldBhav22=0;i.GoldBhav20=0;i.GoldBhav=0;i.SilverBhav=0;i.TotalOrderValue="";i.Deduction="";i.FinalBalance="";this.getView().getModel("local").setProperty("/orderHeaderTemp",l);a.getView().getModel("local").setProperty("/orderHeader",i);a.getView().getModel("local").setProperty("/orderHeader/Date",r.getFormattedDate(0));a.getView().byId("Sales--DateId").setDateValue(new Date);this.orderCustomCalculations();this.orderItem(e,t);this.orderReturn(e,t);this.setWidths(false)},setWidths:function(e){var t=this.getView().byId("orderItemBases");if(e===false){t.getColumns()[0].setWidth("10%");t.getColumns()[1].setWidth("15%");t.getColumns()[2].setWidth("5%");t.getColumns()[3].setWidth("5%");t.getColumns()[4].setWidth("10%");t.getColumns()[5].setWidth("10%");t.getColumns()[6].setWidth("10%");t.getColumns()[7].setWidth("10%");t.getColumns()[8].setWidth("10%");t.getColumns()[9].setWidth("15%")}else{}},onDelete:function(e){var t=this;var r=new sap.ui.core.Locale("en-US");var a=sap.ui.core.format.NumberFormat.getFloatInstance(r);var i=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[0];var l=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[1];var o=t.getView().byId(l).getSelectedIndices();if(o.length&&o.length!==0){sap.m.MessageBox.confirm("Are you sure to delete the selected entries",{title:"Confirm",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(r){if(r===s.Action.OK){for(var d=o.length-1;d>=0;--d){if(l==="orderItemBases"){var n=t.getView().getModel("orderItems").getProperty("/itemData")[d];var g=t.getView().getModel("orderItems").getProperty("/itemData")[d].itemNo;if(g){t.byId("Sales--idSaveIcon").setColor("green");t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/OrderItems('"+g+"')","DELETE",{},{},t);sap.m.MessageToast.show("Data Deleted Successfully")}else{t.byId("Sales--idSaveIcon").setColor("red")}var h=a.parse(n.SubTotal);if(h){t.orderAmount=t.orderAmount-h}var u=t.getView().getModel("orderItems").getProperty("/itemData");u.splice(o[d],1);t.getView().getModel("orderItems").setProperty("/itemData",u);u.push({OrderNo:"",itemNo:"",Material:"",MaterialCode:"",Description:"",Qty:0,QtyD:0,Weight:0,WeightD:0,Making:0,MakingD:0,Tunch:0,Remarks:"",SubTotal:0,SubTotalS:0,SubTotalG:0,Category:"",CreatedBy:"",CreatedOn:"",ChangedBy:"",ChangedOn:""});t.getView().getModel("orderItems").setProperty("/itemData",u)}else if(l==="OrderReturn"){t.deleteReturnValues(e,d,o[d],i,u)}}if(l==="orderItemBases"){t.getView().byId("orderItemBases").clearSelection()}else{t.getView().byId("OrderReturn").clearSelection()}}}})}else{s.show("Please Select the entry to be deleted",{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},onSetting:function(e){this.hideDColumns(e)},OnCustChange:function(){},ValueChange:function(e){var t="";var r="";this.Calculation(e,t,r);this.noChangeTable.push(this.noChange);this.byId("Sales--idSaveIcon").setColor("red")},setNewValue:function(e,t,r){if(t==="IdWeight"){if(e.Weight!==r){e.Weight=r}}if(t==="IdWeightD"){if(e.WeightD!==r){e.WeightD=r}}if(t==="IdMaking"){if(e.Making!==r){e.Making=r}}if(t==="IdMakingD"){if(e.MakingD!==r){e.MakingD=r}}if(t==="IdQtyD"){if(e.QtyD!==r){e.QtyD=r}}if(t==="IdQty"){if(e.Qty!==r){e.Qty=r}}},getFloatValue:function(e,t,r){if(e.Making){if(e.Making===""){e.Making=0}else if(e.Making===0){e.Making=0}else{var a=e.Making.toString();e.Making=t.parse(a)}}else{e.Making=0}if(e.MakingD){if(e.MakingD===""){e.MakingD=0;s=0}else if(e.MakingD===0){e.MakingD=0;s=0}else{var s=e.MakingD.toString();e.MakingD=t.parse(s)}}else{e.MakingD=0;s=0}if(e.Weight){if(e.Weight===""){e.Weight=0}else if(e.Weight===0){e.Weight=0}else{var i=e.Weight.toString();e.Weight=t.parse(i)}}else{e.Weight=0}if(e.WeightD){if(e.WeightD===""){e.WeightD=0}else if(e.WeightD===0){e.WeightD=0}else{var l=e.WeightD.toString();e.WeightD=t.parse(l)}}else{e.WeightD=0}if(e.Qty){if(e.Qty===""){e.Qty=0}else if(e.Qty===0){e.Qty=0}else{var o=e.Qty.toString();e.Qty=t.parse(o)}}else{e.Qty=0}if(e.QtyD){if(e.QtyD===""){e.QtyD=0;r=0}else if(e.QtyD===0){e.QtyD=0;r=0}else{var d=e.QtyD.toString();e.QtyD=t.parse(d);r=e.QtyD}}else{e.QtyD=0}},finalCalculation:function(e,t,r,a,s,i,l,o,d){var n=new sap.ui.core.Locale("en-US");var g=sap.ui.core.format.NumberFormat.getFloatInstance(n);if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(t.WeightD!==""||t.WeightD!==0){var h=t.Weight-t.WeightD}else{var h=t.Weight}if(e.Type==="Gold"){if(e.Karat==="22/22"){r=h*o}else if(e.Karat==="22/20"){r=h*l}}else if(e.Type==="Silver"){r=h*d}var u=t.Making*h;var c=i*t.MakingD;if(r||u||c){var p=r+u+c;if(t.SubTotal&&t.SubTotal!=""){var y=g.parse(t.SubTotal);this.orderAmount=p+this.orderAmount-y}else{this.orderAmount=p+this.orderAmount;var f=this.orderAmount}var f=this.orderAmount;var f=f.toString();var m=this.getIndianCurr(f);this.getView().getModel("local").setProperty("/orderHeader/TotalOrderValue",m);var v=this.getIndianCurr(p);if(a){e.SubTotal=v;this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{s[s.length-1].setText(v)}}else{s[s.length-1].setText(0)}}else if(e.Type==="GS"){var b=t.Qty*t.Making;var w=t.QtyD*t.MakingD;if(b){var p=b+w;var v=this.getIndianCurr(p);if(t.SubTotal&&t.SubTotal!=""){var y=g.parse(t.SubTotal);this.orderAmount=p+this.orderAmount-y}else{this.orderAmount=p+this.orderAmount}var f=this.orderAmount;var f=f.toString();var m=this.getIndianCurr(f);this.getView().getModel("local").setProperty("/orderHeader/TotalOrderValue",m);if(a){e.SubTotal=v;this.noChange=true;this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{s[s.length-1].setText(v)}}else{s[s.length-1].setText(0)}}else if(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs"){if(t.WeightD!==""||t.WeightD!==0){var h=t.Weight-t.WeightD}else{var h=t.Weight}if(e.Type==="Gold"){if(e.Karat==="22/22"){r=h*o}else if(e.Karat==="22/20"){r=h*l}}else if(e.Type==="Silver"){r=h*d}if(!r){var r=0}var C=t.Qty*t.Making;if(!C){var C=0}var c=i*t.MakingD;if(!c){var c=0}if(r||C||c){var p=r+C+c;if(t.SubTotal&&t.SubTotal!=""){var y=g.parse(t.SubTotal);this.orderAmount=p+this.orderAmount-y}else{this.orderAmount=p+this.orderAmount}var f=this.orderAmount;var f=f.toString();var m=this.getIndianCurr(f);this.getView().getModel("local").setProperty("/orderHeader/TotalOrderValue",m);var v=this.getIndianCurr(p);if(a){e.SubTotal=v;this.noChange=true;this.getView().byId("orderItemBases").getModel("orderItems").setProperty(a,e)}else{s[s.length-1].setText(v)}}else{s[s.length-1].setText(0)}}},Calculation:function(e,t,r){var a=this;var s=this.getView().getModel("local").getProperty("/orderHeader");if(e.getId()==="orderReload"||e.getSource().getBindingInfo("value").binding.getPath().split("/")[1]==="orderHeader"){if(t){var i=this.getView().byId("orderItemBases").getModel("orderItems").getProperty(t);var l=t;var o=this.getView().byId("orderItemBases")._getVisibleColumns();if(e.getId()!="orderReload"){this.byId("Sales--idSaveIcon").setColor("red")}}}else{var d=e.getSource().getParent().getBindingContext("orderItems").getPath();var i=this.getView().byId("orderItemBases").getModel("orderItems").getProperty(d);var l=this.getView().byId("orderItemBases").getBinding().getPath()+"/"+e.getSource().getParent().getIndex();var n=e.getSource().getParent();var o=n.getCells();var r=e.getSource().getParent().getIndex()}var g=this.getView().getModel("orderItems").getProperty(l);var h=0;var u=0;if(e.getId()!="orderReload"){var c=e.getSource().getId().split("---")[1].split("--")[1].split("-")[0];var p=e.getParameters().newValue}var y=s.GoldBhav22/10;var f=s.GoldBhav20/10;var m=s.SilverBhav/1e3;var v=0;var b=new sap.ui.core.Locale("en-US");var w=sap.ui.core.format.NumberFormat.getFloatInstance(b);if(!i.Category||!i.Type){if(i.Material!==""){a.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+i.Material+"')","GET",{},{},a).then(function(e){i.Category=e.Category;i.Making=e.Making;i.Tunch=e.Tunch;i.Type=e.Type;i.Karat=e.Karat;if(c){a.setNewValue(g,c,p);this.valueChange="true"}a.getFloatValue(g,w,v);a.finalCalculation(i,g,h,t,o,v,f,y,m);a.finalBal=a.orderAmount-a.deduction;var r=a.getIndianCurr(a.finalBal);a.getView().getModel("local").setProperty("/orderHeader/FinalBalance",r)}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}}else{if(true){this.setNewValue(g,c,p);this.valueChange="true"}this.getFloatValue(g,w,v);this.finalCalculation(i,g,h,t,o,v,f,y,m);a.finalBal=a.orderAmount-a.deduction;var C=a.getIndianCurr(a.finalBal);a.getView().getModel("local").setProperty("/orderHeader/FinalBalance",C)}this.byId("IdMaking");this.byId("IdMakingD");this.byId("IdWeightD");this.byId("IdWeight");this.byId("IdQty");this.byId("IdQtyD");this.byId("sbhavid")},toggleFullScreen:function(){var e="idFullScreenBtn";var t="Sales--orderHeader";this.toggleUiTable(e,t)}})});
//# sourceMappingURL=sales0.controller.js.map