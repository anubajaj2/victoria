sap.ui.define(["victoria/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","victoria/models/formatter","sap/m/MessageToast","sap/ui/model/Filter","sap/m/MessageBox"],function(e,t,r,a,i,l,s){"use strict";return e.extend("victoria.controller.salesws",{formatter:a,FinalBalanceCash:0,FinalBalanceGold:0,FinalBalanceSilver:0,TotalOrderValueCash:0,TotalOrderValueGold:0,TotalOrderValueSilver:0,DeductionCash:0,DeductionGold:0,DeductionSilver:0,valueChange:false,onInit:function(t){e.prototype.onInit.apply(this);var r=this.getRouter();r.getRoute("salesws").attachMatched(this._onRouteMatched,this);this.getPrintCustHeaderData();var a=this;var i=this.getModel("local").getProperty("/CurrentUser");var l=this.getModel("local").oData.AppUsers[i].UserName;l="Hey "+l;this.getView().byId("idUser").setText(l);this.resourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle()},_onRouteMatched:function(e){var t=this;this.clearScreen(e);setTimeout(function(){$("input[type='Number']").focus(function(){$(this).select()})},3e3)},onAfterRendering:function(){$("input[type='Number']").focus(function(){$(this).select()})},valueHelpCustomer:function(e){this.getCustomerPopup(e)},onEnter:function(e){this.getCustomer(e)},setStatus:function(e){this.byId("WSHeaderFragment--idSaveIcon").setColor(e)},getStatus:function(){var e=this.byId("WSHeaderFragment--idSaveIcon").getColor();return e},moveNext:function(e){},onSubmitQuantity:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[3].focus()},onSubmitQuantityD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[4].focus(e)},onSubmitWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[5].focus()},onSubmitWeightD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[6].focus(e)},onSubmitMaking:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[7].focus()},onSubmitMakingD:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[8].focus()},onSubmitTunch:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[9].focus()},onReturnSubmitWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[2].focus()},onReturnSubmitKWeight:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[3].focus()},onReturnSubmitTunch:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[4].focus()},onReturnSubmitQty:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[5].focus()},onReturnSubmitBhav:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[6].focus()},onReturnSubmitDropdown:function(e){var t=e.getSource();var r=t.getParent();r.getCells()[1].focus()},onConfirm:function(e){if(e.getParameters().selectedItem.mBindingInfos.label.binding.sPath==="OrderNo"){this.setStatus("green");var t=this.getView().getModel("local").getProperty("/WSOrderHeader");var r=e.getParameter("selectedItem").getLabel();var a=e.getParameter("selectedItem").getBindingContextPath().split("'")[1];this.getView().getModel("local").setProperty("/WSOrderHeader/OrderNo",r);var i=this.getView().getModel("local").getProperty("/OrderId");i.OrderId=a;i.OrderNo=r;this.getView().getModel("local").setProperty("/OrderId",i);if(t.Customer){var l=new sap.ui.model.Filter("Customer","EQ","'"+t.Customer+"'")}else{var l=new sap.ui.model.Filter("Customer","EQ","'"+"")}e.sId="orderReload";this.getOrderDetails(e,a,l,r);this.orderSearchPopup.destroyItems()}else{this.setStatus("red");var s=e.getParameter("selectedItem").getId();var o=this.getView().getModel("local").getProperty("/orderHeaderTemp");var d=s.split("-"[0]);var n=e.getParameter("selectedItem").getLabel();var g=e.getParameter("selectedItem").getValue();this.getView().getModel("local").setProperty("/WSOrderHeader/Customer",e.getParameter("selectedItem").getBindingContextPath().split("'")[1]);this.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",n);this.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerName",g);this.getView().byId("WSHeaderFragment--custName").setText(g);this.getView().byId("WSHeaderFragment--customerId").setValueState("None")}},orderItem:function(e,t){var r=new sap.ui.model.json.JSONModel;var a=[];for(var i=1;i<=20;i++){var l={OrderNo:"",itemNo:"",Material:"",Description:"",Qty:0,QtyD:0,Weight:0,WeightD:0,Making:0,MakingD:0,Tunch:0,Remarks:"",SubTotal:0,SubTotalS:0,SubTotalG:0,Category:"",CreatedBy:"",CreatedOn:"",ChangedBy:"",ChangedOn:""};a.push(l)}r.setData({itemData:a});this.setModel(r,"orderItems")},orderReturn:function(e,t){var r=new sap.ui.model.json.JSONModel;var a=[];for(var i=1;i<=5;i++){var l={Type:"",Key:"",ReturnId:"",Weight:0,KWeight:0,Tunch:0,Qty:0,Bhav:0,Remarks:"",SubTotalS:0,SubTotalG:0,SubTotal:0,CreatedBy:"",CreatedOn:"",ChangedBy:"",ChangedOn:""};a.push(l)}r.setData({TransData:a});this.setModel(r,"returnModel")},getOrderDetails:function(e,t,r,a){var l=this;l.orderItem(e);l.orderReturn(e);this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSOrderHeaders('"+t+"')","GET",{filters:[r]},{},this).then(function(r){l.getView().setBusy(false);var s=r.Date;var o=r.Customer;var d=l.allMasterData.customers[o];debugger;l.TotalOrderValueCash=0;l.TotalOrderValueGold=0;l.TotalOrderValueSilver=0;if(r.SummaryMode=="O"){l.getView().byId("WSHeaderFragment--RB-4").setSelected(true)}else if(r.SummaryMode=="C"){l.getView().byId("WSHeaderFragment--RB-1").setSelected(true)}else if(r.SummaryMode=="G"){l.getView().byId("WSHeaderFragment--RB-2").setSelected(true)}else if(r.SummaryMode=="S"){l.getView().byId("WSHeaderFragment--RB-3").setSelected(true)}var n=d.City;l.getView().getModel("local").setProperty("/WSOrderHeader",r);l.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",d.CustomerCode);l.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerName",d.Name+" - "+l.allMasterData.cities[n].cityName);l.getView().byId("WSHeaderFragment--custName").setText(d.Name+" - "+l.allMasterData.cities[n].cityName);var g=l.getView().getModel("local").getProperty("/EntryData");l.getEntryData(e,o,a,s,g);l.ODataHelper.callOData(l.getOwnerComponent().getModel(),"/WSOrderHeaders('"+t+"')/ToWSOrderItem","GET",{},{},l).then(function(t){debugger;if(t.results.length>0){var r=l.getView().getModel("orderItems").getProperty("/itemData");for(var a=0;a<t.results.length;a++){r[a].OrderNo=t.results[a].OrderNo;r[a].itemNo=t.results[a].id;r[a].Making=t.results[a].Making;r[a].MakingD=t.results[a].MakingD;r[a].Qty=t.results[a].Qty;r[a].QtyD=t.results[a].QtyD;r[a].Tunch=t.results[a].Tunch;r[a].Weight=t.results[a].Weight;r[a].WeightD=t.results[a].WeightD;r[a].Remarks=t.results[a].Remarks;var s=l.allMasterData.materials[t.results[a].Material];r[a].Material=t.results[a].Material;if(s){r[a].Description=s.ProductName;r[a].MaterialCode=s.ProductCode}else{i.show(l.resourceBundle.getText("Master11"))}var o="/itemData"+"/"+a;e.sId="orderReload";l.Calculation(e,o,a)}l.getView().getModel("orderItems").setProperty("/itemData",r)}}).catch(function(e){l.getView().setBusy(false);var t=l.getErrorMessage(e)});l.ODataHelper.callOData(l.getOwnerComponent().getModel(),"/WSOrderHeaders('"+t+"')/ToWSOrderReturns","GET",{},{},l).then(function(t){e.sId="orderReload";e.viewId="idsalesws";if(t.results.length>0){var r=l.getView().getModel("returnModel").getProperty("/TransData");for(var a=0;a<t.results.length;a++){r[a].ReturnId=t.results[a].id;r[a].Type=t.results[a].Type;r[a].Weight=t.results[a].Weight;r[a].KWeight=t.results[a].KWeight;r[a].Tunch=t.results[a].Tunch;r[a].Qty=t.results[a].Qty;r[a].Bhav=t.results[a].Bhav;r[a].Key=t.results[a].Key;r[a].Remarks=t.results[a].Remarks;l.getView().getModel("returnModel").setProperty("/TransData",r);var i="/TransData"+"/"+a;var s=l.getView().getModel("local").getProperty("/WSOrderHeader");l.returnCalculation(e,s,i)}}})}).catch(function(e){l.getView().setBusy(false);var t=l.getErrorMessage(e)})},valueHelpOrder:function(e){debugger;this.orderPopup(e);this.orderSearchPopup.destroyItems()},orderPopup:function(e){this.orderSearchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",this);this.getView().addDependent(this.orderSearchPopup);var t=this.getView().getModel("i18n").getProperty("orderSearch");this.orderSearchPopup.setTitle(t);var r=this.byId("WSHeaderFragment--DateId").getValue();var a=this.getView().getModel("local").getProperty("/WSOrderHeader").Customer;var i=new Date(r);i.setHours(0,0,0,1);var l=new Date(r);l.setHours(23,59,59,59);var s=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.GE,i);var o=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.LE,l);if(a){var d=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.Contains,a)}else{var d=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.Contains,"")}var n=new sap.ui.model.Filter({filters:[s,o],and:true});var g=new sap.ui.model.Filter({filters:[n,d],and:true});this.orderSearchPopup.bindAggregation("items",{path:"/WSOrderHeaders",filters:n,template:new sap.m.DisplayListItem({label:"{OrderNo}",value:{path:"Customer",formatter:this.getCustomerName.bind(this)}})});this.orderSearchPopup.open()},onSearch:function(e){var t=e.getSource().getId();var r=e.getParameter("value");if(r){var a=r.toLowerCase();var i=r.toUpperCase();var l=r[0].toUpperCase()+r.substr(1).toLowerCase()}else{a="";i="";l=""}if(t==="orderNo"){var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("OrderNo",sap.ui.model.FilterOperator.Contains,r)],and:false});this.orderSearchPopup.getBinding("items").filter(s)}else{var s=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,i),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,a),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,i),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,l)],and:false});this.searchPopup.getBinding("items").filter(s)}},onLiveSearch:function(e){this.onSearch(e)},ValueChange:function(e){var t="";var r="";this.Calculation(e,t,r);this.setStatus("red")},WSCalculation:function(e){debugger;var t=this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").getProperty(e.getSource().getParent().getBindingContext("orderItems").getPath());var r=e.getSource().getParent();var a=r.getCells();var i=e.getSource().getId().split("---")[1].split("--")[2].split("-")[0];var l=e.getParameters().newValue;var s=new sap.ui.core.Locale("en-US");var o=sap.ui.core.format.NumberFormat.getFloatInstance(s);if(t.Type==="Gold"&&t.Category==="gm"||t.Type==="GLD"&&t.Category==="gm"||t.Type==="SLV"&&t.Category==="gm"||t.Type==="Silver"&&t.Category==="gm"){if(i==="IdWeight"){if(t.Weight!==l){t.Weight=l}}if(t.Weight===""){var d=0}else if(t.Weight===0){var d=0}else{var d=o.parse(t.Weight)}if(i==="IdWeightD"){if(t.WeightD!==l){t.WeightD=l}}if(t.WeightD===""){var n=0}else if(t.WeightD===0){var n=0}else{var n=o.parse(t.WeightD)}if(n!==""||n!==0){var g=d-n}else{var g=d}if(i==="IdMaking"){if(t.Making!==l){t.Making=l}}if(t.Making===""){t.Making=0;var u=0}else if(t.Making===0){t.Making=0;var u=0}else{var u=o.parse(t.Making)}if(i==="IdMakingD"){if(t.MakingD!==l){t.MakingD=l}}if(t.MakingD===""){t.MakingD=0;var c=0}else if(t.MakingD===0){t.MakingD=0;var c=0}else{var c=o.parse(t.MakingD)}var h=u*g;if(i==="IdQtyD"){if(t.QtyD!==l){t.QtyD=l}}if(t.QtyD===""){t.QtyD=0;var p=0;var v=0}else if(t.QtyD===0){t.QtyD=0;var p=0;var v=0}else{var p=o.parse(t.QtyD);var v=p}var y=v*c;if(i==="IdTunch"){if(t.Tunch!==l){t.Tunch=l}}if(t.Tunch===""){t.Tunch=0;var m=0}else if(t.Tunch===0){t.Tunch=0;var m=0}else{var m=o.parse(t.Tunch)}if(d===0){a[a.length-3].setText(0);a[a.length-2].setText(0)}else{if(t.Type==="Silver"){a[a.length-3].setText(g*m/100);a[a.length-2].setText(0)}else if(t.Type==="Gold"){a[a.length-2].setText(g*m/100);a[a.length-3].setText(0)}}if(d===0){a[a.length-1].setText(0)}else{if(h||y){var f=h+y;var S=this.getIndianCurr(f);a[a.length-1].setText(S)}else{a[a.length-1].setText(0)}}}else if(t.Type==="Gold"&&t.Category==="pcs"||t.Type==="GLD"&&t.Category==="pcs"||t.Type==="SLV"&&t.Category==="pcs"||t.Type==="Silver"&&t.Category==="pcs"){if(i==="IdWeight"){if(t.Weight!==l){t.Weight=l}}if(t.Weight===""){var d=0}else if(t.Weight===0){var d=0}else{var d=o.parse(t.Weight)}if(i==="IdWeightD"){if(t.WeightD!==l){t.WeightD=l}}if(t.WeightD===""){var n=0}else if(t.WeightD===0){var n=0}else{var n=o.parse(t.WeightD)}if(n!==""||n!==0){var g=d-n}else{var g=d}if(i==="IdMaking"){if(t.Making!==l){t.Making=l}}if(t.Making===""){t.Making=0;var u=0}else if(t.Making===0){t.Making=0;var u=0}else{var u=o.parse(t.Making)}if(i==="IdMakingD"){if(t.MakingD!==l){t.MakingD=l}}if(t.MakingD===""){t.MakingD=0;var c=0}else if(t.MakingD===0){t.MakingD=0;var c=0}else{var c=o.parse(t.MakingD)}if(i==="IdQty"){if(t.Qty!==l){t.Qty=l}}if(t.Qty===""){t.Qty=0;var T=0}else if(t.Qty===0||t.Qty==="0"){t.Qty=0;var T=0}else{var T=o.parse(t.Qty)}var h=u*T;if(i==="IdQtyD"){if(t.QtyD!==l){t.QtyD=l}}if(t.QtyD===""){t.QtyD=0;var p=0;var v=0}else if(t.QtyD===0||t.QtyD==="0"){var p=0;var v=0}else{var p=o.parse(t.QtyD);var v=p}if(p!==""||p!==0){var v=p}else{t.QtyD=0;var v=0}var y=v*c;if(i==="IdTunch"){if(t.Tunch!==l){t.Tunch=l}}if(t.Tunch===""){t.Tunch=0;var m=0}else if(t.Tunch===0){t.Tunch=0;var m=0}else{var m=o.parse(t.Tunch)}if(d===0){a[a.length-3].setText(0);a[a.length-2].setText(0)}else{if(t.Type==="Silver"){a[a.length-3].setText(g*m/100);a[a.length-2].setText(0)}else if(t.Type==="Gold"){a[a.length-2].setText(g*m/100);a[a.length-3].setText(0)}}if(d===0){a[a.length-1].setText(0)}else{if(h||y){var f=h+y;var S=this.getIndianCurr(f);a[a.length-1].setText(S)}else{a[a.length-1].setText(0)}}}else if(t.Type==="GS"){if(i==="IdQty"){if(t.Qty!==l){t.Qty=l}}if(t.Qty===""){t.Qty=0;var T=0}else if(t.Qty===0||t.Qty==="0"){t.Qty=0;var T=0}else{var T=o.parse(t.Qty)}if(i==="IdMaking"){if(t.Making!==l){t.Making=l}}if(t.Making===""){t.Making=0;var u=0}else if(t.Making===0){t.Making=0;var u=0}else{var u=o.parse(t.Making)}var b=T*u;if(i==="IdQtyD"){if(t.QtyD!==l){t.QtyD=l}}if(t.QtyD===""){t.QtyD=0;var p=0;var v=0}else if(t.QtyD===0||t.QtyD==="0"){var p=0;var v=0}else{var p=o.parse(t.QtyD);var v=p}if(i==="IdMakingD"){if(t.MakingD!==l){t.MakingD=l}}if(t.MakingD===""){t.MakingD=0;var c=0}else if(t.MakingD===0){t.MakingD=0;var c=0}else{var c=o.parse(t.MakingD)}var C=p*c;if(b){var f=b+C;var S=this.getIndianCurr(f);a[a.length-1].setText(S)}else{a[a.length-1].setText(0)}}},onSetting:function(e){this.hideDColumns(e)},gGBhav:0,gGBhavK:0,gSBhav:0,gSBhavK:0,ValueChangeHeader:function(e){this.setStatus("red")},clearScreen:function(e){var r=this;this.setStatus("green");delete this.TotalOrderValueCash;delete this.TotalOrderValueGold;delete this.TotalOrderValueSilver;delete this.DeductionCash;delete this.DeductionGold;delete this.DeductionSilver;delete this.FinalBalanceCash;delete this.FinalBalanceGold;delete this.FinalBalanceSilver;var a=new t({set:true});this.setModel(a,"VisibleSet");var i=this.getView().getModel("local").getProperty("/WSOrderHeader");var l=this.getView().getModel("local").getProperty("/orderHeaderTemp");l.CustomerName="";l.CustomerId="";i.OrderNo="";i.Customer="";l.TotalOrderValueCash="0";l.TotalOrderValueGold="0";l.TotalOrderValueSilver="0";l.DeductionCash="0";l.DeductionGold="0";l.DeductionSilver="0";l.FinalBalanceCash="0";l.FinalBalanceGold="0";l.FinalBalanceSilver="0";l.CombinedBalance="";l.BalanceSuffix="";var s=r.getView().getModel("local").getProperty("/EntryData");s.Customer="";s.Date="";s.OrderNo="";s.OrderType="";s.Remarks="";s.id="";s.Cash="";s.ChangedBy="";s.ChangedOn="";s.CreatedBy="";s.CreatedOn="";r.getView().getModel("local").setProperty("/EntryData",s);this.getView().byId("WSHeaderFragment--RB-4").setSelected(true);this.getView().byId("WSHeaderFragment--custName").setText("");this.getView().getModel("local").setProperty("/orderHeaderTemp",l);this.getView().getModel("local").setProperty("/WSorderHeader",i);this.getView().byId("WSHeaderFragment--DateId").setDateValue(new Date);this.ODataHelper.callOData(r.getOwnerComponent().getModel(),"/CustomCalculations","GET",{},{},r).then(function(e){r.getView().getModel("local").setProperty("/CustomCalculations",e);r.getView().getModel("local").setProperty("/WSOrderHeader/Goldbhav",e.results[0].Gold1);r.getView().getModel("local").setProperty("/WSOrderHeader/GoldbhavK",e.results[0].KacchaGold);r.getView().getModel("local").setProperty("/WSOrderHeader/SilverBhav",e.results[0].Silver1);r.getView().getModel("local").setProperty("/WSOrderHeader/SilverBhavK",e.results[0].KacchaSilver);r.gGBhav=e.results[0].Gold1;r.gGBhavK=e.results[0].KacchaGold;r.gSBhav=e.results[0].Silver1;r.gSBhavK=e.results[0].KacchaSilver}).catch(function(e){});this.orderItem(e);this.materialPopupOrderItem(e);this.orderReturn(e)},onClear:function(e){var t=this;var r=this.getStatus();if(r=="red"){s.error(t.resourceBundle.getText("Master22"),{title:"Alert!",actions:["Save & Clear","Clear",s.Action.CANCEL],onClose:function(r){if(r==="Clear"){t.clearScreen(e);t.setStatus("green");i.show(t.resourceBundle.getText("Screen11"))}else if(r==="Save & Clear"){var a=t.onSave(e);if(a){t.clearScreen(e);i.show(t.resourceBundle.getText("Screen22"))}}}})}else if(r=="green"){t.clearScreen(e);t.setStatus("green")}},onDelete:function(e){debugger;var t=this;var r=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[0];var a=e.getSource().getParent().getParent().getId().split("---")[1].split("--")[1];var i=new sap.ui.core.Locale("en-US");var l=sap.ui.core.format.NumberFormat.getFloatInstance(i);if(a!=="OrderReturn"){a="WSItemFragment--orderItemBases"}var o=t.getView().byId(a).getSelectedIndices();if(o.length&&o.length!==0){s.error(t.resourceBundle.getText("Select11"),{title:"Alert",actions:["Delete selected entries",sap.m.MessageBox.Action.CLOSE],onClose:function(i){if(i==="Delete selected entries"){for(var s=o.length-1;s>=0;--s){if(a==="WSItemFragment--orderItemBases"){var d=t.getView().getModel("orderItems").getProperty("/itemData")[s].itemNo;var n=t.getView().getModel("orderItems").getProperty("/itemData")[o].Material;var g=t.getView().getModel("orderItems").getProperty("/itemData")[o].OrderNo;var u=t.getView().byId("WSHeaderFragment--DateId").getDateValue();var c=t.getView().getModel("orderItems").getProperty("/itemData")[o];var h=l.parse(c.SubTotal);if(h){debugger;t.TotalOrderValueCash=t.TotalOrderValueCash-h;var p=t.getIndianCurr(t.TotalOrderValueCash);t.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",p)}var v=l.parse(c.SubTotalS);if(v){t.TotalOrderValueSilver=t.TotalOrderValueSilver-v;var y=t.getIndianCurr(t.TotalOrderValueSilver);t.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",y)}var m=l.parse(c.SubTotalG);if(m){t.TotalOrderValueGold=t.TotalOrderValueGold-m;var f=t.getIndianCurr(t.TotalOrderValueGold);t.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",f)}t.FinalBalanceCash=t.TotalOrderValueCash-t.DeductionCash;t.FinalBalanceGold=t.TotalOrderValueGold-t.DeductionGold;t.FinalBalanceSilver=t.TotalOrderValueSilver-t.DeductionSilver;if(t.FinalBalanceCash===0){var S=0}else{var S=t.getIndianCurr(t.FinalBalanceCash)}t.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",S);if(t.FinalBalanceGold===0){var T=0}else{var T=t.getIndianCurr(t.FinalBalanceGold)}t.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",T);if(t.FinalBalanceSilver===0){var b=0}else{var b=t.getIndianCurr(t.FinalBalanceSilver)}t.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",b);if(d){var C=t.getView().getModel("local").getProperty("/stockMaint");C.Product=n;C.OrderItemId=d;C.Date=u;C.Weight=t.getView().getModel("orderItems").getProperty("/itemData")[o].Weight;C.Quantity=t.getView().getModel("orderItems").getProperty("/itemData")[o].Qty;var w="/WSOrderItems('"+d+"')";t.ODataHelper.callOData(t.getOwnerComponent().getModel(),w,"DELETE",{},{},t);$.post("/StockDelete",{Stock:C}).then(function(e){debugger;var r=e.id;t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/stockMaints('"+r+"')","DELETE",{},{},t)})}else{t.setStatus("red")}var M=t.getView().getModel("orderItems").getProperty("/itemData");M.splice(o[s],1);t.getView().getModel("orderItems").setProperty("/itemData",M);M.push({OrderNo:"",itemNo:"",Material:"",MaterialCode:"",Description:"",Qty:0,QtyD:0,Weight:0,WeightD:0,Making:0,MakingD:0,Tunch:0,Remarks:"",SubTotal:0,SubTotalS:0,SubTotalG:0,Category:"",CreatedBy:"",CreatedOn:"",ChangedBy:"",ChangedOn:""});t.getView().getModel("orderItems").setProperty("/itemData",M);sap.m.MessageToast.show(t.resourceBundle.getText("Selected12"))}else if(a==="OrderReturn"){t.deleteReturnValues(e,s,o[s],r,M)}}if(a==="WSItemFragment--orderItemBases"){t.getView().byId("WSItemFragment--orderItemBases").clearSelection()}else{t.getView().byId("OrderReturn").clearSelection()}}}})}else{s.show(t.resourceBundle.getText("Select22"),{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},orderCreate:function(e){var t=this;if(this.getView().getModel("local").getProperty("/WSOrderHeader").OrderNo){var r=e.getSource().getParent().getParent().getParent().getId().split("---")[1].split("--")[0];s.confirm(t.resourceBundle.getText("Change11"),{title:"Confirm",onClose:function(r){if(r===s.Action.OK){var a=t.getView().getModel("local").getProperty("/WSOrderHeader").Date;var i=t.getView().getModel("local").getProperty("/WSOrderHeader").Customer;var l=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerId;var o=t.getView().getModel("local").getProperty("/orderHeaderTemp").CustomerName;var d=t.getView().getModel("local").getProperty("/WSOrderHeader");t.clearScreen(e);t.getView().getModel("local").setProperty("/orderHeaderTemp/CustomerId",l);t.getView().byId("WSHeaderFragment--custName").setText(o);t.getView().getModel("local").setProperty("/WSOrderHeader/Customer",i);if(t.getView().byId("WSHeaderFragment--RB-1").getSelected()){var n="C"}else if(t.getView().byId("WSHeaderFragment--RB-2").getSelected()){var n="G"}else if(t.getView().byId("WSHeaderFragment--RB-3").getSelected()){var n="S"}else if(t.getView().byId("WSHeaderFragment--RB-4").getSelected()){var n="O"}t.getView().getModel("local").setProperty("/WSOrderHeader/SummaryMode",n);t.newOrderCreate()}}})}else{t.newOrderCreate()}},newOrderCreate:function(){var e=this;e.getView().setBusy(true);var t=this.getView().getModel("local").getProperty("/WSOrderHeader");if(t.Customer===""){this.getView().byId("WSHeaderFragment--customerId").setValueState("Error").setValueStateText("Please choose Customer before creating Order");e.getView().setBusy(false)}else{this.getView().byId("WSHeaderFragment--customerId").setValueState("None");if(t){t.id="";t.CreatedBy="";t.ChangedBy="";t.CreatedOn="";t.CreatedBy="";delete t.ToWSOrderItem;delete t.ToCustomers;delete t.ToWSOrderReturns}t.Date=this.getView().byId("WSHeaderFragment--DateId").getValue();this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSOrderHeaders","POST",{},t,this).then(function(t){e.getView().setBusy(false);var r=e.getView().getModel("local").getProperty("/OrderId");r.OrderId=t.id;r.OrderNo=t.OrderNo;e.getView().getModel("local").setProperty("/OrderId",r);e.getView().getModel("local").setProperty("/WSOrderHeader/OrderNo",t.OrderNo)}).catch(function(t){if(t.responseText.includes("last order already empty use same")){var r=t.responseText.split(":")[2];if(r){e.ODataHelper.callOData(e.getOwnerComponent().getModel(),"/WSOrderHeaders("+r+")","GET",{},{},e).then(function(t){e.getView().setBusy(false);var r=e.getView().getModel("local").getProperty("/WSOrderHeader");r.OrderId=t.id;r.OrderNo=t.OrderNo;var a=e.getView().getModel("i18n").getResourceBundle().getText("WSOrderCheckMsg");e.getView().getModel("local").setProperty("/WSOrderHeader",r);sap.m.MessageToast.show(a,{duration:3e3,width:"15em"})}).catch(function(t){e.getView().setBusy(false);var r=e.getErrorMessage(t)})}else{e.getView().setBusy(false);var a=e.getErrorMessage(t)}}else{e.getView().setBusy(false);var a=e.getErrorMessage(t)}})}},onValidation:function(){var e=this;var t=true;var r=this.getView().getModel("local").getProperty("/WSOrderHeader");if(r.OrderNo===0||r.OrderNo===""){t=false;s.show(e.resourceBundle.getText("Create11"),{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}e.getView().setBusy(false);return t},onValidationItem:function(e,t){var r=this;var a=this.getView().getModel("orderItems").getProperty("/itemData");var i=r.getView().getModel("local").getProperty("/WSOrderItem");var l=r.getView().byId("WSItemFragment--orderItemBases");var s=l.getBinding("rows");var o=false;if(e.Weight&&e.WeightD&&e.WeightD>e.Weight){l.getRows()[t].getCells()[4].setValueState("Error")}else{l.getRows()[t].getCells()[4].setValueState("None")}if(e.Type==="GS"||(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs")){if(e.Qty===""||e.Qty===0){this.getView().setBusy(false);l.getRows()[t].getCells()[2].setValueState("Error");l.getRows()[t].getCells()[4].setValueState("None");o=true;return}else{i.Qty=e.Qty;l.getRows()[t].getCells()[2].setValueState("None");this.getView().setBusy(false)}}else if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(e.Weight===""||e.Weight===0){this.getView().setBusy(false);l.getRows()[t].getCells()[4].setValueState("Error");l.getRows()[t].getCells()[2].setValueState("None");o=true;return}else{i.Weight=e.Weight;l.getRows()[t].getCells()[4].setValueState("None");this.getView().setBusy(false)}}return o},onReturnSave:function(e,t,r){var a=this.getView().getModel("local").getProperty("/WSOrderReturn");var i=this.getView().byId("OrderReturn");var l=i.getBinding("rows");for(var s=0;s<l.getLength();s++){var o=this;var d=l.oList[s];if(d.Key!=""){a.Key=d.Key;if(d.Type===""||d.Type===0){a.Type=0}else{a.Type=d.Type;if(t){a.OrderNo=t}if(d.Weight===""||d.Weight===0){a.Weight=0}else{a.Weight=d.Weight}if(d.KWeight===""||d.KWeight===0){a.KWeight=0}else{a.KWeight=d.KWeight}if(d.Tunch===""||d.Tunch===0){a.Tunch=0}else{a.Tunch=d.Tunch}if(d.Qty===""||d.Qty===0){a.Qty=0}else{a.Qty=d.Qty}if(d.Bhav===""||d.Bhav===0){a.Bhav=0}else{a.Bhav=d.Bhav}if(d.Remarks===""){a.Remarks=""}else{a.Remarks=d.Remarks}if(d.SubTotal===""||d.SubTotal===0){a.SubTotal=0}else{a.SubTotal=d.SubTotal}if(d.SubTotalG===""||d.SubTotalG===0){a.SubTotalG=0}else{a.SubTotalG=d.SubTotalG}if(d.SubTotalS===""||d.SubTotalS===0){a.SubTotalS=0}else{a.SubTotalS=d.SubTotalS}var n=JSON.parse(JSON.stringify(a));if(d.ReturnId==false){o.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSOrderReturns","POST",{},n,this).then(function(e){o.getView().setBusy(false);var a=o.getView().getModel("returnModel").getProperty("/TransData");for(var i=0;i<a.length;i++){if(a[i].Type===e.Type){a[i].ReturnId=e.id;a[i].orderNo=t;r=true;break}}o.getView().getModel("returnModel").setProperty("/TransData",a);o.getView().setBusy(false);sap.m.MessageToast.show(o.resourceBundle.getText("dataSave"))}).catch(function(e){o.getView().setBusy(false);var t=o.getErrorMessage(e)})}}}}return r},getIndianCurr:function(e){if(e){var t=e;t=t.toString();var r=t.split(".",2);t=r[0];var a=t.substring(t.length-3);var i=t.substring(0,t.length-3);if(i!="")a=","+a;if(r[1]){var l=i.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a+"."+r[1]}else{var l=i.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a}return l}},onSave:function(e){var t=this;if(this.onValidation()===true){var r=this.getView().getModel("local").getProperty("/WSOrderItem");var a=this.getView().byId("WSItemFragment--orderItemBases");var l=a.getBinding("rows");var s=false;var o=false;var d=false;for(var n=0;n<l.getLength();n++){var t=this;var g=l.oList[n];if(g.Material!==""){o=true;if(n===0&&d===false){if(this.onRetItemValidation()===false){d=true}}this.getView().setBusy(true);var u=false;if(this.onValidationItem(g,n,u)===false){s=false}else{s=true}}}if(d===true&&s===false){this.commitRecords(e);this.setStatus("green");i.show(t.resourceBundle.getText("dataSave"))}if(o===false){sap.m.MessageBox.error(t.resourceBundle.getText("entries11"),{title:"Error",styleClass:"",initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit,onClose:function(e){}})}}if(o===true&&d===true&&s===false){var c=true;return c}},onSuggest:function(e){debugger;const t=e.key;var r=e.getParameter("id").split("--")[2];var a=e.getParameter("suggestValue");if(a===""||t==8||t==="Backspace"||t==="Delete"){this.getView().byId("customerId").setValue("");return}if(!a){a=e.getParameter("newValue")}if(a){var i=new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("CustomerCode",sap.ui.model.FilterOperator.Contains,a.toUpperCase()),new sap.ui.model.Filter("Name",sap.ui.model.FilterOperator.Contains,a.toUpperCase())],and:false})}e.getSource().getBinding("suggestionItems").filter(i);var l=new sap.ui.model.Sorter({path:"CustomerCode",descending:false});e.getSource().getBinding("suggestionItems").sort(l);this.getView().byId("customerId").setValue(a)},commitRecords:function(e){if(this.getStatus()==="red"){var t=this;var r=t.getView().getModel("local").getProperty("/WSOrderHeader");var a=t.getView().getModel("local").getProperty("/OrderId").OrderId;t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSOrderHeaders('"+a+"')","PUT",{},r,this).then(function(e){message.show(t.resourceBundle.getText("Order11"));t.getView().setBusy(false)}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)});var i=this.getView().getModel("local").getProperty("/WSOrderItem");var l=this.getView().byId("WSItemFragment--orderItemBases");var s=l.getBinding("rows");var o=false;var d=false;for(var n=0;n<s.getLength();n++){var t=this;var g=s.oList[n];if(g.Material!==""){i.OrderNo=a;i.Material=g.Material;if(g.Qty===""||g.Qty===0){i.Qty=0}else{i.Qty=g.Qty}if(g.QtyD===""||g.QtyD===0){i.QtyD=0}else{i.QtyD=g.QtyD}if(g.Weight===""||g.Weight===0){i.Weight=0}else{i.Weight=g.Weight}if(g.WeightD===""||g.WeightD===0){i.WeightD=0}else{i.WeightD=g.WeightD}if(g.Making===""||g.Making===0){i.Making=0}else{i.Making=g.Making}if(g.MakingD===""||g.MakingD===0){i.MakingD=0}else{i.MakingD=g.MakingD}if(g.Tunch===""||g.Tunch===0){i.Tunch=0}else{i.Tunch=g.Tunch}i.Remarks=g.Remarks;var u=JSON.parse(JSON.stringify(i));if(g.itemNo==false){t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSOrderItems","POST",{},u,this).then(function(e){var r=t.getView().getModel("orderItems").getProperty("/itemData");t.getView().setBusy(false);for(var i=0;i<r.length;i++){if(r[i].Material===e.Material){r[i].itemNo=e.id;r[i].OrderNo=a;t.stockTransfer(r[i]);break}}t.getView().getModel("orderItems").setProperty("/itemData",r);t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Data"))}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)});t.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+u.Material+"')","PUT",{},{CustomerTunch:u.Tunch},t).then(function(e){}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}}}if(d===false){t.onReturnSave(e,a,d)}t.setStatus("green")}else{sap.m.MessageBox.error(t.resourceBundle.getText("NoChange"),{title:"Error",onClose:function(e){}})}},stockTransfer:function(e){var t=this;var r=this.getView().getModel("local").getProperty("/WSOrderHeader/OrderNo");var a=this.getView().getModel("local").getProperty("/WSOrderHeader/Date");var i=this.getView().getModel("local").getProperty("/stockMaint");i.Product=e.Material;i.Description=e.MaterialCode;if(e.Qty===""){i.Quantity="0"}else{i.Quantity=e.Qty}if(e.Weight===""){i.Weight="0"}else{i.Weight=e.Weight}i.OrderItemId=e.itemNo;i.OrderType="W";i.Date=a;i.Remarks="[Auto-Entry]Wholesale Sales Stock "+"for order"+" "+r;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/stockMaints","POST",{},i,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Stock11"))}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})},toggleFullScreen:function(){var e="WSItemFragment--idFullScreenBtn";var t="WSHeaderFragment--WSOrderHeader";this.toggleUiTable(e,t)},finalCalculation:function(e,t,r,a,i,l,s,o,d,n){debugger;var g=this;var u=new sap.ui.core.Locale("en-US");var c=sap.ui.core.format.NumberFormat.getFloatInstance(u);if(t.SubTotal&&t.SubTotal!=""){var h=c.parse(t.SubTotal)}else{var h=0}if(t.SubTotalG&&t.SubTotalG!=""){var p=c.parse(t.SubTotalG)}else{var p=0}if(t.SubTotalS&&t.SubTotalS!=""){var v=c.parse(t.SubTotalS)}else{var v=0}if(e.Type==="Gold"&&e.Category==="gm"||e.Type==="GLD"&&e.Category==="gm"||e.Type==="SLV"&&e.Category==="gm"||e.Type==="Silver"&&e.Category==="gm"){if(t.WeightD!==""||t.WeightD!==0){if(t.Tunch){var y=(t.Weight-t.WeightD)*(t.Tunch/100)}else{var y=t.Weight-t.WeightD}}else{if(t.Tunch){var y=t.Weight*(t.Tunch/100)}else{var y=t.Weight}}if(e.Type==="Gold"||e.Type==="GLD"){if(e.Karat==="22/22"){r=y*s}else if(e.Karat==="22/20"){r=y*s}}else if(e.Type==="Silver"||e.Type==="SLV"){r=y*d}var m=t.Making*y;var f=t.QtyD*t.MakingD;if(r||m||f||(r===0||m===0||f===0)){var S=r+m+f;S=parseFloat(S.toFixed(2));if(S===0){T="0"}else{var T=this.getIndianCurr(S)}if(a){if(T){e.SubTotal=T}else{e.SubTotal=0}this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").setProperty(a,e)}else{if(T!=""){i[i.length-1].setText(T)}else{i[i.length-1].setText("0")}}}else{i[i.length-1].setText(0)}}else if(e.Type==="Gold"&&e.Category==="pcs"||e.Type==="GLD"&&e.Category==="pcs"||e.Type==="SLV"&&e.Category==="pcs"||e.Type==="Silver"&&e.Category==="pcs"){if(t.WeightD!==""||t.WeightD!==0){var y=t.Weight-t.WeightD}else{var y=t.Weight}var m=t.Making*t.Qty;var f=t.QtyD*t.MakingD;if(m||f||(m===0||f===0)){var S=m+f;S=parseFloat(S).toFixed(0);var T=this.getIndianCurr(S);if(a){e.SubTotal=T;this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").setProperty(a,e)}else{i[i.length-1].setText(T)}}else{i[i.length-1].setText(0)}}else if(e.Type==="GS"){var b=t.Qty*t.Making;var C=t.QtyD*t.MakingD;if(b){var S=b+C;S=parseFloat(S).toFixed(0);var T=this.getIndianCurr(S);if(a){e.SubTotal=T;this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").setProperty(a,e)}else{i[i.length-1].setText(T)}}else{i[i.length-1].setText(0)}}if(e.Type==="Silver"){var w=y*t.Tunch/100;w=parseFloat(w).toFixed(2);var M=0;M=parseFloat(M).toFixed(3);if(a){e.SubTotalS=w;e.SubTotalG=M;this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").setProperty(a,e)}else{i[i.length-3].setText(w);i[i.length-2].setText(M)}}else if(e.Type==="Gold"){var M=y*t.Tunch/100;M=parseFloat(M).toFixed(3);var w=0;w=parseFloat(w).toFixed(2);if(a){e.SubTotalG=M;e.SubTotalS=w;this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").setProperty(a,e)}else{i[i.length-2].setText(M);i[i.length-3].setText(w)}}if(t.SubTotal&&t.SubTotal!=""){var D=c.parse(t.SubTotal);this.TotalOrderValueCash=D+this.TotalOrderValueCash-h}var V=this.TotalOrderValueCash.toString();V=parseFloat(V).toFixed(0);V=this.getIndianCurr(V);this.orderAmount=V;this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",V);if(t.SubTotalG&&t.SubTotalG!=""){var O=c.parse(t.SubTotalG);this.TotalOrderValueGold=O+this.TotalOrderValueGold-p}var I=this.TotalOrderValueGold.toString();I=parseFloat(I).toFixed(3);I=this.getIndianCurr(I);this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",I);if(t.SubTotalS&&t.SubTotalS!=""){var W=c.parse(t.SubTotalS);this.TotalOrderValueSilver=W+this.TotalOrderValueSilver-v}var P=this.TotalOrderValueSilver.toString();P=parseFloat(P).toFixed(2);P=this.getIndianCurr(P);this.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",P)},PreCalc:function(e,t,r,a){var i=this;i.setNewValue(e,t,r);i.getFloatValue(e,a)},setNewValue:function(e,t,r){var a=this;if(t==="IdWeight"){if(e.Weight!==r){e.Weight=r}}if(t==="IdWeightD"){if(e.WeightD!==r){e.WeightD=r}}if(t==="IdMaking"){if(e.Making!==r){e.Making=r;a.onTunchMakingChange(e,t,r)}}if(t==="IdMakingD"){if(e.MakingD!==r){e.MakingD=r}}if(t==="IdQty"){if(e.Qty!==r){e.Qty=r}}if(t==="IdQtyD"){if(e.QtyD!==r){e.QtyD=r}}if(t==="IdTunch"){if(e.Tunch!==r){e.Tunch=r;a.onTunchMakingChange(e,t,r)}}},getFloatValue:function(e,t){if(e.Making===""){e.Making=0}else if(e.Making===0){e.Making=0}else{if(e.Making){var r=e.Making.toString();e.Making=t.parse(r)}}if(e.MakingD===""){e.MakingD=0;a=0}else if(e.MakingD===0){e.MakingD=0;a=0}else{var a=e.MakingD.toString();e.MakingD=t.parse(a)}if(e.Weight===""){e.Weight=0}else if(e.Weight===0){e.Weight=0}else{var i=e.Weight.toString();e.Weight=t.parse(i)}if(e.WeightD===""){e.WeightD=0}else if(e.WeightD===0){e.WeightD=0}else{var l=e.WeightD.toString();e.WeightD=t.parse(l)}if(e.Qty===""){e.Qty=0}else if(e.Qty===0){e.Qty=0}else{var s=e.Qty.toString();e.Qty=t.parse(s)}if(e.QtyD===""){e.QtyD=0}else if(e.QtyD===0){e.QtyD=0}else{var o=e.QtyD.toString();e.QtyD=t.parse(o)}if(e.Tunch===""){e.Tunch=0}else if(e.Tunch===0){e.Tunch=0}else{if(e.Tunch){var d=e.Tunch.toString();e.Tunch=t.parse(d)}}},Calculation:function(e,t,r){debugger;var a=this;var i=this.getView().getModel("local").getProperty("/WSOrderHeader");if(e.getId()==="orderReload"||e.getSource().getBindingInfo("value").binding.getPath().split("/")[1]==="orderHeader"){if(t){var l=this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").getProperty(t);var s=t;var o=this.getView().byId("WSItemFragment--orderItemBases")._getVisibleColumns()}}else{var l=this.getView().byId("WSItemFragment--orderItemBases").getModel("orderItems").getProperty(e.getSource().getParent().getBindingContext("orderItems").getPath());var s=this.getView().byId("WSItemFragment--orderItemBases").getBinding().getPath()+"/"+e.getSource().getParent().getIndex();var d=e.getSource().getParent();var o=d.getCells();var r=e.getSource().getParent().getIndex()}var n=this.getView().getModel("orderItems").getProperty(s);var g=0;var u=0;if(e.getId()!="orderReload"){var c=e.getSource().getId().split("---")[1].split("--")[2].split("-")[0];var h=e.getParameters().newValue}var p=i.Goldbhav/10;var v=i.GoldbhavK/10;var y=i.SilverBhav/1e3;var m=i.SilverBhavK/1e3;var f=n.QtyD;var S=new sap.ui.core.Locale("en-US");var T=sap.ui.core.format.NumberFormat.getFloatInstance(S);if(!l.Category||!l.Type){if(l.Material!==""){a.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products('"+l.Material+"')","GET",{},{},a).then(function(e){l.Category=e.Category;if(!l.Making||l.Making===0){l.Making=e.Making}if(!l.Tunch||l.Tunch===0){l.Tunch=e.Tunch}l.Type=e.Type;a.PreCalc(n,c,h,T);a.finalCalculation(l,n,g,t,o,f,p,v,y,m);a.getFinalBalance();a.onRadioButtonSelect()}).catch(function(e){a.getView().setBusy(false);var t=a.getErrorMessage(e)})}}else{a.PreCalc(n,c,h,T);a.finalCalculation(l,n,g,t,o,f,p,v,y,m);a.getFinalBalance();a.onRadioButtonSelect()}this.byId("IdMaking");this.byId("IdMakingD");this.byId("IdWeightD");this.byId("IdWeight");this.byId("IdQty");this.byId("IdQtyD");this.byId("sbhavid")},onTunchMakingChange:function(e,t,r){debugger;var a=this;var i=new sap.ui.core.Locale("en-US");var l=sap.ui.core.format.NumberFormat.getFloatInstance(i);var s=this.getView().getModel("local").getProperty("/WSTunch");s.Customer=this.getView().getModel("local").getProperty("/WSOrderHeader").Customer;s.Product=e.Material;if(s.Customer&&s.Product){if(t==="IdTunch"){if(e.Tunch!==r){s.Tunch=l.parse(r)}else{s.Tunch=e.Tunch}}if(t==="IdMaking"){if(e.Making!==r){s.Making=l.parse(r)}else{s.Making=e.Making}}if(s.Making===0){s.Making=e.Making}if(s.Tunch===0){s.Tunch=e.Tunch}}debugger;if(s.Tunch||s.Making){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSTunchs","POST",{},s,this).then(function(e){debugger;a.getView().setBusy(false)}).catch(function(e){debugger})}},getFinalBalance:function(){debugger;var e=this;e.FinalBalanceCash=e.TotalOrderValueCash-e.DeductionCash;if(e.FinalBalanceCash===0){var t=0}else{var t=parseFloat(e.FinalBalanceCash).toFixed(0);t=e.getIndianCurr(t)}e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",t);e.FinalBalanceGold=e.TotalOrderValueGold-e.DeductionGold;if(e.FinalBalanceGold===0){var r=parseFloat(0).toFixed(3);r=e.getIndianCurr(r)}else{var r=parseFloat(e.FinalBalanceGold).toFixed(3);r=e.getIndianCurr(r)}e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",r);e.FinalBalanceSilver=e.TotalOrderValueSilver-e.DeductionSilver;if(e.FinalBalanceSilver===0){var a=parseFloat(0).toFixed(2);a=e.getIndianCurr(a)}else{var a=parseFloat(e.FinalBalanceSilver).toFixed(2);a=e.getIndianCurr(a)}e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",a)},onReturnChange:function(e){debugger;if(e.getSource().getId().split("---")[1].split("--")[0]=="idsales"){this.byId("Sales--idSaveIcon").setColor("red")}else if(e.getSource().getId().split("---")[1].split("--")[0]=="idsalesws"){this.byId("WSHeaderFragment--idSaveIcon").setColor("red")}var t=e.getSource().getParent().getBindingContext("returnModel").getPath();var r=this.getView().getModel("returnModel").getProperty(t);var a=e.getSource().getId().split("---")[1].split("--")[0];if(a==="idsales"){var i=this.getView().getModel("local").getProperty("/orderHeader")}else{}this.returnCalculation(e,i,r);this.getFinalBalance();that.onRadioButtonSelect()},returnCalculation:function(e,t,r){debugger;if(e.getId()==="orderReload"){var a=this.getView().getModel("returnModel").getProperty(r);var i=r;var l=this.getView().byId("OrderReturn")._getVisibleColumns();d=e.viewId}else{var a=r;var s=e.getParameters().newValue;var o=e.getParameters().id.split("---")[1].split("--")[1].split("-")[0];var d=e.getSource().getId().split("---")[1].split("--")[0];var n=e.getSource().getParent();var l=n.getCells()}var g=new sap.ui.core.Locale("en-US");var u=sap.ui.core.format.NumberFormat.getFloatInstance(g);if(s){this.setReturnNewValue(a,o,s)}this.getReturnFloatValue(a,u);if(a.SubTotal&&a.SubTotal!=""){var c=u.parse(a.SubTotal)}else{var c=0}if(a.SubTotalG&&a.SubTotalG!=""){var h=u.parse(a.SubTotalG)}else{var h=0}if(a.SubTotalS&&a.SubTotalS!=""){var p=u.parse(a.SubTotalS)}else{var p=0}if(a.Key==="OG"||a.Key==="KG"||a.Key==="BG"){if(a.Key==="BG"){a.Tunch=100}var v=a.Bhav/10;var y=a.Weight-a.KWeight;var m=a.Tunch*y/100;var f=parseFloat(m).toFixed(3);var S=m*v;var T=parseFloat(S).toFixed(0);T=this.getIndianCurr(T);var b=this.getIndianCurr(S);if(i){a.SubTotal=b;if(d=="idsalesws"){a.SubTotal=T;if(S){a.SubTotalG=0;a.SubTotalS=0}else{a.SubTotal=0;a.SubTotalG=f;a.SubTotalS=0}}this.getView().byId("OrderReturn").getModel("returnModel").setProperty(i,a)}else{l[l.length-1].setText(b);if(d=="idsalesws"){l[l.length-1].setText(T);if(b){l[l.length-2].setText(0)}else{l[l.length-2].setText(f);l[l.length-3].setText(0)}}}}else if(a.Key==="OS"||a.Key==="KS"||a.Key==="BS"){if(a.Key==="BS"){a.Tunch=100}var v=a.Bhav/1e3;var y=a.Weight-a.KWeight;var C=a.Tunch*y/100;var w=parseFloat(C).toFixed(2);var S=C*v;var T=parseFloat(S).toFixed(0);T=this.getIndianCurr(T);var b=this.getIndianCurr(S);if(i){a.SubTotal=b;if(d=="idsalesws"){a.SubTotal=T;if(S){a.SubTotalG=0;a.SubTotalS=0}else{a.SubTotalS=w;a.SubTotalG=0;a.SubTotal=0}}this.getView().byId("OrderReturn").getModel("returnModel").setProperty(i,a)}else{l[l.length-1].setText(b);if(d=="idsalesws"){l[l.length-1].setText(T);if(S){l[l.length-3].setText(0);l[l.length-2].setText(0)}else{l[l.length-3].setText(w);l[l.length-2].setText(0);l[l.length-1].setText(0)}}}}else if(a.Key==="CASH"){var b=this.getIndianCurr(a.Bhav);var M=parseFloat(a.Bhav).toFixed(0);M=this.getIndianCurr(M);if(i){a.SubTotal=b;if(d=="idsalesws"){a.SubTotal=M}this.getView().byId("OrderReturn").getModel("returnModel").setProperty(i,a)}else{l[l.length-1].setText(b);if(d=="idsalesws"){l[l.length-1].setText(M)}}}debugger;if(a.SubTotal&&a.SubTotal!==""&&a.SubTotal!=="0"){var D=u.parse(a.SubTotal);this.DeductionCash=D+this.DeductionCash-c;this.DeductionGold=this.DeductionGold-h;this.DeductionSilver=this.DeductionSilver-p}else{this.DeductionCash=this.DeductionCash-c;if(a.SubTotalG&&a.SubTotalG!==""){var V=u.parse(a.SubTotalG);this.DeductionGold=V+this.DeductionGold-h}if(a.SubTotalS&&a.SubTotalS!==""){var O=u.parse(a.SubTotalS);this.DeductionSilver=O+this.DeductionSilver-p}}var I=this.DeductionCash;I=parseFloat(I).toFixed(0);var W=this.getIndianCurr(I);this.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionCash",W);var P=this.DeductionGold;P=parseFloat(P).toFixed(3);var F=this.getIndianCurr(P);this.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionGold",F);var x=this.DeductionSilver;x=parseFloat(x).toFixed(2);var B=this.getIndianCurr(x);this.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionSilver",B)},ValueChangeMaterial:function(e){debugger;var t=this;var r=e.getSource().getId().split("---")[1];if(r!==undefined){if(r.split("--")[0]==="idsalesws"){this.byId("WSHeaderFragment--idSaveIcon").setColor("red")}}var a=sap.ui.core.Fragment.byId("fr2","idSaveIndicator");if(a){a.setColor("red")}var i=e.getSource().getParent().getBindingContext("orderItems");var l=this.getView().getModel("local").getProperty("/WSOrderHeader");var s=null;if(!i){debugger;i=e.getSource().getParent().getBindingContext("materialPopupOrderItems");s=l.id;var o=e.getSource().mBindingInfos.value.binding.oContext.sPath;if(!s){var d=new sap.ui.model.Filter("OrderNo","EQ",l.OrderNo);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/WSOrderHeaders","GET",{filters:[d]},{},t).then(function(e){debugger;s=e.results[e.results.length-1].id;o=o+"/OrderNo";t.getView().getModel("materialPopupOrderItems").setProperty(o,s)})}else{o=o+"/OrderNo";t.getView().getModel("materialPopupOrderItems").setProperty(o,s)}}var n=i.getModel("local");var g=e.getSource().getParent().getBindingContext("orderItems");if(!g){g=e.getSource().getParent().getBindingContext("materialPopupOrderItems")}var u=g.getPath();var c=n.getProperty(u+"/MaterialCode");var d=new sap.ui.model.Filter("ProductCode","EQ",c.toUpperCase());var h=e.getSource().getId();this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Products","GET",{filters:[d]},{},this).then(function(e){console.log(e.results[0]);if(e.results[0]){debugger;if(h.includes("fr2")){t.focusAndSelectNextInput(h,"input[id*='fr2--id']")}else{t.focusAndSelectNextInput(h,"input[id*='idsalesws--WSItemFragment']")}}var a=e.results[0];n.setProperty(u+"/Material",a.id);if(a.HindiName){n.setProperty(u+"/Description",a.HindiName)}else{n.setProperty(u+"/Description",a.ProductName)}n.setProperty(u+"/MaterialCode",a.ProductCode);if(a.Making){n.setProperty(u+"/Making",a.Making)}else{n.setProperty(u+"/Making",0)}if(a.PricePerUnit){n.setProperty(u+"/MakingD",a.PricePerUnit)}else{n.setProperty(u+"/MakingD",0)}n.setProperty(u+"/Category",a.Category);n.setProperty(u+"/Type",a.Type);n.setProperty(u+"/Karat",a.Karat);if(r!==undefined){if(r.split("--")[0]==="idsalesws"){var i=t.getView().getModel("local").getProperty("/WSOrderHeader").Customer;var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"'"+i+"'");var s=new sap.ui.model.Filter("Product",sap.ui.model.FilterOperator.EQ,"'"+a.id+"'");var o=new sap.ui.model.Filter({filters:[l,s],and:true});t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/WSTunchs","GET",{filters:[l,s]},null,t).then(function(e){debugger;if(e.results.length>0){a.Making=e.results[0].Making;a.Tunch=e.results[0].Tunch}if(a.Tunch){n.setProperty(u+"/Tunch",a.Tunch)}if(a.Making){n.setProperty(u+"/Making",a.Making)}}).catch(function(e){debugger;if(a.Tunch){n.setProperty(u+"/Tunch",a.Tunch)}else{n.setProperty(u+"/Tunch",0)}})}}}).catch(function(e){})},onDialogClose:function(e){this.wsMaterialPopup.close()},onDialogSave:function(e){debugger;var t=this;var r=sap.ui.core.Fragment.byId("fr2","materialPopupTable");var a=r.getBinding("rows");var i=[];var l=t.getView().getModel("materialPopupOrderItems").getProperty("/popupItemsData");var s=false;var o=sap.ui.core.Fragment.byId("fr2","idSaveIndicator");for(let e=0;e<a.getLength();e++){var t=this;var d=a.oList[e];if(d.id===""){if(d.MaterialCode!==""){if(o){o.setColor("red")}if(d.Qty>0){}else{s=true;break}}}}if(s===true){sap.m.MessageBox.error(t.resourceBundle.getText("Quantity11"));e.getSource().setEnabled(false)}else{for(let e=0;e<a.getLength();e++){var t=this;var d=a.oList[e];if(d.id===""){if(d.MaterialCode!==""){if(d.Qty>0){var n={data:d};n.Qty=Math.abs(n.Qty)*-1;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/StockItems","POST",{},n,this).then(function(r){t.getView().setBusy(false);debugger;l[e].id=r.id;sap.m.MessageToast.show(t.resourceBundle.getText("Data"));if(o){o.setColor("green")}t.getView().getModel("materialPopupOrderItems").setProperty("/popupItemsData",l)}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}}}}}},wsMaterialPopup:null,onFindMaterial:function(){debugger;var e=this;var t=this.getView().getModel("local").getProperty("/WSOrderHeader");if(t.OrderNo!==0&&t.OrderNo!==""){if(!this.wsMaterialPopup){this.wsMaterialPopup=new sap.ui.xmlfragment("fr2","victoria.fragments.tableSelectDialog",this);this.getView().addDependent(this.wsMaterialPopup)}e.clearPopupScreen();var r=t.id;var a=null;if(!r){var a=new sap.ui.model.Filter("OrderNo","EQ",t.OrderNo);e.ODataHelper.callOData(e.getOwnerComponent().getModel(),"/WSOrderHeaders","GET",{filters:[a]},{},e).then(function(e){debugger;r=e.results[e.results.length-1].id;r="'"+r+"'";a=new sap.ui.model.Filter("OrderNo","EQ",r)})}else{r="'"+r+"'";a=new sap.ui.model.Filter("OrderNo","EQ",r)}setTimeout(function(){e.ODataHelper.callOData(e.getOwnerComponent().getModel(),"/StockItems","GET",{filters:[a]},{},e).then(function(t){debugger;if(t.results.length>0){var r=e.getView().getModel("materialPopupOrderItems").getProperty("/popupItemsData");for(var a=0;a<t.results.length;a++){var i=e.allMasterData.materials[t.results[a].Material];r[a].MaterialCode=i.ProductCode;r[a].Qty=Math.abs(t.results[a].Qty);r[a].id=t.results[a].id;r[a].Description=i.HindiName||i.ProductName;r[a].OrderNo=t.results[a].OrderNo}e.getView().getModel("materialPopupOrderItems").setProperty("/popupItemsData",r)}var l=sap.ui.core.Fragment.byId("fr2","idSaveIndicator");if(l){l.setColor("green")}})},1e3);this.wsMaterialPopup.open();setTimeout(function(){$("input[type='Number']").focus(function(){$(this).select()})},300)}else{var i=e.getView().getModel("i18n").getResourceBundle().getText("orderValidation");s.show(i,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},onMaterialSelect:function(e){debugger;var t=this;var r=e.getSource().getId().split("---")[1];if(r!==undefined){if(r.split("--")[0]==="idsales"){this.byId("Sales--idSaveIcon").setColor("red")}}var a=sap.ui.core.Fragment.byId("fr2","idSaveIndicator");if(a){a.setColor("red")}var i=e.getParameter("selectedItem").getModel().getProperty(e.getParameter("selectedItem").getBindingContext().getPath());var l=e.getSource().getParent().getBindingContext("orderItems");var s=null;var o=this.getView().getModel("local").getProperty("/WSOrderHeader");if(!l){debugger;l=e.getSource().getParent().getBindingContext("materialPopupOrderItems");s=o.id;var d=e.getSource().mBindingInfos.value.binding.oContext.sPath;if(!s){var n=new sap.ui.model.Filter("OrderNo","EQ",o.OrderNo);t.ODataHelper.callOData(t.getOwnerComponent().getModel(),"/WSOrderHeaders","GET",{filters:[n]},{},t).then(function(e){debugger;s=e.results[e.results.length-1].id;d=d+"/OrderNo";t.getView().getModel("materialPopupOrderItems").setProperty(d,s)})}else{d=d+"/OrderNo";t.getView().getModel("materialPopupOrderItems").setProperty(d,s)}}var g=l.getModel();var u=e.getSource().getParent().getBindingContext("orderItems");if(!u){u=e.getSource().getParent().getBindingContext("materialPopupOrderItems")}var c=u.getPath();g.setProperty(c+"/Material",i.id);if(i.HindiName){g.setProperty(c+"/Description",i.HindiName)}else{g.setProperty(c+"/Description",i.ProductName)}if(i.Making){g.setProperty(c+"/Making",i.Making)}else{g.setProperty(c+"/Making",0)}if(i.PricePerUnit){g.setProperty(c+"/MakingD",i.PricePerUnit)}else{g.setProperty(c+"/MakingD",0)}g.setProperty(c+"/Category",i.Category);g.setProperty(c+"/Type",i.Type);g.setProperty(c+"/Karat",i.Karat);debugger;if(r!==undefined){if(r.split("--")[0]==="idsalesws"){var h=this.getView().getModel("local").getProperty("/WSOrderHeader").Customer;var p=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"'"+h+"'");var v=new sap.ui.model.Filter("Product",sap.ui.model.FilterOperator.EQ,"'"+i.id+"'");var n=new sap.ui.model.Filter({filters:[p,v],and:true});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/WSTunchs","GET",{filters:[p,v]},null,this).then(function(e){debugger;if(e.results.length>0){i.Making=e.results[0].Making;i.Tunch=e.results[0].Tunch}if(i.Tunch){g.setProperty(c+"/Tunch",i.Tunch)}if(i.Making){g.setProperty(c+"/Making",i.Making)}}).catch(function(e){debugger;if(i.Tunch){g.setProperty(c+"/Tunch",i.Tunch)}else{g.setProperty(c+"/Tunch",0)}})}}if(r!==undefined){if(r.split("--")[0]==="idsalesws"){this.byId("WSHeaderFragment--idSaveIcon").setColor("red")}}var y=e.getSource().getId();if(y.includes("fr2")){t.focusAndSelectNextInput(y,"input[id*='fr2--id']")}else{t.focusAndSelectNextInput(y,"input[id*='idsalesws--WSItemFragment']")}},previousOrder:function(e){debugger;var t=this;var r=this.getView().getModel("local").getProperty("/WSOrderHeader");$.post("/previousWSOrder",{OrderDetails:r}).then(function(r){console.log(r);if(r){debugger;delete t.TotalOrderValueCash;delete t.TotalOrderValueGold;delete t.TotalOrderValueSilver;delete t.DeductionCash;delete t.DeductionGold;delete t.DeductionSilver;delete t.FinalBalanceCash;delete t.FinalBalanceGold;delete t.FinalBalanceSilver;var a=t.getView().getModel("local").getProperty("/orderHeaderTemp");a.TotalOrderValueCash="0";a.TotalOrderValueGold="0";a.TotalOrderValueSilver="0";a.DeductionCash="0";a.DeductionGold="0";a.DeductionSilver="0";a.FinalBalanceCash="0";a.FinalBalanceGold="0";a.FinalBalanceSilver="0";a.CombinedBalance="";a.BalanceSuffix="";t.getView().getModel("local").setProperty("/orderHeaderTemp",a);var i=r.id;if(r.Customer){var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,r.Customer)}else{var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}var s="WSsales";t.orderItem(e,s);t.orderReturn(e,s);e.sId="orderReload";t.getOrderDetails(e,i,l)}})},nextOrder:function(e){var t=this.getView().byId("__component0---idsalesws--WSHeaderFragment--DateId").getDateValue();debugger;var r=new Date(t);r.setDate(t.getDate()-1);r.setHours(0,0,0,1);var a=new Date(t);a.setDate(t.getDate()-1);a.setHours(23,59,59,59);var i=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.GE,r);var l=new sap.ui.model.Filter("Date",sap.ui.model.FilterOperator.LE,a);var s=new sap.ui.model.Filter({filters:[i,l],and:true});var o=this;var d=this.getView().getModel("local").getProperty("/WSOrderHeader");var n=new sap.ui.model.Filter("OrderNo","EQ","251");if(!d.OrderNo&&false){o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/WSOrderHeaders","GET",{filters:[n]},{},o).then(function(t){debugger;var r=t.results.length;var a=t.results[r-1];var i=a.Date;var l=i.getDate()+"-"+i.getMonth()+1+"-"+i.getFullYear();var s=new Date;var d=s.getDate()-1+"-"+s.getMonth()+1+"-"+s.getFullYear();var g=a.id;o.getView().getModel("local").setProperty("/orderHeaderTemp/OrderId",g);e.sId="orderReload";if(d===l){o.getOrderDetails(e,g,n)}else{sap.m.MessageToast.show(o.resourceBundle.getText("Orderno11"))}})}else{this.getView().setBusy(true);$.post("/nextWSOrder",{OrderDetails:d}).then(function(t){console.log(t);o.getView().setBusy(false);debugger;if(t){var r="WSsales";delete o.TotalOrderValueCash;delete o.TotalOrderValueGold;delete o.TotalOrderValueSilver;delete o.DeductionCash;delete o.DeductionGold;delete o.DeductionSilver;delete o.FinalBalanceCash;delete o.FinalBalanceGold;delete o.FinalBalanceSilver;var a=o.getView().getModel("local").getProperty("/orderHeaderTemp");a.TotalOrderValueCash="0";a.TotalOrderValueGold="0";a.TotalOrderValueSilver="0";a.DeductionCash="0";a.DeductionGold="0";a.DeductionSilver="0";a.FinalBalanceCash="0";a.FinalBalanceGold="0";a.FinalBalanceSilver="0";a.CombinedBalance="";a.BalanceSuffix="";o.getView().getModel("local").setProperty("/orderHeaderTemp",a);o.orderItem(e,r);o.orderReturn(e,r);var i=t.id;if(t.Customer){var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t.Customer)}else{var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"")}e.sId="orderReload";o.getOrderDetails(e,i,l)}if(!d.OrderNo){var l=new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,"");o.getOrderDetails(e,t.id,s);o.orderSearchPopup=new sap.ui.xmlfragment("victoria.fragments.popup",o);o.getView().addDependent(o.orderSearchPopup);o.orderSearchPopup.bindAggregation("items",{path:"/OrderHeaders",filters:s,template:new sap.m.DisplayListItem({label:"{OrderNo}",value:{path:"Customer",formatter:o.getCustomerName.bind(o)}})})}}).catch(function(){o.getView().setBusy(false)})}},onRadioButtonSelect:function(){debugger;var e=this;debugger;var t=new sap.ui.core.Locale("en-US");var r=sap.ui.core.format.NumberFormat.getFloatInstance(t);var a=this.getView().getModel("local").getProperty("/WSOrderHeader");if(this.getView().byId("WSHeaderFragment--RB-1").getSelected()){var i=e.TotalOrderValueSilver*a.SilverBhav/1e3;var l=e.TotalOrderValueGold*a.Goldbhav/10;var s=e.DeductionGold*a.Goldbhav/10;var o=e.DeductionSilver*a.SilverBhav/1e3;var d=e.FinalBalanceGold*a.Goldbhav/10;var n=e.FinalBalanceSilver*a.SilverBhav/1e3;var g=e.TotalOrderValueCash;var u=e.DeductionCash;var c=e.FinalBalanceCash;g=g+i+l;i=0;l=0;u=u+s+o;o=0;s=0;c=d+n+c;n=0;d=0;var h=c;var p="Rupees of Cash";d=parseFloat(d).toFixed(0);d=e.getIndianCurr(d);n=parseFloat(n).toFixed(0);n=e.getIndianCurr(n);c=parseFloat(c).toFixed(0);c=e.getIndianCurr(c);i=parseFloat(i).toFixed(0);i=e.getIndianCurr(i);g=parseFloat(g).toFixed(0);g=e.getIndianCurr(g);l=parseFloat(l).toFixed(0);l=e.getIndianCurr(l);s=parseFloat(s).toFixed(0);s=e.getIndianCurr(s);o=parseFloat(o).toFixed(0);o=e.getIndianCurr(o);u=parseFloat(u).toFixed(0);u=e.getIndianCurr(u);h=parseFloat(h).toFixed(0);h=e.getIndianCurr(h);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionSilver",o);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionGold",s);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionCash",u);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",i);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",l);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",g);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",d);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",n);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",c)}else if(this.getView().byId("WSHeaderFragment--RB-2").getSelected()){debugger;var i=e.TotalOrderValueSilver*a.SilverBhav/(100*a.Goldbhav);var l=e.TotalOrderValueGold;var g=e.TotalOrderValueCash*10/a.Goldbhav;var s=e.DeductionGold;var o=e.DeductionSilver*a.SilverBhav/(100*a.Goldbhav);var u=e.DeductionCash*10/a.Goldbhav;var d=e.FinalBalanceGold;var n=e.FinalBalanceSilver*a.SilverBhav/(100*a.Goldbhav);var c=e.FinalBalanceCash*10/a.Goldbhav;l=g+i+l;i=0;g=0;s=u+s+o;o=0;u=0;d=d+n+c;n=0;c=0;var h=d;var p="grams of Gold";d=parseFloat(d).toFixed(3);d=e.getIndianCurr(d);n=parseFloat(n).toFixed(3);n=e.getIndianCurr(n);c=parseFloat(c).toFixed(3);c=e.getIndianCurr(c);i=parseFloat(i).toFixed(3);i=e.getIndianCurr(i);l=parseFloat(l).toFixed(3);l=e.getIndianCurr(l);g=parseFloat(g).toFixed(3);g=e.getIndianCurr(g);s=parseFloat(s).toFixed(3);s=e.getIndianCurr(s);o=parseFloat(o).toFixed(3);o=e.getIndianCurr(o);u=parseFloat(u).toFixed(3);u=e.getIndianCurr(u);h=parseFloat(h).toFixed(3);h=e.getIndianCurr(h);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionSilver",o);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionGold",s);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionCash",u);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",i);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",l);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",g);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",d);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",n);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",c)}else if(this.getView().byId("WSHeaderFragment--RB-3").getSelected()){debugger;var i=e.TotalOrderValueSilver;var l=e.TotalOrderValueGold*100*a.Goldbhav/a.SilverBhav;var g=1e3*e.TotalOrderValueCash/a.SilverBhav;var s=e.DeductionGold*100*a.Goldbhav/a.SilverBhav;var o=e.DeductionSilver;var u=1e3*e.DeductionCash/a.SilverBhav;var d=e.FinalBalanceGold*100*a.Goldbhav/a.SilverBhav;var n=1e3*e.FinalBalanceCash/a.SilverBhav;var c=e.FinalBalanceCash;var h=d+n+c;var p="grams of Silver";i=g+i+l;l=0;g=0;o=u+s+o;s=0;u=0;n=n;d=0;c=0;d=parseFloat(d).toFixed(2);d=e.getIndianCurr(d);n=parseFloat(n).toFixed(2);n=e.getIndianCurr(n);c=parseFloat(c).toFixed(2);c=e.getIndianCurr(c);i=parseFloat(i).toFixed(2);i=e.getIndianCurr(i);l=parseFloat(l).toFixed(2);l=e.getIndianCurr(l);g=parseFloat(g).toFixed(2);g=e.getIndianCurr(g);s=parseFloat(s).toFixed(2);s=e.getIndianCurr(s);o=parseFloat(o).toFixed(2);o=e.getIndianCurr(o);u=parseFloat(u).toFixed(2);u=e.getIndianCurr(u);h=parseFloat(h).toFixed(2);h=e.getIndianCurr(h);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionSilver",o);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionGold",s);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionCash",u);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",i);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",l);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",g);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",d);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",n);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",c)}else if(this.getView().byId("WSHeaderFragment--RB-4").getSelected()){debugger;var i=e.TotalOrderValueSilver;var l=e.TotalOrderValueGold;var g=e.TotalOrderValueCash;var s=e.DeductionGold;var o=e.DeductionSilver;var u=e.DeductionCash;var d=e.FinalBalanceGold;var n=e.FinalBalanceSilver;var c=e.FinalBalanceCash;var h="*Click on Gold, Silver or Cash";var p="buttons for Combined Balance";d=parseFloat(d).toFixed(3);d=e.getIndianCurr(d);n=parseFloat(n).toFixed(2);n=e.getIndianCurr(n);c=parseFloat(c).toFixed(0);c=e.getIndianCurr(c);i=parseFloat(i).toFixed(2);i=e.getIndianCurr(i);l=parseFloat(l).toFixed(3);l=e.getIndianCurr(l);g=parseFloat(g).toFixed(0);g=e.getIndianCurr(g);s=parseFloat(s).toFixed(3);s=e.getIndianCurr(s);o=parseFloat(o).toFixed(2);o=e.getIndianCurr(o);u=parseFloat(u).toFixed(0);u=e.getIndianCurr(u);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionSilver",o);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionGold",s);e.getView().getModel("local").setProperty("/orderHeaderTemp/DeductionCash",u);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueSilver",i);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueGold",l);e.getView().getModel("local").setProperty("/orderHeaderTemp/TotalOrderValueCash",g);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceGold",d);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceSilver",n);e.getView().getModel("local").setProperty("/orderHeaderTemp/FinalBalanceCash",c)}e.getView().getModel("local").setProperty("/orderHeaderTemp/CombinedBalance",h);e.getView().getModel("local").setProperty("/orderHeaderTemp/BalanceSuffix",p)},onExit:function(){if(this.searchPopup){this.searchPopup.destroy()}},onTransfer:function(e){debugger;var t=this;var r=new sap.ui.core.Locale("en-US");var a=sap.ui.core.format.NumberFormat.getFloatInstance(r);var l=this.getView().getModel("local").getProperty("/WSOrderHeader");var o=this.getView().getModel("local").getProperty("/orderHeaderTemp");var d=a.parse(o.CombinedBalance);var n=a.parse(o.FinalBalanceCash);var g=a.parse(o.FinalBalanceGold);var u=a.parse(o.FinalBalanceSilver);var c=new Date(l.Date);var h=t.getView().getModel("local").getProperty("/EntryData");if(h.Cash===d){var p=t.getView().getModel("i18n").getResourceBundle().getText("noAmountToTransfer");s.show(p,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}else if(h.Cash!==""&&h.Cash!=="0"&&h.Cash!==0&&d&&(d!==""||d!==0)&&t.getStatus()==="green"&&h.Cash!==d){debugger;var v=this.getView().getModel("local").getProperty("/EntryData");v.Date=new Date(l.Date);v.OrderNo=o.OrderId;v.OrderType="W";var c=this.getView().byId("WSHeaderFragment--DateId").getDateValue();v.Remarks="[Auto-Entry] Wholesale Transfer for Order"+""+l.OrderNo+" "+c;var y=h.id;if(t.getView().byId("WSHeaderFragment--RB-1").getSelected()){v.Cash=0-d}else if(t.getView().byId("WSHeaderFragment--RB-2").getSelected()){v.Gold=0-g}else if(t.getView().byId("WSHeaderFragment--RB-3").getSelected()){v.Silver=0-u}else if(t.getView().byId("WSHeaderFragment--RB-4").getSelected()){v.Cash=0-d;v.Gold=0-g;v.Silver=0-u}v.Customer=l.Customer;v.ChangedBy="";v.ChangedOn="";v.CreatedBy="";v.CreatedOn="";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Entrys('"+y+"')","PUT",{},v,this).then(function(e){var r=t.getView().getModel("i18n").getResourceBundle().getText("TransferAmountUpdated");i.show(r)})}else if((h.Cash===""||h.Cash==="0"||h.Cash===0)&&t.getStatus()==="green"&&d&&(d!==""||d!==0)){t.getView().setBusy(true);var v=this.getView().getModel("local").getProperty("/EntryData");v.Date=l.Date;v.OrderNo=o.OrderId;v.OrderType="W";var c=this.getView().byId("WSHeaderFragment--DateId").getDateValue();v.Remarks="[Auto-Entry] Wholesale Transfer for Order"+""+l.OrderNo+" "+c;if(t.getView().byId("WSHeaderFragment--RB-1").getSelected()){v.Cash=0-d}else if(t.getView().byId("WSHeaderFragment--RB-2").getSelected()){v.Gold=0-g}else if(t.getView().byId("WSHeaderFragment--RB-3").getSelected()){v.Silver=0-u}else if(t.getView().byId("WSHeaderFragment--RB-4").getSelected()){v.Cash=0-d;v.Gold=0-g;v.Silver=0-u}v.Customer=l.Customer;v.ChangedBy="";v.ChangedOn="";v.CreatedBy="";v.CreatedOn="";this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Entrys","POST",{},v,this).then(function(e){t.getView().setBusy(false);sap.m.MessageToast.show(t.resourceBundle.getText("Transferred"))}).catch(function(e){t.getView().setBusy(false);var r=t.getErrorMessage(e)})}else if(!d&&(d===""||d===0)){var p=t.getView().getModel("i18n").getResourceBundle().getText("noAmountToTransfer");s.show(p,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}else{var p=t.getView().getModel("i18n").getResourceBundle().getText("saveBeforeTransfer");s.show(p,{icon:s.Icon.ERROR,title:"Error",actions:[s.Action.OK],onClose:function(e){}})}},getEntryData:function(e,t,r,a,i){debugger;var l;var s=this;var o=a;var d=this.getView().getModel("local").getProperty("/orderHeaderTemp/OrderId");var n=this.getView().getModel("local").getProperty("/EntryData");n.OrderNo=d;n.Date=o;n.Customer=t;$.post("/EntryTransfer",{entryData:n}).then(function(e){debugger;i.Customer=e.Customer;i.Cash=e.Cash;i.OrderNo=e.OrderNo;i.id=e.id;l=true});return l},getPrintCustHeaderData:function(){var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){debugger;var r=e.getView().getModel("local").getProperty("/printCustomizing");for(var a=0;a<t.results.length;a++){switch(t.results[a].Name){case"__component0---idPrint--idAdd":r.Address=t.results[a].Value;break;case"__component0---idPrint--idCompName":r.CompName=t.results[a].Value;break;case"__component0---idPrint--idTnC":r.TnC=t.results[a].Value;break;case"__component0---idPrint--idgstn":r.GSTNumber=t.results[a].Value;break;case"__component0---idPrint--idContNo":r.ContNumber=t.results[a].Value;break;case"__component0---idPrint--idMarking":r.Marking=t.results[a].Value;break;default:}}e.getView().getModel("local").setProperty("/printCustomizing",r)}).catch(function(e){})},onPrintWs:function(){debugger;var e=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/prints","GET",{},{},this).then(function(t){debugger;e.wholesalePrint(t)}).catch(function(e){})},wholesalePrint:function(e){debugger;var t=[];var r=[];var i=this.getView().getModel("local").getProperty("/orderHeaderTemp");var l=this.getView().getModel("local").getProperty("/WSOrderHeader");var s=this.getView().getModel("local").getProperty("/printCustomizing");if(l.Date){var o=l.Date}else{o=new Date}if(typeof o!=="string"){var d=o.getDate();var n=o.getMonth()+1;var g=o.getFullYear();if(d<10){d="0"+d}if(n<10){n="0"+n}}else{d=parseInt(o.split("-")[2]);n=parseInt(o.split("-")[1]);g=parseInt(o.split("-")[0]);if(d<10){d="0"+d}if(n<10){n="0"+n}}var u=d+"."+n+"."+g;if(l.Customer){var c=l.Customer;var h=this.allMasterData.customers[c]}var p=a.getFormattedDate(0);var v,y,m,f,S,T,b,C,w,M,D;for(var V=0;V<e.results.length;V++){switch(e.results[V].Name){case"__component0---idPrint--idWCompName":if(e.results[V].Value==="true"){v=s.CompName}else{t.push("idWCompName")}break;case"__component0---idPrint--idWAddress":if(e.results[V].Value==="true"){y=s.Address}else{t.push("idWAddress")}break;case"__component0---idPrint--idContNo":if(e.results[V].Value==="true"){m=s.ContNumber}else{t.push("idWPhoneNumber")}break;case"__component0---idPrint--idWGSTN":if(e.results[V].Value==="true"){f=s.GSTNumber}else{t.push("idWGSTN")}break;case"__component0---idPrint--idWWeight":debugger;if(e.results[V].Value==="false"){t.push("idWWeight")}break;case"__component0---idPrint--idWEstimate":if(e.results[V].Value==="true"){w="Estimate"}else{w="Invoice"}break;case"__component0---idPrint--idWSubTotal":if(e.results[V].Value==="false"){t.push("idWSubTotal")}break;case"__component0---idPrint--idWSubTotalS":if(e.results[V].Value==="false"){t.push("idWSubTotalS")}break;case"__component0---idPrint--idWSubTotalG":if(e.results[V].Value==="false"){t.push("idWSubTotalG")}break;case"__component0---idPrint--idWBhav":if(e.results[V].Value==="false"){t.push("idWBhav")}break;case"__component0---idPrint--idWMakingCharge":if(e.results[V].Value==="false"){t.push("idWMakingCharge")}break;case"__component0---idPrint--idWTnC":if(e.results[V].Value==="true"){M=s.TnC}else{t.push("idWTnC")}break;case"__component0---idPrint--idWMarking":if(e.results[V].Value==="true"){D=s.Marking}else{t.push("idWMarking")}break;case"__component0---idPrint--idWQuantity":if(e.results[V].Value==="false"){t.push("idWQuantity")}break;case"__component0---idPrint--idWReturnWeight":if(e.results[V].Value==="false"){t.push("idWReturnWeight")}break;case"__component0---idPrint--idWReturnBhav":if(e.results[V].Value==="false"){t.push("idWReturnBhav")}break;case"__component0---idPrint--idWWeightD":if(e.results[V].Value==="false"){t.push("idWWeightD")}break;case"__component0---idPrint--idWQuantityD":if(e.results[V].Value==="false"){t.push("idWQuantityD")}break;case"__component0---idPrint--idWMakingChargeD":if(e.results[V].Value==="false"){t.push("idWMakingChargeD")}break;case"__component0---idPrint--idWRemarks":if(e.results[V].Value==="false"){t.push("idWRemarks")}break;case"__component0---idPrint--idWReturnRemarks":if(e.results[V].Value==="false"){t.push("idWReturnRemarks")}break;case"__component0---idPrint--idWReturnKattaWeight":if(e.results[V].Value==="false"){t.push("idWReturnKattaWeight")}break;case"__component0---idPrint--idWReturnTunch":if(e.results[V].Value==="false"){t.push("idWReturnTunch")}break;case"__component0---idPrint--idWReturnSubTotal":if(e.results[V].Value==="false"){t.push("idWReturnSubTotal")}default:}}var O='<h2 style="text-align: center;"><strong>'+w+"</strong></h2><hr />"+'<table style="display: inline-block; float: left; width: 450px; height: 100px;">'+"<tbody>"+"<tr>"+'<td class="idWCompName" style="width: 150px; height: 13.5px;"><strong>Company Name</strong></td>'+'<td class="idWCompName" style="width: 300px; height: 13.5px;">'+v+"</td>"+"</tr>"+"<tr>"+'<td class="idWAddress" style="width: 150px; height: 13px;"><strong>Address</strong></td>'+'<td class="idWAddress" style="width: 300px; height: 13px;">'+y+"</td>"+"</tr>"+"<tr>"+'<td class="idWPhoneNumber" style="width: 150px; height: 13px;"><strong>Ph No</strong></td>'+'<td class="idWPhoneNumber" style="width: 300px; height: 13px;">'+m+"</td>"+"</tr>"+"<tr>"+'<td class="idWGSTN" style="width: 150px; height: 13px;"><strong>GSTN</strong></td>'+'<td class="idWGSTN" style="width: 300px; height: 13px;">'+f+"</td>"+"</tr>"+"</tbody>"+"</table>"+'<table style="display: inline-block; width: 450px; height: 100px;">'+"<tbody>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Name</strong></td>'+'<td style="width: 350px;">'+i.CustomerName+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>City</strong></td>'+'<td style="width: 350px;">'+this.allMasterData.cities[h.City].cityName+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Customer Contact</strong></td>'+'<td style="width: 350px;">'+h.MobilePhone+"</td>"+"</tr>"+"<tr>"+'<td style="width: 150px;"><strong>Print Date</strong></td>'+'<td style="width: 350px;">'+p+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />"+'<table style="width: 900px;">'+"<tbody>"+"<tr>"+'<td style="width: 160px;"><strong>Invoice Number</strong></td>'+'<td style="width: 300px;">&nbsp;'+l.OrderNo+"</td>"+'<td style="width: 150px;"><strong>Date</strong></td>'+'<td style="width: 270px;">&nbsp;'+u+"</td>"+"</tr>"+"</tbody>"+"</table>"+"<hr />";var I="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style=" border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Material</h4></th>'+'<th class="idWQuantity" style=" border: 1px solid black;"><h4 style="text-align: center;">&nbsp;Qty</h4></th>'+'<th class="idWQuantityD" style=" border: 1px solid black;"><h4 style="text-align: center;">&nbsp;QtyD</h4></th>'+'<th class="idWWeight" style=" border: 1px solid black;"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idWWeightD" style=" border: 1px solid black;"><h4 style="text-align: center;">WeightD</h4></th>'+'<th class="idWMakingCharge" style=" border: 1px solid black;"><h4 style="text-align: center;">Making</h4></th>'+'<th class="idWMakingChargeD" style=" border: 1px solid black;"><h4 style="text-align: center;">MakingD</h4></th>'+'<th class="idWTunch" style=" border: 1px solid black;"><h4 style="text-align: center;">Tunch</h4></th>'+'<th class="idWRemarks" style=" border: 1px solid black"><h4 style="text-align: center;">Remarks</h4></th>'+'<th class="idWSubTotalS" style=" border: 1px solid black"><h4 style="text-align: center;">Sub Total Silver</h4></th>'+'<th class="idWSubTotalG" style=" border: 1px solid black"><h4 style="text-align: center;">Sub Total Gold</h4></th>'+'<th class="idWSubTotal" style=" border: 1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>";var W=this.getView().byId("WSItemFragment--orderItemBases");var P=W.getBinding("rows");var F=0;var x=0;var B=0;for(var V=0;V<P.getLength();V++){if(P.oList[V].MaterialCode){F=F+P.oList[V].Qty;x=x+P.oList[V].Weight;var k=P.oList[V].MaterialCode.concat("-",P.oList[V].Description);if(!P.oList[V].Remarks){P.oList[V].Remarks=""}I+="<tr>";I+='<td style=" border: 1px solid black;">&nbsp;'+k+"</td>"+'<td class="idWQuantity" style=" border: 1px solid black;">&nbsp;'+P.oList[V].Qty+"</td>"+'<td class="idWQuantityD" style=" border: 1px solid black;">&nbsp;'+P.oList[V].QtyD+"</td>"+'<td class="idWWeight" style=" border: 1px solid black;">&nbsp;'+P.oList[V].Weight+"</td>"+'<td class="idWWeightD" style=" border: 1px solid black;">&nbsp;'+P.oList[V].WeightD+"</td>"+'<td class="idWMakingCharge" style=" border: 1px solid black;">&nbsp;'+P.oList[V].Making+"</td>"+'<td class="idWMakingChargeD" style=" border: 1px solid black;">&nbsp;'+P.oList[V].MakingD+"</td>"+'<td class="idWTunch" style=" border: 1px solid black;">&nbsp;'+P.oList[V].Tunch+"</td>"+'<td class="idWRemarks" style=" border: 1px solid black;">&nbsp;'+P.oList[V].Remarks+"</td>"+'<td class="idWSubTotalS" style=" border: 1px solid black;s">&nbsp;'+P.oList[V].SubTotalS+"</td>"+'<td class="idWSubTotalG" style=" border: 1px solid black;s">&nbsp;'+P.oList[V].SubTotalG+"</td>"+'<td class="idWSubTotal" style=" border: 1px solid black;s">&nbsp;'+P.oList[V].SubTotal+"</td></tr>"}}I+="<tr>"+'<td style=" ">&nbsp;</td>'+'<td class="idWQuantity" style=" "><strong>&nbsp;'+F+"</strong></td>"+'<td class="idWQuantityD" style=" ">&nbsp;</td>'+'<td class="idWWeight" style=" "><strong>&nbsp;'+x+"</strong></td>"+'<td class="idWWeightD" style=" ">&nbsp;</td>'+'<td class="idWMakingCharge" style=" ">&nbsp;</td>'+'<td class="idWMakingChargeD" style=" ">&nbsp;</td>'+'<td class="idWTunch" style=" ">&nbsp;</td>'+'<td class="idWRemarks" style=" ">&nbsp;</td>'+'<td class="idWSubTotalS" style=" "><strong>&nbsp;'+i.TotalOrderValueSilver+"</strong></td>"+'<td class="idWSubTotalG" style=" "><strong>&nbsp;'+i.TotalOrderValueGold+"</strong></td>"+'<td class="idWSubTotal" style=" "><strong>&nbsp;'+i.TotalOrderValueCash+"</strong></td></tr>";var H=this.getView().getModel("returnModel").getProperty("/TransData");if(H[0].Type){I+="<table style='border-collapse: collapse;border:1px solid black;'width='95%'';'text-align:center';'border-spacing: 5px';>"+"<tr>"+'<th style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Product Type</h4></th>'+'<th class="idWReturnQuantity" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">&nbsp;Quantity</h4></th>'+'<th class="idWReturnWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Weight</h4></th>'+'<th class="idWReturnKattaWeight"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Katta Weight</h4></th>'+'<th class="idWReturnTunch"   style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Tunch(%)</h4></th>'+'<th class="idWReturnBhav" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Bhav</h4></th>'+'<th class="idWReturnRemarks" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Return Remarks</h4></th>'+'<th class="idWSubTotalS" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Sub Total Silver</h4></th>'+'<th class="idWSubTotalG" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Sub Total Gold</h4></th>'+'<th class="idWSubTotal" style="width: 80px;border:1px solid black"><h4 style="text-align: center;">Sub Total</h4></th>'+"</tr>"+"<p><h3>Returns:</h3></p>";for(var V=0;V<H.length;V++){if(H[V].Type){var G=G+H[V].Qty;var R=R+H[V].Weight;if(!H[V].Remarks){H[V].Remarks=""}I+="<tr>";I+='<td  style="width: 80px;border:1px solid black">&nbsp;'+H[V].Type+"</td>"+'<td  class="idWReturnQuantity" style="width: 80px;border:1px solid black">&nbsp;'+H[V].Qty+"</td>"+'<td  class="idWReturnWeight"   style="width: 80px;border:1px solid black">&nbsp;'+H[V].Weight+"</td>"+'<td  class="idWReturnKattaWeight"   style="width: 80px;border:1px solid black">&nbsp;'+H[V].KWeight+"</td>"+'<td  class="idWReturnTunch"   style="width: 80px;border:1px solid black">&nbsp;'+H[V].Tunch+"</td>"+'<td  class="idWReturnBhav"     style="width: 80px;border:1px solid black">&nbsp;'+H[V].Bhav+"</td>"+'<td  class="idWReturnRemarks"     style="width: 80px;border:1px solid black">&nbsp;'+H[V].Remarks+"</td>"+'<td  class="idWSubTotalS" style="width: 80px;border:1px solid black">&nbsp;'+H[V].SubTotalS+"</td>"+'<td  class="idWSubTotalG" style="width: 80px;border:1px solid black">&nbsp;'+H[V].SubTotalG+"</td>"+'<td  class="idWSubTotal" style="width: 80px;border:1px solid black">&nbsp;'+H[V].SubTotal+"</td></tr>"}}I+="<tr>"+'<td style="width: 80px;"><strong>&nbsp;Final Balance</strong></td>'+'<td class="idWReturnQuantity" style="width: 80px;">&nbsp;'+"</td>"+'<td class="idWReturnWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idWReturnKattaWeight" style="width: 80px;">&nbsp;</td>'+'<td class="idWReturnTunch" style="width: 80px;">&nbsp;</td>'+'<td class="idWReturnBhav" style="width: 80px;">&nbsp;</td>'+'<td class="idWReturnRemarks" style="width: 80px;">&nbsp;</td>'+'<td class="idWSubTotalS" style="width: 80px;"><strong>&nbsp;'+i.FinalBalanceSilver+"</strong></td>"+'<td class="idWSubTotalG" style="width: 80px;"><strong>&nbsp;'+i.FinalBalanceGold+"</strong></td>"+'<td class="idWSubTotal" style="width: 80px;"><strong>&nbsp;'+i.FinalBalanceCash+"</strong></td></tr>"}I+="</table>";var N='<table style="height: 40px; width: 950px;">'+"<tbody>"+"<tr>"+'<td class="idWTnC" style="width: 150px;"><strong>Terms &amp; Conditions:</strong></td>'+'<td class="idWTnC" style="width: 800px;">&nbsp;'+M+"</td>"+"</tr>"+"<tr>"+'<td class="idWMarking" style="width: 150px;">&nbsp;<strong>Marking:</strong></td>'+'<td class="idWMarking" style="width: 800px;">&nbsp;'+D+"</td>"+"</tr>"+"</tbody></table>";debugger;var Q=Math.floor(Math.random()*1e4);var E=window.open("","PrintWindow"+Q,"width=1200,height=800");E.document.write(O+I+N);for(var V=0;V<t.length;V++){var _=E.document.getElementsByClassName(t[V]);for(var K=0;K<_.length;K++){_[K].style.display="none"}}E.document.close();E.focus();setTimeout(function(){E.print()},1e3);E.stop()}})});